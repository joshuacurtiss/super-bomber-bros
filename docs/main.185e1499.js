parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"tp4l":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,a=(e,t)=>{for(var r in t||(t={}))i.call(t,r)&&o(e,r,t[r]);if(n)for(var r of n(t))s.call(t,r)&&o(e,r,t[r]);return e},u=(e,n)=>t(e,r(n)),l=(t,r)=>e(t,"name",{value:r,configurable:!0}),h=(e,t)=>()=>(e&&(t=e(e=0)),t),c=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);function d(e){return e*Math.PI/180}function f(e){return 180*e/Math.PI}function m(e,t,r){return t>r?m(e,r,t):Math.min(Math.max(e,t),r)}function p(e,t,r){return e+(t-e)*r}function g(e,t,r,n,i){return n+(e-t)/(r-t)*(i-n)}function y(e,t,r,n,i){return m(g(e,t,r,n,i),n,i)}function w(...e){if(0===e.length)return w(0,0);if(1===e.length){if("number"==typeof e[0])return w(e[0],e[0]);if(b(e[0]))return w(e[0].x,e[0].y);if(Array.isArray(e[0])&&2===e[0].length)return w.apply(null,e[0])}return{x:e[0],y:e[1],clone(){return w(this.x,this.y)},add(...e){let t=w(...e);return w(this.x+t.x,this.y+t.y)},sub(...e){let t=w(...e);return w(this.x-t.x,this.y-t.y)},scale(e){return w(this.x*e,this.y*e)},dist(...e){let t=w(...e);return Math.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y))},len(){return this.dist(w(0,0))},unit(){return this.scale(1/this.len())},normal(){return w(this.y,-this.x)},dot(...e){let t=w(...e);return w(this.x*t.x,this.y*t.y)},angle(...e){let t=w(...e);return Math.atan2(this.y-t.y,this.x-t.x)},lerp(e,t){return w(p(this.x,e.x,t),p(this.y,e.y,t))},eq(e){return this.x===e.x&&this.y===e.y},str(){return`(${this.x}, ${this.y})`}}}function v(e){return w(Math.cos(e),Math.sin(e))}function x(e,t,r){return{x:e,y:t,z:r,xy(){return w(this.x,this.y)}}}function b(e){return void 0!==e&&void 0!==e.x&&void 0!==e.y}function k(e){return void 0!==e&&void 0!==e.x&&void 0!==e.y&&void 0!==e.z}function R(e){return void 0!==e&&void 0!==e.r&&void 0!==e.g&&void 0!==e.b&&void 0!==e.a}function A(e){if(void 0!==e&&Array.isArray(e.m)&&16===e.m.length)return e}function P(...e){if(0===e.length)return E();if(1===e.length){if(R(e[0]))return E(e[0]);if(Array.isArray(e[0])&&3===e[0].length)return P.apply(null,e[0])}return E(e[0],e[1],e[2],1)}function E(...e){var t;if(0===e.length)return E(1,1,1,1);if(1===e.length){if(R(e[0]))return E(e[0].r,e[0].g,e[0].b,e[0].a);if(Array.isArray(e[0])&&4===e[0].length)return E.apply(null,e[0])}return{r:e[0],g:e[1],b:e[2],a:null!=(t=e[3])?t:1,clone(){return E(this.r,this.g,this.b,this.a)},lighten(e){return E(this.r+e,this.g+e,this.b+e,this.a)},darken(e){return this.lighten(-e)},invert(){return E(1-this.r,1-this.g,1-this.b,this.a)},isDark(e=.5){return this.r+this.g+this.b<3*e},isLight(e=.5){return this.r+this.g+this.b>3*e},eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.g&&this.a===e.a}}}function S(e,t,r,n){return{x:e,y:t,w:r,h:n,clone(){return S(this.x,this.y,this.w,this.h)},eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}}}function T(e){return{m:e?[...e]:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],clone(){return T(this.m)},mult(e){let t=[];for(let r=0;r<4;r++)for(let n=0;n<4;n++)t[4*r+n]=this.m[0+n]*e.m[4*r+0]+this.m[4+n]*e.m[4*r+1]+this.m[8+n]*e.m[4*r+2]+this.m[12+n]*e.m[4*r+3];return T(t)},multVec4(e){return{x:e.x*this.m[0]+e.y*this.m[4]+e.z*this.m[8]+e.w*this.m[12],y:e.x*this.m[1]+e.y*this.m[5]+e.z*this.m[9]+e.w*this.m[13],z:e.x*this.m[2]+e.y*this.m[6]+e.z*this.m[10]+e.w*this.m[14],w:e.x*this.m[3]+e.y*this.m[7]+e.z*this.m[11]+e.w*this.m[15]}},multVec3(e){let t=this.multVec4({x:e.x,y:e.y,z:e.z,w:1});return x(t.x,t.y,t.z)},multVec2(e){return w(e.x*this.m[0]+e.y*this.m[4]+0*this.m[8]+1*this.m[12],e.x*this.m[1]+e.y*this.m[5]+0*this.m[9]+1*this.m[13])},translate(e){return this.mult(T([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,0,1]))},scale(e){return this.mult(T([e.x,0,0,0,0,e.y,0,0,0,0,1,0,0,0,0,1]))},rotateX(e){return this.mult(T([1,0,0,0,0,Math.cos(e),-Math.sin(e),0,0,Math.sin(e),Math.cos(e),0,0,0,0,1]))},rotateY(e){return this.mult(T([Math.cos(e),0,-Math.sin(e),0,0,1,0,0,Math.sin(e),0,Math.cos(e),0,0,0,0,1]))},rotateZ(e){return this.mult(T([Math.cos(e),-Math.sin(e),0,0,Math.sin(e),Math.cos(e),0,0,0,0,1,0,0,0,0,1]))},invert(){let e=[],t=this.m[10]*this.m[15]-this.m[14]*this.m[11],r=this.m[9]*this.m[15]-this.m[13]*this.m[11],n=this.m[9]*this.m[14]-this.m[13]*this.m[10],i=this.m[8]*this.m[15]-this.m[12]*this.m[11],s=this.m[8]*this.m[14]-this.m[12]*this.m[10],o=this.m[8]*this.m[13]-this.m[12]*this.m[9],a=this.m[6]*this.m[15]-this.m[14]*this.m[7],u=this.m[5]*this.m[15]-this.m[13]*this.m[7],l=this.m[5]*this.m[14]-this.m[13]*this.m[6],h=this.m[4]*this.m[15]-this.m[12]*this.m[7],c=this.m[4]*this.m[14]-this.m[12]*this.m[6],d=this.m[5]*this.m[15]-this.m[13]*this.m[7],f=this.m[4]*this.m[13]-this.m[12]*this.m[5],m=this.m[6]*this.m[11]-this.m[10]*this.m[7],p=this.m[5]*this.m[11]-this.m[9]*this.m[7],g=this.m[5]*this.m[10]-this.m[9]*this.m[6],y=this.m[4]*this.m[11]-this.m[8]*this.m[7],w=this.m[4]*this.m[10]-this.m[8]*this.m[6],v=this.m[4]*this.m[9]-this.m[8]*this.m[5];e[0]=this.m[5]*t-this.m[6]*r+this.m[7]*n,e[4]=-(this.m[4]*t-this.m[6]*i+this.m[7]*s),e[8]=this.m[4]*r-this.m[5]*i+this.m[7]*o,e[12]=-(this.m[4]*n-this.m[5]*s+this.m[6]*o),e[1]=-(this.m[1]*t-this.m[2]*r+this.m[3]*n),e[5]=this.m[0]*t-this.m[2]*i+this.m[3]*s,e[9]=-(this.m[0]*r-this.m[1]*i+this.m[3]*o),e[13]=this.m[0]*n-this.m[1]*s+this.m[2]*o,e[2]=this.m[1]*a-this.m[2]*u+this.m[3]*l,e[6]=-(this.m[0]*a-this.m[2]*h+this.m[3]*c),e[10]=this.m[0]*d-this.m[1]*h+this.m[3]*f,e[14]=-(this.m[0]*l-this.m[1]*c+this.m[2]*f),e[3]=-(this.m[1]*m-this.m[2]*p+this.m[3]*g),e[7]=this.m[0]*m-this.m[2]*y+this.m[3]*w,e[11]=-(this.m[0]*p-this.m[1]*y+this.m[3]*v),e[15]=this.m[0]*g-this.m[1]*w+this.m[2]*v;let x=this.m[0]*e[0]+this.m[1]*e[4]+this.m[2]*e[8]+this.m[3]*e[12];for(let b=0;b<4;b++)for(let t=0;t<4;t++)e[4*b+t]*=1/x;return T(e)}}}function _(e,t,r){return e+(Math.sin(r)+1)/2*(t-e)}function D(e){return{seed:e,gen(...e){if(0===e.length)return this.seed=(O*this.seed+j)%Y,this.seed/Y;if(1===e.length){if("number"==typeof e[0])return this.gen(0,e[0]);if(b(e[0]))return this.gen(w(0,0),e[0]);if(R(e[0]))return this.gen(E(0,0,0,0),e[0])}else if(2===e.length){if("number"==typeof e[0]&&"number"==typeof e[1])return this.gen()*(e[1]-e[0])+e[0];if(b(e[0])&&b(e[1]))return w(this.gen(e[0].x,e[1].x),this.gen(e[0].y,e[1].y));if(R(e[0])&&R(e[1]))return E(this.gen(e[0].r,e[1].r),this.gen(e[0].g,e[1].g),this.gen(e[0].b,e[1].b),this.gen(e[0].a,e[1].a))}}}}function F(e){N.seed=e}function M(...e){return N.gen(...e)}function I(e){return M()<=e}function L(e){return e[Math.floor(M(e.length))]}function C(e,t){return e.p2.x>=t.p1.x&&e.p1.x<=t.p2.x&&e.p2.y>=t.p1.y&&e.p1.y<=t.p2.y}function q(e,t){return e.p2.x>t.p1.x&&e.p1.x<t.p2.x&&e.p2.y>t.p1.y&&e.p1.y<t.p2.y}function B(e,t){return t.x>=e.p1.x&&t.x<=e.p2.x&&t.y>=e.p1.y&&t.y<e.p2.y}var O,j,Y,N,U=h(()=>{l(d,"deg2rad"),l(f,"rad2deg"),l(m,"clamp"),l(p,"lerp"),l(g,"map"),l(y,"mapc"),l(w,"vec2"),l(v,"vec2FromAngle"),l(x,"vec3"),l(b,"isVec2"),l(k,"isVec3"),l(R,"isColor"),l(A,"isMat4"),l(P,"rgb"),l(E,"rgba"),l(S,"quad"),l(T,"mat4"),l(_,"wave"),O=1103515245,j=12345,Y=2147483648,N=D(Date.now()),l(D,"makeRng"),l(F,"randSeed"),l(M,"rand"),l(I,"chance"),l(L,"choose"),l(C,"colRectRect"),l(q,"overlapRectRect"),l(B,"colRectPt")});function z(e,t){let r=typeof e,n=typeof t;if(r!==n)return!1;if("object"===r&&"object"===n){let r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(let i of r){let r=e[i],n=t[i];if(("function"!=typeof r||"function"!=typeof n)&&!z(r,n))return!1}return!0}return e===t}var H=h(()=>{l(z,"deepEq")});function X(e){switch(e){case"topleft":return w(-1,-1);case"top":return w(0,-1);case"topright":return w(1,-1);case"left":return w(-1,0);case"center":return w(0,0);case"right":return w(1,0);case"botleft":return w(-1,1);case"bot":return w(0,1);case"botright":return w(1,1);default:return e}}function J(e,t){let r=(()=>{switch(t.texFilter){case"linear":return e.LINEAR;case"nearest":default:return e.NEAREST}})(),n=(()=>{var r;let n=o($,ee),i=s(new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),a=null!=(r=t.clearColor)?r:E(0,0,0,1);e.clearColor(a.r,a.g,a.b,a.a),e.enable(e.BLEND),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);let u=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,u),e.bufferData(e.ARRAY_BUFFER,4*K,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null);let l=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,l),e.bufferData(e.ELEMENT_ARRAY_BUFFER,2*K,e.DYNAMIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null);let h=s(new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2));return{drawCalls:0,lastDrawCalls:0,defProg:n,curProg:n,defTex:i,curTex:i,curUniform:{},vbuf:u,ibuf:l,vqueue:[],iqueue:[],transform:T(),transformStack:[],clearColor:a,bgTex:h}})();function i(e){return Math.log(e)/Math.log(2)%1==0}function s(t){let n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r);let s=(()=>i(t.width)&&i(t.height)?e.REPEAT:e.CLAMP_TO_EDGE)();return e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,s),e.bindTexture(e.TEXTURE_2D,null),{width:t.width,height:t.height,bind(){e.bindTexture(e.TEXTURE_2D,n)},unbind(){e.bindTexture(e.TEXTURE_2D,null)}}}function o(t=$,r=ee){let n,i=Q.replace("{{user}}",null!=t?t:$),s=Z.replace("{{user}}",null!=r?r:ee),o=e.createShader(e.VERTEX_SHADER),a=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(o,i),e.shaderSource(a,s),e.compileShader(o),e.compileShader(a),n=e.getShaderInfoLog(o))throw new Error(n);if(n=e.getShaderInfoLog(a))throw new Error(n);let u=e.createProgram();if(e.attachShader(u,o),e.attachShader(u,a),e.bindAttribLocation(u,0,"a_pos"),e.bindAttribLocation(u,1,"a_uv"),e.bindAttribLocation(u,2,"a_color"),e.linkProgram(u),(n=e.getProgramInfoLog(u))&&"\n"!==n)throw new Error(n);return{bind(){e.useProgram(u)},unbind(){e.useProgram(null)},bindAttribs(){e.vertexAttribPointer(0,3,e.FLOAT,!1,4*V,0),e.enableVertexAttribArray(0),e.vertexAttribPointer(1,2,e.FLOAT,!1,4*V,12),e.enableVertexAttribArray(1),e.vertexAttribPointer(2,4,e.FLOAT,!1,4*V,20),e.enableVertexAttribArray(2)},send(t){this.bind();for(let r in t){let n=t[r],i=e.getUniformLocation(u,r);"number"==typeof n?e.uniform1f(i,n):A(n)?e.uniformMatrix4fv(i,!1,new Float32Array(n.m)):R(n)?e.uniform4f(i,n.r,n.g,n.b,n.a):k(n)?e.uniform3f(i,n.x,n.y,n.z):b(n)&&e.uniform2f(i,n.x,n.y)}this.unbind()}}}function h(e,t,r,n){let i=e.width/t,s=1/i,o=1/(e.height/r),a={},u=n.split("").entries();for(let[l,h]of u)a[h]=w(l%i*s,Math.floor(l/i)*o);return{tex:e,map:a,qw:s,qh:o}}function c(e,t,r=n.defTex,i=n.defProg,s={}){r=null!=r?r:n.defTex,i=null!=i?i:n.defProg,(r!==n.curTex||i!==n.curProg||!z(n.curUniform,s)||n.vqueue.length+e.length*V>K||n.iqueue.length+t.length>K)&&d(),n.curTex=r,n.curProg=i,n.curUniform=s;let o=t.map(e=>e+n.vqueue.length/V),a=e.map(e=>{let t=g(n.transform.multVec2(e.pos.xy()));return[t.x,t.y,e.pos.z,e.uv.x,e.uv.y,e.color.r,e.color.g,e.color.b,e.color.a]}).flat();o.forEach(e=>n.iqueue.push(e)),a.forEach(e=>n.vqueue.push(e))}function d(){!n.curTex||!n.curProg||0===n.vqueue.length||0===n.iqueue.length||(n.curProg.send(n.curUniform),e.bindBuffer(e.ARRAY_BUFFER,n.vbuf),e.bufferSubData(e.ARRAY_BUFFER,0,new Float32Array(n.vqueue)),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.ibuf),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(n.iqueue)),n.curProg.bind(),n.curProg.bindAttribs(),n.curTex.bind(),e.drawElements(e.TRIANGLES,n.iqueue.length,e.UNSIGNED_SHORT,0),n.curTex.unbind(),n.curProg.unbind(),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),n.iqueue=[],n.vqueue=[],n.drawCalls++)}function f(){e.clear(e.COLOR_BUFFER_BIT),t.clearColor||M({width:Y(),height:N(),quad:S(0,0,Y()*U()/W,N()*U()/W),tex:n.bgTex}),n.drawCalls=0,n.transformStack=[],n.transform=T()}function m(){d(),n.lastDrawCalls=n.drawCalls}function p(){return n.lastDrawCalls}function g(e){return w(e.x/Y()*2-1,-e.y/N()*2+1)}function y(e){n.transform=e.clone()}function v(e){!e||0===e.x&&0===e.y||(n.transform=n.transform.translate(e))}function P(e){!e||1===e.x&&1===e.y||(n.transform=n.transform.scale(e))}function _(e){!e||(n.transform=n.transform.rotateZ(e))}function D(){n.transformStack.push(n.transform.clone())}function F(){n.transformStack.length>0&&(n.transform=n.transformStack.pop())}function M(e={}){var t,r;let n=e.width||0,i=e.height||0,s=e.pos||w(0,0),o=X(e.origin||G).dot(w(n,i).scale(-.5)),a=w(null!=(t=e.scale)?t:1),u=e.rot||0,l=e.quad||S(0,0,1,1),h=1-(null!=(r=e.z)?r:0),d=e.color||E(1,1,1,1);D(),v(s),P(a),_(u),v(o),c([{pos:x(-n/2,i/2,h),uv:w(l.x,l.y+l.h),color:d},{pos:x(-n/2,-i/2,h),uv:w(l.x,l.y),color:d},{pos:x(n/2,-i/2,h),uv:w(l.x+l.w,l.y),color:d},{pos:x(n/2,i/2,h),uv:w(l.x+l.w,l.y+l.h),color:d}],[0,1,3,1,2,3],e.tex,e.prog,e.uniform),F()}function I(e,t={}){var r;let n=null!=(r=t.quad)?r:S(0,0,1,1),i=e.width*n.w,s=e.height*n.h;M(u(a({},t),{tex:e,quad:n,width:i,height:s}))}function L(e,t,r,n={}){M(u(a({},n),{pos:e,width:t,height:r}))}function C(e,t,r,n={}){let i=X(n.origin||G).dot(w(t,r)).scale(.5),s=e.add(w(-t/2,-r/2)).sub(i),o=e.add(w(-t/2,r/2)).sub(i),a=e.add(w(t/2,r/2)).sub(i),u=e.add(w(t/2,-r/2)).sub(i);q(s,o,n),q(o,a,n),q(a,u,n),q(u,s,n)}function q(e,t,r={}){let n=r.width||1,i=e.dist(t),s=Math.PI/2-e.angle(t);M(u(a({},r),{pos:e.add(t).scale(.5),width:n,height:i,rot:s,origin:"center"}))}function B(e,t,r={}){let n=(e+"").split(""),i=t.qw*t.tex.width,s=t.qh*t.tex.height,o=w((r.size||s)/s).dot(w(r.scale||1)),a=o.x*i,u=o.y*s,l=0,h=u,c=0,d=[[]];for(let w of n)("\n"===w||!!r.width&&l+a>r.width)&&(h+=u,l=0,d.push([])),"\n"!==w&&(d[d.length-1].push(w),l+=a),c=Math.max(c,l);r.width&&(c=r.width);let f=[],m=w(r.pos||0),p=X(r.origin||G).scale(.5),g=-p.x*a-(p.x+.5)*(c-a),y=-p.y*u-(p.y+.5)*(h-u);return d.forEach((e,n)=>{let i=(c-e.length*a)*(p.x+.5);e.forEach((e,s)=>{let l=t.map[e],h=s*a,c=n*u;l&&f.push({tex:t.tex,quad:S(l.x,l.y,t.qw,t.qh),ch:e,pos:w(m.x+h+g+i,m.y+c+y),color:r.color,origin:r.origin,scale:o,z:r.z})})}),{width:c,height:h,chars:f}}function O(e,t,r={}){j(B(e,t,r))}function j(e){for(let t of e.chars)M({tex:t.tex,width:t.tex.width*t.quad.w,height:t.tex.height*t.quad.h,pos:t.pos,scale:t.scale,color:t.color,quad:t.quad,origin:"center",z:t.z})}function Y(){return e.drawingBufferWidth/U()}function N(){return e.drawingBufferHeight/U()}function U(){var e;return null!=(e=t.scale)?e:1}function H(){return n.clearColor.clone()}return f(),m(),l(i,"powerOfTwo"),l(s,"makeTex"),l(o,"makeProgram"),l(h,"makeFont"),l(c,"drawRaw"),l(d,"flush"),l(f,"frameStart"),l(m,"frameEnd"),l(p,"drawCalls"),l(g,"toNDC"),l(y,"pushMatrix"),l(v,"pushTranslate"),l(P,"pushScale"),l(function(e){!e||(n.transform=n.transform.rotateX(e))},"pushRotateX"),l(function(e){!e||(n.transform=n.transform.rotateY(e))},"pushRotateY"),l(_,"pushRotateZ"),l(D,"pushTransform"),l(F,"popTransform"),l(M,"drawQuad"),l(I,"drawTexture"),l(L,"drawRect"),l(C,"drawRectStroke"),l(q,"drawLine"),l(B,"fmtText"),l(O,"drawText"),l(j,"drawFmtText"),l(Y,"width"),l(N,"height"),l(U,"scale"),l(H,"clearColor"),{width:Y,height:N,scale:U,makeTex:s,makeProgram:o,makeFont:h,drawTexture:I,drawText:O,drawFmtText:j,drawRect:L,drawRectStroke:C,drawLine:q,fmtText:B,frameStart:f,frameEnd:m,pushTransform:D,popTransform:F,pushMatrix:y,drawCalls:p,clearColor:H}}var G,V,K,W,Q,Z,$,ee,te=h(()=>{U(),H(),G="topleft",V=9,K=65536,W=64,Q="\nattribute vec3 a_pos;\nattribute vec2 a_uv;\nattribute vec4 a_color;\n\nvarying vec3 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nvec4 def_vert() {\n\treturn vec4(a_pos, 1.0);\n}\n\n{{user}}\n\nvoid main() {\n\tvec4 pos = vert(a_pos, a_uv, a_color);\n\tv_pos = a_pos;\n\tv_uv = a_uv;\n\tv_color = a_color;\n\tgl_Position = pos;\n}\n",Z="\nprecision mediump float;\n\nvarying vec3 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nuniform sampler2D u_tex;\n\nvec4 def_frag() {\n\treturn v_color * texture2D(u_tex, v_uv);\n}\n\n{{user}}\n\nvoid main() {\n\tgl_FragColor = frag(v_pos, v_uv, v_color, u_tex);\n\tif (gl_FragColor.a == 0.0) {\n\t\tdiscard;\n\t}\n}\n",$="\nvec4 vert(vec3 pos, vec2 uv, vec4 color) {\n\treturn def_vert();\n}\n",ee="\nvec4 frag(vec3 pos, vec2 uv, vec4 color, sampler2D tex) {\n\treturn def_frag();\n}\n",l(X,"originPt"),l(J,"gfxInit")});function re(e){return"pressed"===e||"rpressed"===e?"down":"released"===e?"up":e}function ne(e={}){var t,r;let n={canvas:null!=(t=e.canvas)?t:(()=>{var t;let r=document.createElement("canvas");return(null!=(t=e.root)?t:document.body).appendChild(r),r})(),keyStates:{},charInputted:[],mouseState:"up",mousePos:w(0,0),time:0,realTime:0,skipTime:!1,dt:0,scale:null!=(r=e.scale)?r:1,isTouch:!1,loopID:null,stopped:!1,fps:0,fpsBuf:[],fpsTimer:0},i={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"},s=["space","left","right","up","down","tab","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11"];e.fullscreen?(n.canvas.width=window.innerWidth,n.canvas.height=window.innerHeight):(n.canvas.width=(e.width||640)*n.scale,n.canvas.height=(e.height||480)*n.scale);let o=["outline: none","cursor: default"];e.crisp&&(o.push("image-rendering: pixelated"),o.push("image-rendering: crisp-edges")),n.canvas.style=o.join(";"),n.canvas.setAttribute("tabindex","0");let a=n.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0});function u(){return n.mousePos.clone()}function h(){return"pressed"===n.mouseState}function c(){return"pressed"===n.mouseState||"down"===n.mouseState}function d(){return"released"===n.mouseState}function f(e){return"pressed"===n.keyStates[e]}function m(e){return"pressed"===n.keyStates[e]||"rpressed"===n.keyStates[e]}function p(e){return"pressed"===n.keyStates[e]||"rpressed"===n.keyStates[e]||"down"===n.keyStates[e]}function g(e){return"released"===n.keyStates[e]}function y(){return[...n.charInputted]}function v(){return n.dt}function x(){return n.time}function b(){return n.fps}function k(){return n.canvas.toDataURL()}function R(e){return e&&(n.canvas.style.cursor=null!=e?e:"default"),n.canvas.style.cursor}function A(e){let t=l(r=>{let i=r/1e3,s=i-n.realTime;n.realTime=i,n.skipTime||(n.dt=s,n.time+=n.dt,n.fpsBuf.push(1/n.dt),n.fpsTimer+=n.dt,n.fpsTimer>=1&&(n.fpsTimer=0,n.fps=Math.round(n.fpsBuf.reduce((e,t)=>e+t)/n.fpsBuf.length),n.fpsBuf=[])),n.skipTime=!1,e();for(let e in n.keyStates)n.keyStates[e]=re(n.keyStates[e]);n.mouseState=re(n.mouseState),n.charInputted=[],n.stopped||(n.loopID=requestAnimationFrame(t))},"frame");n.loopID=requestAnimationFrame(t)}function P(){cancelAnimationFrame(n.loopID),n.stopped=!0}return n.isTouch="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,n.canvas.addEventListener("mousemove",e=>{n.mousePos=w(e.offsetX,e.offsetY).scale(1/n.scale)}),n.canvas.addEventListener("mousedown",()=>{n.mouseState="pressed"}),n.canvas.addEventListener("mouseup",()=>{n.mouseState="released"}),n.canvas.addEventListener("touchstart",e=>{let t=e.touches[0];n.mousePos=w(t.clientX,t.clientY).scale(1/n.scale),n.mouseState="pressed"}),n.canvas.addEventListener("touchmove",e=>{let t=e.touches[0];n.mousePos=w(t.clientX,t.clientY).scale(1/n.scale)}),n.canvas.addEventListener("keydown",e=>{let t=i[e.key]||e.key.toLowerCase();s.includes(t)&&e.preventDefault(),1===t.length&&n.charInputted.push(t),"space"===t&&n.charInputted.push(" "),e.repeat?n.keyStates[t]="rpressed":n.keyStates[t]="pressed"}),n.canvas.addEventListener("keyup",e=>{let t=i[e.key]||e.key.toLowerCase();n.keyStates[t]="released"}),n.canvas.focus(),document.addEventListener("visibilitychange",()=>{switch(document.visibilityState){case"visible":n.skipTime=!0}}),l(u,"mousePos"),l(h,"mouseClicked"),l(c,"mouseDown"),l(d,"mouseReleased"),l(f,"keyPressed"),l(m,"keyPressedRep"),l(p,"keyDown"),l(g,"keyReleased"),l(y,"charInputted"),l(v,"dt"),l(x,"time"),l(b,"fps"),l(k,"screenshot"),l(R,"cursor"),l(A,"run"),l(P,"quit"),{gl:a,mousePos:u,keyDown:p,keyPressed:f,keyPressedRep:m,keyReleased:g,mouseDown:c,mouseClicked:h,mouseReleased:d,charInputted:y,cursor:R,dt:v,time:x,fps:b,screenshot:k,run:A,quit:P}}var ie=h(()=>{U(),l(re,"processBtnState"),l(ne,"appInit")});function se(){let e=(()=>{let e=new(window.AudioContext||window.webkitAudioContext),t=e.createGain(),r=t;return r.connect(e.destination),{ctx:e,gainNode:t,masterNode:r}})();function t(t){return void 0!==t&&(e.gainNode.gain.value=m(t,oe,ae)),e.gainNode.gain.value}function r(t,r={loop:!1,volume:1,speed:1,detune:0,seek:0}){var n;let i=!1,s=e.ctx.createBufferSource();s.buffer=t,s.loop=!!r.loop;let o=e.ctx.createGain();s.connect(o),o.connect(e.masterNode);let a=null!=(n=r.seek)?n:0;s.start(0,a);let u=e.ctx.currentTime-a,l=null,h={stop(){i||(this.pause(),u=e.ctx.currentTime)},play(t){if(!i)return;let r=s;(s=e.ctx.createBufferSource()).buffer=r.buffer,s.loop=r.loop,s.playbackRate.value=r.playbackRate.value,s.detune&&(s.detune.value=r.detune.value),s.connect(o);let n=null!=t?t:this.time();s.start(0,n),u=e.ctx.currentTime-n,i=!1,l=null},pause(){i||(s.stop(),i=!0,l=e.ctx.currentTime)},paused:()=>i,stopped:()=>i,speed:e=>(void 0!==e&&(s.playbackRate.value=m(e,ue,le)),s.playbackRate.value),detune:e=>s.detune?(void 0!==e&&(s.detune.value=m(e,he,ce)),s.detune.value):0,volume:e=>(void 0!==e&&(o.gain.value=m(e,oe,ae)),o.gain.value),loop(){s.loop=!0},unloop(){s.loop=!1},duration:()=>t.duration,time:()=>i?l-u:e.ctx.currentTime-u};return h.speed(r.speed),h.detune(r.detune),h.volume(r.volume),h}function n(){return e.ctx}return l(t,"volume"),l(r,"play"),l(n,"ctx"),{ctx:n,volume:t,play:r}}var oe,ae,ue,le,he,ce,de,fe=h(()=>{U(),oe=0,ae=3,ue=0,le=3,he=-1200,ce=1200,l(se,"audioInit")}),me=h(()=>{de="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAvgAAAAICAYAAACML4vTAAAAAXNSR0IArs4c6QAABo1JREFUeJzdW9uO5SgMJKv9/1/OPnQnDabKVQb6zGgtjeYkvmJsYwh9tQLc931//7yu63retdba+/4hTZ6ZDMQ3wHVdPe1kXk/60He2D/J7HLMhGyOwHQKji/o/BYmv40DecRq+cfgr8l8dhBfRLPF3v6F9Cu/ObwFPYxRBFptE7mA/wQ2yWMwI/1r+y3Bq/h4H3TwJ3fl16xcz4UfQPB+oplF9QJ7id+SjMVjz/wf5e5rK+hKfB9+a86PsZTIm+7P6942jufsqSvg7/END5WSg6ojLt7uurcjL6v8pfQ4doinIL9v+f4HTMfQ3gopR5gOQ+6jviPj7EfLvqQGsQFiXb/B7KMBGc/rQ3x1ONuHmBmOQfd93XwDVguPI/3Uw/fc8Dz5s4/xMogU/xScNKILJb4W5Q/YyXtt+IWcyF+GzMajY7ehZbCK5vf2sGczmJ+J6O6J8pT8dB5HPwPU706/knsjfVRlxvhje0Zn5H+F/m/+kf6uA1oxqPVD1Jeqj+kHuRr5x0ZzzU8nJANrCalDS5A54xV9Ynyd+p/6bNXSiBfY5Dk1pkPyObzI0s10ceFr+3+FXsMq/qk+BM97TusU6bIvp+Flf1ufuy/OJBh817s/vlcKOaOHgRBOeyu0nppt4uIEA+gcboLLv96oIu18IFLhfSRooMh19hsvkKyNjkCo6R+fXC3ya/ddAdjrekxH2i8VmiH23oGTNYy+n2iBHyPhYjtWV8IJtyz38BW6a42JMKuJtn30IfgJT+PdkziayaP1W+OpX6J6HyJ+ac8MXaJEvNfnGGheVow34neAn/tag30aByRfI5PDBlZ9tzNghHuJDMnZpGO37rMam/L/Jj2w6wY/8TH1gPCNfQ3zxAJTZ3wPKkS9EIS9bm3OfbDonof9YWgw7gCJ0uqF+390/JIs1QZE+yhjkKOcifMKDdMX3kYbxKB3xn8fsNZEPPm2SBQ7KD/OkkgXZfYV/PV/U/+rok0IswDH+HDyCmAcuXs1LHP8gBzTyd487dIrgAPPfC489wK6K/GwjouYoo6nmZQXUHCtA9RThd+yX87fIn9X3T8Kkl2yC3zlS+NZK9XUClruFjU3093IcBFui8U79Zfg74Flj7dRHJJ/1Hq58xAs3JAdgNb9QDxHB9f8JfgSV+c96QaVnCcRhzx3+r+hXY9qtq1HmKy+up3Ft3T7BN06gWVDGZhI5JL4b6Mh9yolu5T6iukMN7M4KQqWZ/SKYP9+lYJyAOYtPveMy5IPdZja//XPVnkw+tBHdPe35w8kWs3UX+tjNrtggvpWvM3H8Lihi5f/dE1kVD068PL7O+Fc2z65eNseuDEfHKoxFpx4fjm9bS+LjFyEu4F8P4gras1geqq8QzK9wlJ3IWYJk3TtS8zbvV8MN2qGvaxQOXt3YafKe2NjN8U8A2hzGDQpdg37xqzurObB3dOY9uyYG8nG37pXjp9rg7wQm+v0A201GvGqUd4KfFlejgUobxCDjixAXod3NiWVfRaa6YsT0hitIWWAqXyr+JdhYBDJbSg32Y8fOFZvVDdziBq/cABPY8WEKpxf31fgnMM2xq681u9HYagAM/6mxDmM0eXaBNhCELgKt36Z+Vf9GYoDLrsg496TZ8yFg629dEL+D7sDq4FB8bIF7xTaxI2X8Q9dJWf7Y/ks2iPYGf2HsWf5HnOovUH2m4896Q9JDDs+rV7TduKs2+EcLNdnhvM/f+MqCEp8tO437h9C2YEP2nL7/5WR2G79sgYwGqo1ElJHu4F9msAkC84Lscxd4Bg5/ansGhVOAKf7MAuBu4NC8seJ1mQ0lku/okM090M/iS8HuAq/ivxJ/To1RMrDg/G8OTuVHub4e1j/wg9xBuF5fbPJVTlTsdOaPrmdiHVqK3UN/w+Xmz2r+K/mQf6G5RnauwDuHm80oGwCLkZMbHLYB/nkYm9Md/yF6NDa3SR9sNPM/0rD+cpgf8ws+qifOGN35XK2bHznBj3xWEKHTy+QT5HYiGJ83kW3lP5ZI4MTmKU1a9rcFbNyFT76OzVC+olP2tQYLEJNfGmO2iVs4AU/nd/PzejrHiM58z/BWvjnzs+J7QEvxzlcQgFupJxXfVuSjuFP11NFp4bI76IVnpZ/a7cxfRkNiIxtL9n41f1yayhrngmrG5LwYdWkp/x35h9Yg1WC6vlYNuStvKeZW+h9zfR/eIboHxD12Bml87PYgiCZZP5Z81fI5lrm5k0fxfWVj+x9lSgjp7YOOoAAAAABJRU5ErkJggg=="});function pe(e){let t=new Image;return t.src=e,t.crossOrigin="anonymous",new Promise((r,n)=>{t.onload=(()=>{r(t)}),t.onerror=(()=>{n(`failed to load ${e}`)})})}function ge(e){return e.startsWith("data:")}function ye(e,t,r={}){let n={lastLoaderID:0,loadRoot:"",loaders:{},sprites:{},sounds:{},fonts:{},shaders:{}};function i(e){var t;let i=n.lastLoaderID;n.loaders[i]=!1,n.lastLoaderID++,e.catch(null!=(t=r.errHandler)?t:console.error).finally(()=>{n.loaders[i]=!0})}function s(){let e=0,t=0;for(let r in n.loaders)e+=1,n.loaders[r]&&(t+=1);return t/e}function o(e){return e&&(n.loadRoot=e),n.loadRoot}function a(t,r,s,o,a=we){let u=new Promise((i,u)=>{pe(ge(r)?r:n.loadRoot+r).then(r=>{let u=e.makeFont(e.makeTex(r),s,o,a);n.fonts[t]=u,i(u)}).catch(u)});return i(u),u}function u(t,r,s={sliceX:1,sliceY:1,anims:{}}){function o(t,r,i={sliceX:1,sliceY:1,gridWidth:0,gridHeight:0,anims:{}}){let s=[],o=e.makeTex(r),a=i.sliceX||o.width/(i.gridWidth||o.width),u=i.sliceY||o.height/(i.gridHeight||o.height),l=1/a,h=1/u;for(let e=0;e<u;e++)for(let t=0;t<a;t++)s.push(S(t*l,e*h,l,h));let c={tex:o,frames:s,anims:i.anims||{}};return n.sprites[t]=c,c}l(o,"loadRawSprite");let a=new Promise((e,i)=>{if(!r)return i(`expected sprite src for "${t}"`);if("string"==typeof r){pe(ge(r)?r:n.loadRoot+r).then(r=>{e(o(t,r,s))}).catch(i)}else e(o(t,r,s))});return i(a),a}function h(t,r,s,o=!1){function a(t,r,i){let s=e.makeProgram(r,i);return n.shaders[t]=s,s}l(a,"loadRawShader");let u=new Promise((e,i)=>{if(!r&&!s)return i("no shader");function u(e){return e?fetch(n.loadRoot+e).then(t=>{if(t.ok)return t.text();throw new Error(`failed to load ${e}`)}).catch(i):new Promise(e=>e(null))}if(l(u,"resolveUrl"),o)Promise.all([u(r),u(s)]).then(([r,n])=>{e(a(t,r,n))}).catch(i);else try{e(a(t,r,s))}catch(h){i(h)}});return i(u),u}function c(e,r){let s=n.loadRoot+r,o=new Promise((i,o)=>{if(!r)return o(`expected sound src for "${e}"`);"string"==typeof r&&fetch(s).then(e=>{if(e.ok)return e.arrayBuffer();throw new Error(`failed to load ${s}`)}).then(e=>new Promise((r,n)=>{t.ctx().decodeAudioData(e,r,n)})).then(t=>{n.sounds[e]=t,i(t)}).catch(o)});return i(o),o}function d(){return n.fonts[ve]}return l(i,"addLoader"),l(s,"loadProgress"),l(o,"loadRoot"),l(a,"loadFont"),l(u,"loadSprite"),l(h,"loadShader"),l(c,"loadSound"),l(d,"defFont"),a(ve,de,8,8),{loadRoot:o,loadSprite:u,loadSound:c,loadFont:a,loadShader:h,loadProgress:s,addLoader:i,defFont:d,sprites:n.sprites,fonts:n.fonts,sounds:n.sounds,shaders:n.shaders}}var we,ve,xe=h(()=>{U(),me(),we=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",ve="unscii",l(pe,"loadImg"),l(ge,"isDataUrl"),l(ye,"assetsInit")});function be(e,t,r={max:8}){var n;let i=[],s=null!=(n=r.max)?n:8;function o(){i.length>s&&(i=i.slice(0,s));let r=w(0,e.height());i.forEach((n,i)=>{let o=g(i,0,s,1,.5),a=g(i,0,s,.8,.2),u=(()=>{switch(n.type){case"info":return E(1,1,1,o);case"error":return E(1,0,.5,o)}})(),l=e.fmtText(n.msg,t.defFont(),{pos:r,origin:"botleft",color:u,size:ke/e.scale(),width:e.width()});e.drawRect(r,l.width,l.height,{origin:"botleft",color:E(0,0,0,a)}),e.drawFmtText(l),r.y-=l.height})}function a(e){console.error(e),i.unshift({type:"error",msg:e})}function u(e){i.unshift({type:"info",msg:e})}function h(){i=[]}return l(o,"draw"),l(a,"error"),l(u,"info"),l(h,"clear"),{info:u,error:a,draw:o,clear:h}}var ke,Re=h(()=>{U(),ke=16,l(be,"loggerInit")});function Ae(e){let t={},r=[],n=null;function i(){return null!==n&&1===n.readyState}function s(){let i=new WebSocket(e);return new Promise((s,o)=>{i.onopen=(()=>{s(i),n=i;for(let e of r)i.send(e)}),i.onerror=(()=>{o(`failed to connect to ${e}`)}),i.onmessage=(e=>{let r=JSON.parse(e.data);if(t[r.type])for(let n of t[r.type])n(r.data,r.id)})})}function o(e,r){t[e]||(t[e]=[]),t[e].push(r)}function a(e,t){let i=JSON.stringify({type:e,data:t});n?n.send(i):r.push(i)}function u(){n&&n.close()}return l(i,"connected"),l(s,"connect"),l(o,"recv"),l(a,"send"),l(u,"close"),{connect:s,close:u,connected:i,recv:o,send:a}}var Pe=h(()=>{l(Ae,"netInit")}),Ee=c((e,t)=>{U(),te(),ie(),fe(),xe(),Re(),Pe(),t.exports=((e={width:640,height:480,scale:1,fullscreen:!1,debug:!1,crisp:!1,canvas:null,connect:null,logMax:8,root:document.body})=>{let t=ne({width:e.width,height:e.height,scale:e.scale,fullscreen:e.fullscreen,crisp:e.crisp,canvas:e.canvas,root:e.root}),r=J(t.gl,{clearColor:e.clearColor?E(e.clearColor):void 0,scale:e.scale,texFilter:e.texFilter}),n=se(),i=ye(r,n,{errHandler:e=>{s.error(e)}}),s=be(r,i,{max:e.logMax}),o=(()=>e.connect?Ae(e.connect):null)();function h(e,t){if(!o)throw new Error("not connected to any websockets");o.recv(e,(e,r)=>{try{t(e,r)}catch(n){s.error(n)}})}function c(e,t){if(!o)throw new Error("not connected to any websockets");o.send(e,t)}function x(){return t.dt()*tt.timeScale}function b(e,t={}){let r=i.sounds[e];if(!r)throw new Error(`sound not found: "${e}"`);return n.play(r,t)}function k(e){var t;let r=z();return!(null==(t=r.layers[null!=e?e:r.defLayer])?void 0:t.noCam)}function R(e){return k(e)?z().cam.mpos:t.mousePos()}function A(e,t={}){var n;let s=(()=>"string"==typeof e?i.sprites[e]:e)();if(!s)throw new Error(`sprite not found: "${e}"`);let o=s.frames[null!=(n=t.frame)?n:0];r.drawTexture(s.tex,u(a({},t),{quad:o}))}function O(e,t={}){var n;let s=null!=(n=t.font)?n:ve,o=i.fonts[s];if(!o)throw new Error(`font not found: ${s}`);r.drawText(e,o,t)}l(h,"recv"),l(c,"send"),l(x,"dt"),l(b,"play"),l(k,"isCamLayer"),l(R,"mousePos"),l(A,"drawSprite"),l(O,"drawText");let j=980,Y="topleft",N={loaded:!1,scenes:{},curScene:null,nextScene:null};function U(e,t){N.scenes[e]={init:t,initialized:!1,events:{add:[],update:[],draw:[],destroy:[],keyDown:[],keyPress:[],keyPressRep:[],keyRelease:[],mouseClick:[],mouseRelease:[],mouseDown:[],charInput:[]},action:[],render:[],objs:new Map,lastObjID:0,timers:{},lastTimerID:0,cam:{pos:w(r.width()/2,r.height()/2),scale:w(1,1),angle:0,shake:0,mpos:w(0),matrix:T()},layers:{},defLayer:null,gravity:j,data:{}}}function z(){return N.scenes[N.curScene]}function H(){return z().data}function G(){we("`",()=>{tt.showLog=!tt.showLog,s.info(`show log: ${tt.showLog?"on":"off"}`)}),we("f1",()=>{tt.inspect=!tt.inspect,s.info(`inspect: ${tt.inspect?"on":"off"}`)}),we("f2",()=>{tt.clearLog()}),we("f8",()=>{tt.paused=!tt.paused,s.info(`${tt.paused?"paused":"unpaused"}`)}),we("f7",()=>{tt.timeScale=m(tt.timeScale-.2,0,2),s.info(`time scale: ${tt.timeScale.toFixed(1)}`)}),we("f9",()=>{tt.timeScale=m(tt.timeScale+.2,0,2),s.info(`time scale: ${tt.timeScale.toFixed(1)}`)}),we("f10",()=>{tt.stepFrame(),s.info("stepped frame")})}function V(e,...t){N.nextScene={name:e,args:[...t]}}function K(t,...r){W(t),N.curScene=t;let n=N.scenes[t];if(!n)throw new Error(`scene not found: '${t}'`);if(!n.initialized){try{n.init(...r)}catch(i){s.error(i.stack)}e.debug&&G(),n.initialized=!0}}function W(e){if(!N.scenes[e])throw new Error(`scene not found: '${e}'`);U(e,N.scenes[e].init)}function Q(e,t){let r=z();!r||(e.forEach((e,t)=>{r.layers[e]={alpha:1,order:t+1,noCam:!1}}),t&&(r.defLayer=t))}function Z(...e){let t=z().cam;return e.length>0&&(t.pos=w(...e)),t.pos.clone()}function $(...e){let t=z().cam;return e.length>0&&(t.scale=w(...e)),t.scale.clone()}function ee(e){let t=z().cam;return void 0!==e&&(t.angle=e),t.angle}function te(e){z().cam.shake=e}function re(e){let t=z();e.forEach(e=>{t.layers[e]&&(t.layers[e].noCam=!0)})}function ie(e){let t={hidden:!1,paused:!1,_tags:[],_id:null,_events:{add:[],update:[],draw:[],destroy:[],inspect:[]},use(e){if(void 0===e)return;let t=typeof e;if("string"!==t){if("object"!==t)throw new Error(`invalid comp type: ${t}`);if(Array.isArray(e))for(let t of e)this.use(t);else for(let t in e)"function"!=typeof e[t]?this[t]=e[t]:this._events[t]?this._events[t].push(e[t].bind(this)):this[t]=e[t].bind(this)}else this._tags.push(e)},exists(){return void 0!==this._id},is(e){if("*"===e)return!0;if(Array.isArray(e)){for(let t of e)if(!this._tags.includes(t))return!1;return!0}return this._tags.includes(e)},on(e,t){this._events[e]||(this._events[e]=[]),this._events[e].push(t)},action(e){this.on("update",e)},trigger(e,...t){if(this._events[e])for(let n of this._events[e])n.call(this,...t);let r=z().events[e];if(r)for(let n of r)this.is(n.tag)&&n.cb(this,...t)},rmTag(e){let t=this._tags.indexOf(e);t>-1&&this._tags.splice(t,1)}};t.use(e);let r=z(),n=r.lastObjID++;r.objs.set(n,t),t._id=n,t.trigger("add");for(let i of r.events.add)t.is(i.tag)&&i.cb(t);return t}function oe(e){if(!e.exists())return;let t=z();t.objs.delete(e._id);let r=t.lastObjID++;return t.objs.set(r,e),e._id=r,e}function ae(e,t,r){let n=z();n.events[e]||(n.events[e]=[]),n.events[e].push({tag:t,cb:r})}function ue(e,t){"function"==typeof e&&void 0===t?z().action.push(e):"string"==typeof e&&ae("update",e,t)}function le(e,t){"function"==typeof e&&void 0===t?z().render.push(e):"string"==typeof e&&ae("update",e,t)}function he(e,t,r){ue(e,e=>{e._checkCollisions(t,t=>{r(e,t)})})}function ce(e,t,r){ue(e,e=>{e._checkOverlaps(t,t=>{r(e,t)})})}function de(e,t){ue(e,e=>{e.isClicked()&&t(e)})}function fe(e,t){return new Promise(r=>{let n=z();n.timers[n.lastTimerID++]={time:e,cb:()=>{t&&t(),r()}}})}function me(e,t){let r=!1,n=l(()=>{r||(t(),fe(e,n))},"newF");return n(),{stop(){r=!0}}}function pe(e,t,r){if(Array.isArray(t))for(let n of t)pe(e,n,r);else z().events[e].push({key:t,cb:r})}function ge(e,t){pe("keyDown",e,t)}function we(e,t){pe("keyPress",e,t)}function xe(e,t){pe("keyPressRep",e,t)}function ke(e,t){pe("keyRelease",e,t)}function Re(e){z().events.charInput.push({cb:e})}function Pe(e){z().events.mouseDown.push({cb:e})}function Ee(e){z().events.mouseClick.push({cb:e})}function Se(e){z().events.mouseRelease.push({cb:e})}function Te(e){let t=z(),r=[...t.objs.values()].sort((e,r)=>{var n,i,s,o,a,u;return(null!=(s=null==(i=t.layers[null!=(n=e.layer)?n:t.defLayer])?void 0:i.order)?s:0)-(null!=(u=null==(a=t.layers[null!=(o=r.layer)?o:t.defLayer])?void 0:a.order)?u:0)});return e?r.filter(t=>t.is(e)):r}function _e(e,t){"function"==typeof e&&void 0===t?Te().forEach(e):"string"==typeof e&&Te(e).forEach(t)}function De(e,t){"function"==typeof e&&void 0===t?Te().reverse().forEach(e):"string"==typeof e&&Te(e).reverse().forEach(t)}function Fe(e){if(!e.exists())return;let t=z();!t||(e.trigger("destroy"),t.objs.delete(e._id),delete e._id)}function Me(e){_e(e,e=>{Fe(e)})}function Ie(e){let t=z();return void 0!==e&&(t.gravity=e),t.gravity}function Le(e){let n=z();if(!n)throw new Error(`scene not found: '${N.curScene}'`);let i=e||!tt.paused;if(i)for(let t in n.timers){let e=n.timers[t];e.time-=x(),e.time<=0&&(e.cb(),delete n.timers[t])}if(De(e=>{!e.paused&&i&&e.trigger("update")}),i)for(let t of n.action)t();let s=w(r.width(),r.height()),o=n.cam,a=v(M(0,2*Math.PI)).scale(o.shake);o.shake=p(o.shake,0,5*x()),o.matrix=T().translate(s.scale(.5)).scale(o.scale).rotateZ(o.angle).translate(s.scale(-.5)).translate(o.pos.scale(-1).add(s.scale(.5)).add(a)),o.mpos=o.matrix.invert().multVec2(t.mousePos()),_e(e=>{e.hidden||(r.pushTransform(),k(e.layer)&&r.pushMatrix(o.matrix),e.trigger("draw"),r.popTransform())});for(let t of n.render)t()}function Ce(){let e=z();for(let r of e.events.charInput)t.charInputted().forEach(r.cb);for(let r of e.events.keyDown)t.keyDown(r.key)&&r.cb();for(let r of e.events.keyPress)t.keyPressed(r.key)&&r.cb();for(let r of e.events.keyPressRep)t.keyPressedRep(r.key)&&r.cb();for(let r of e.events.keyRelease)t.keyReleased(r.key)&&r.cb();for(let r of e.events.mouseDown)t.mouseDown()&&r.cb();for(let r of e.events.mouseClick)t.mouseClicked()&&r.cb();for(let r of e.events.mouseRelease)t.mouseReleased()&&r.cb()}function qe(){var n;let s=z(),o=null,a=i.defFont(),u=E(null!=(n=e.inspectColor)?n:[0,1,1,1]);function h(e,t,n){let i=w(4).scale(1/n),s=r.fmtText(t,a,{size:12/n,pos:e.add(w(i.x,i.y))});r.drawRect(e,s.width+2*i.x,s.height+2*i.x,{color:E(0,0,0,1)}),r.drawFmtText(s)}function c(e,t){let n=k(e.layer),i=r.scale()*(n?(s.cam.scale.x+s.cam.scale.y)/2:1);n&&(r.pushTransform(),r.pushMatrix(s.cam.matrix)),t(i),n&&r.popTransform()}l(h,"drawInspectTxt"),l(c,"drawObj"),De(e=>{!e.area||e.hidden||c(e,t=>{o||e.isHovered()&&(o=e);let n=(o===e?6:2)/t,i=e._worldArea(),s=i.p2.x-i.p1.x,a=i.p2.y-i.p1.y;r.drawRectStroke(i.p1,s,a,{width:n,color:u})})}),o&&c(o,e=>{let t=R(o.layer),r=[];for(let n of o._tags)r.push(`"${n}"`);for(let n of o._events.inspect){let e=n();for(let t in e)r.push(`${t}: ${e[t]}`)}h(t,r.join("\n"),e)}),h(w(0),t.fps()+"",r.scale())}function Be(e,...n){t.run(()=>{if(r.frameStart(),N.loaded){try{if(!z())throw new Error(`scene not found: '${N.curScene}'`);Ce(),Le(),tt.inspect&&qe()}catch(a){s.error(a.stack),t.quit()}tt.showLog&&s.draw(),N.nextScene&&(K.apply(null,[N.nextScene.name,...N.nextScene.args]),N.nextScene=null)}else{let t=i.loadProgress();if(1===t)N.loaded=!0,K(e,...n),o&&o.connect().catch(s.error);else{let e=r.width()/2,n=24/r.scale(),i=w(r.width()/2,r.height()/2).sub(w(e/2,n/2));r.drawRect(w(0),r.width(),r.height(),{color:P(0,0,0)}),r.drawRectStroke(i,e,n,{width:4/r.scale()}),r.drawRect(i,e*t,n)}}r.frameEnd()})}function Oe(...e){return{pos:w(...e),move(...e){let t=w(...e),r=t.x*x(),n=t.y*x();this.pos.x+=r,this.pos.y+=n},inspect(){return{pos:`(${~~this.pos.x}, ${~~this.pos.y})`}}}}function je(...e){return 0===e.length?je(1):{scale:w(...e),flipX(e){this.scale.x=Math.sign(e)*Math.abs(this.scale.x)},flipY(e){this.scale.y=Math.sign(e)*Math.abs(this.scale.y)}}}function Ye(e){return{angle:null!=e?e:0}}function Ne(...e){return{color:E(...e)}}function Ue(e){return{origin:e}}function ze(e){return{layer:e,inspect(){var e;let t=z();return{layer:null!=(e=this.layer)?e:t.defLayer}}}}function He(e,t){var r,n;let i=z();return(null!=(r=e.layer)?r:i.defLayer)===(null!=(n=t.layer)?n:i.defLayer)}function Xe(e,r){let n={},i={};return{area:{p1:e,p2:r},areaWidth(){let{p1:e,p2:t}=this._worldArea();return t.x-e.x},areaHeight(){let{p1:e,p2:t}=this._worldArea();return t.y-e.y},isClicked(){return t.mouseClicked()&&this.isHovered()},isHovered(){return this.hasPt(R(this.layer))},isCollided(e){if(!e.area||!He(this,e))return!1;return C(this._worldArea(),e._worldArea())},isOverlapped(e){if(!e.area||!He(this,e))return!1;return q(this._worldArea(),e._worldArea())},clicks(e){this.action(()=>{this.isClicked()&&e()})},hovers(e){this.action(()=>{this.isHovered()&&e()})},collides(e,t){this.action(()=>{this._checkCollisions(e,t)})},overlaps(e,t){this.action(()=>{this._checkOverlaps(e,t)})},hasPt(e){let t=this._worldArea();return B({p1:t.p1,p2:t.p2},e)},resolve(){let e=[];return _e(t=>{if(t===this||!t.solid||!t.area||!He(this,t))return;let r=this._worldArea(),n=t._worldArea();if(!C(r,n))return;let i=r.p2.x-n.p1.x,s=n.p2.x-r.p1.x,o=r.p2.y-n.p1.y,a=n.p2.y-r.p1.y,u=Math.min(i,s,o,a),l=(()=>{switch(u){case i:return this.pos.x-=i,"right";case s:return this.pos.x+=s,"left";case o:return this.pos.y-=o,"bottom";case a:return this.pos.y+=a,"top"}})();e.push({obj:t,side:l})}),e},_checkCollisions(e,t){_e(e,e=>{this!==e&&(n[e._id]||this.isCollided(e)&&(t(e),n[e._id]=e))});for(let r in n){let e=n[r];this.isCollided(e)||delete n[r]}},_checkOverlaps(e,t){_e(e,e=>{this!==e&&(i[e._id]||this.isOverlapped(e)&&(t(e),i[e._id]=e))});for(let r in i){let e=i[r];this.isOverlapped(e)||delete i[r]}},_worldArea(){let e=this.area,t=this.pos||w(0),r=this.scale||w(1),n=t.add(e.p1.dot(r)),i=t.add(e.p2.dot(r));return{p1:w(Math.min(n.x,i.x),Math.min(n.y,i.y)),p2:w(Math.max(n.x,i.x),Math.max(n.y,i.y))}}}}function Je(e,t,r){let n=w(e,t),i=X(r||Y).dot(n).scale(-.5);return Xe(i.sub(n.scale(.5)),i.add(n.scale(.5)))}function Ge(e,t={}){let r=i.sprites[e];if(!r)throw new Error(`sprite not found: "${e}"`);let n=a({},r.frames[0]);t.quad&&(n.x+=t.quad.x*n.w,n.y+=t.quad.y*n.h,n.w*=t.quad.w,n.h*=t.quad.h);let s=r.tex.width*n.w,o=r.tex.height*n.h,u=null;return{width:s,height:o,animSpeed:t.animSpeed||.1,frame:t.frame||0,quad:t.quad||S(0,0,1,1),add(){!this.area&&!t.noArea&&this.use(Je(this.width,this.height,this.origin))},draw(){z(),r.frames[this.frame];A(r,{pos:this.pos,scale:this.scale,rot:this.angle,color:this.color,frame:this.frame,origin:this.origin,quad:this.quad,prog:i.shaders[this.shader],uniform:this.uniform})},update(){if(!u)return;let e=r.anims[u.name];u.timer+=x(),u.timer>=this.animSpeed&&(this.frame++,this.frame>e.to&&(u.loop?this.frame=e.from:(this.frame--,this.stop())),u&&(u.timer-=this.animSpeed))},play(e,t=!0){let n=r.anims[e];if(!n)throw new Error(`anim not found: ${e}`);u&&this.stop(),u={name:e,loop:t,timer:0},this.frame=n.from,this.trigger("animPlay",e)},stop(){if(!u)return;let e=u.name;u=null,this.trigger("animEnd",e)},changeSprite(e){if(!(r=i.sprites[e]))throw new Error(`sprite not found: "${e}"`);let n=a({},r.frames[0]);t.quad&&(n.x+=t.quad.x*n.w,n.y+=t.quad.y*n.h,n.w*=t.quad.w,n.h*=t.quad.h),this.width=r.tex.width*n.w,this.height=r.tex.height*n.h,this.area&&!t.noArea&&this.use(Je(this.width,this.height,this.origin)),u=null,this.frame=0},numFrames:()=>r.frames.length,curAnim:()=>null==u?void 0:u.name,inspect(){let e={};return u&&(e.curAnim=`"${u.name}"`),e}}}function Ve(e,t,n={}){return{text:e,textSize:t,font:n.font,width:0,height:0,add(){var e,t,s;if(!this.area&&!n.noArea){z();let o=i.fonts[null!=(e=this.font)?e:ve],a=r.fmtText(this.text+"",o,{pos:this.pos,scale:this.scale,rot:this.angle,size:this.textSize,origin:this.origin,color:this.color,width:n.width});this.width=a.width/((null==(t=this.scale)?void 0:t.x)||1),this.height=a.height/((null==(s=this.scale)?void 0:s.y)||1),this.use(Je(this.width,this.height,this.origin))}},draw(){var e;z();let t=i.fonts[null!=(e=this.font)?e:ve],s=r.fmtText(this.text+"",t,{pos:this.pos,scale:this.scale,rot:this.angle,size:this.textSize,origin:this.origin,color:this.color,width:n.width});this.width=s.width,this.height=s.height,r.drawFmtText(s)}}}function Ke(e,t,n={}){return{width:e,height:t,add(){!this.area&&!n.noArea&&this.use(Je(this.width,this.height,this.origin))},draw(){z();r.drawRect(this.pos,this.width,this.height,{scale:this.scale,rot:this.angle,color:this.color,origin:this.origin,prog:i.shaders[this.shader],uniform:this.uniform})}}}function We(){return{solid:!0}}l(U,"scene"),l(z,"curScene"),l(H,"sceneData"),l(G,"regDebugInputs"),l(V,"go"),l(K,"goSync"),l(W,"reload"),l(Q,"layers"),l(Z,"camPos"),l($,"camScale"),l(ee,"camRot"),l(te,"camShake"),l(re,"camIgnore"),l(ie,"add"),l(oe,"readd"),l(ae,"on"),l(ue,"action"),l(le,"render"),l(he,"collides"),l(ce,"overlaps"),l(de,"clicks"),l(fe,"wait"),l(me,"loop"),l(pe,"pushKeyEvent"),l(ge,"keyDown"),l(we,"keyPress"),l(xe,"keyPressRep"),l(ke,"keyRelease"),l(Re,"charInput"),l(Pe,"mouseDown"),l(Ee,"mouseClick"),l(Se,"mouseRelease"),l(Te,"get"),l(_e,"every"),l(De,"revery"),l(Fe,"destroy"),l(Me,"destroyAll"),l(Ie,"gravity"),l(Le,"gameFrame"),l(Ce,"handleEvents"),l(qe,"drawInspect"),l(Be,"start"),l(Oe,"pos"),l(je,"scale"),l(Ye,"rotate"),l(Ne,"color"),l(Ue,"origin"),l(ze,"layer"),l(He,"isSameLayer"),l(Xe,"area"),l(Je,"getAreaFromSize"),l(Ge,"sprite"),l(Ve,"text"),l(Ke,"rect"),l(We,"solid");let Qe=960,Ze=480;function $e(e={}){var t,r;let n=0,i=null,s=null,o=null!=(t=e.maxVel)?t:Qe;return{jumpForce:null!=(r=e.jumpForce)?r:Ze,update(){this.move(0,n);let e=this.resolve(),t=!1;if(i&&(i.exists()&&this.isCollided(i)?s&&(this.pos=this.pos.add(i.pos.sub(s)),s=i.pos.clone()):(i=null,s=null,t=!0)),!i){n=Math.min(n+Ie()*x(),o);for(let r of e)"bottom"===r.side&&n>0?(i=r.obj,n=0,s=i.pos.clone(),t||this.trigger("grounded",i)):"top"===r.side&&n<0&&(n=0,this.trigger("headbump",r.obj))}},curPlatform:()=>i,grounded:()=>null!==i,falling:()=>n>0,jump(e){i=null,n=-e||-this.jumpForce}}}function et(e,t={}){i.shaders[e];return{shader:e,uniform:t}}l($e,"body"),l(et,"shader");let tt={paused:!1,inspect:!1,timeScale:1,showLog:!0,fps:t.fps,objCount:()=>z().objs.size,stepFrame(){Le(!0)},drawCalls:r.drawCalls,clearLog:s.clear,log:s.info,error:s.error};function rt(e,t){let r=[],n=w(t.pos||0),i=0,s={getPos(...e){let r=w(...e);return w(n.x+r.x*t.width,n.y+r.y*t.height)},spawn(e,i){let s=(()=>{if(Array.isArray(e))return e;if(t[e]){if("function"==typeof t[e])return t[e]();if(Array.isArray(t[e]))return[...t[e]]}else if(t.any)return t.any(e)})();if(!s)return;s.push(Oe(n.x+i.x*t.width,n.y+i.y*t.height));let o=ie(s);return r.push(o),o.use({gridPos:i.clone(),setGridPos(e){this.gridPos=e.clone(),this.pos=w(n.x+this.gridPos.x*t.width,n.y+this.gridPos.y*t.height)},moveLeft(){this.setGridPos(this.gridPos.add(w(-1,0)))},moveRight(){this.setGridPos(this.gridPos.add(w(1,0)))},moveUp(){this.setGridPos(this.gridPos.add(w(0,-1)))},moveDown(){this.setGridPos(this.gridPos.add(w(0,1)))}}),o},width:()=>i*t.width,height:()=>e.length*t.height,destroy(){for(let e of r)Fe(e)}};return e.forEach((e,t)=>{let r=e.split("");i=Math.max(r.length,i),r.forEach((e,r)=>{s.spawn(e,w(r,t))})}),s}l(rt,"addLevel");let nt={start:Be,loadRoot:i.loadRoot,loadSprite:i.loadSprite,loadSound:i.loadSound,loadFont:i.loadFont,loadShader:i.loadShader,addLoader:i.addLoader,width:r.width,height:r.height,dt:x,time:t.time,screenshot:t.screenshot,scene:U,go:V,sceneData:H,layers:Q,camPos:Z,camScale:$,camRot:ee,camShake:te,camIgnore:re,gravity:Ie,add:ie,readd:oe,destroy:Fe,destroyAll:Me,get:Te,every:_e,revery:De,send:c,recv:h,pos:Oe,scale:je,rotate:Ye,color:Ne,origin:Ue,layer:ze,area:Xe,sprite:Ge,text:Ve,rect:Ke,solid:We,body:$e,shader:et,on:ae,action:ue,render:le,collides:he,overlaps:ce,clicks:de,keyDown:ge,keyPress:we,keyPressRep:xe,keyRelease:ke,charInput:Re,mouseDown:Pe,mouseClick:Ee,mouseRelease:Se,mousePos:R,cursor:t.cursor,keyIsDown:t.keyDown,keyIsPressed:t.keyPressed,keyIsPressedRep:t.keyPressedRep,keyIsReleased:t.keyReleased,mouseIsDown:t.mouseDown,mouseIsClicked:t.mouseClicked,mouseIsReleased:t.mouseReleased,loop:me,wait:fe,play:b,volume:n.volume,makeRng:D,rand:M,randSeed:F,vec2:w,rgb:P,rgba:E,quad:S,choose:L,chance:I,lerp:p,map:g,mapc:y,wave:_,deg2rad:d,rad2deg:f,drawSprite:A,drawText:O,drawRect:r.drawRect,drawRectStroke:r.drawRectStroke,drawLine:r.drawLine,debug:tt,addLevel:rt};if(e.plugins)for(let a of e.plugins){let e=a(nt);for(let t in e)nt[t]=e[t]}if(e.global)for(let a in nt)window[a]=nt[a];return nt})}),Se=Ee();exports.default=Se;
},{}],"c3M1":[function(require,module,exports) {
"use strict";var t;Object.defineProperty(exports,"__esModule",{value:!0}),exports.CMDS=void 0,function(t){t.PLAYER_DIE="D",t.PLAYER_MOVE="M",t.PLAYER_STOP="S",t.BOMB_SPAWN="B",t.BOMB_EXPLODE="X"}(t=exports.CMDS||(exports.CMDS={}));var e=.1,i=function(){function i(t,e){return void 0===e&&(e=!1),this.k=t,this.enabled=e,this.lastUpdate=-10,this}return i.prototype.send=function(i,s){if(void 0===s&&(s={}),this.enabled){if(i===t.PLAYER_MOVE){var n=this.k.time();if(n-this.lastUpdate<e)return;this.lastUpdate=n}this.k.send(i,s)}},i.prototype.on=function(t,e){this.enabled&&this.k.recv(t,e)},i}();exports.default=i;
},{}],"hRpI":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.network=exports.debug=exports.k=void 0;var t=e(require("kaboom")),o=e(require("./model/Network")),r=new URLSearchParams(location.search),s="true"===r.get("mp"),u=r.has("debug");function l(e){u&&exports.k.debug.log(e)}exports.k=(0,t.default)({clearColor:[0,0,0,1],fullscreen:!0,width:320,height:240,scale:1.5,debug:u,connect:s?location.protocol.replace("http","ws")+"//"+location.host:null}),u&&(exports.k.debug.inspect=!0),exports.debug=l,exports.network=new o.default(exports.k),exports.default=exports.k;
},{"kaboom":"tp4l","./model/Network":"c3M1"}],"UL96":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.PLAYER_TYPES=exports.POWERUPS=exports.DEFAULT_VOL=exports.LOCALSTORAGE_KEYS=exports.MUSIC_HURRY_DETUNE=exports.MUSIC_HURRY_SPEED=exports.ENEMY_SPEED=exports.WALK_SPEED=exports.BOMB_SPEED=exports.DIRS=exports.DOWN=exports.UP=exports.RIGHT=exports.LEFT=exports.IDLE=exports.COLORS=exports.YELLOW=exports.RED=exports.GREEN=exports.BLUE=exports.BLACK=exports.LIGHTGRAY=exports.DARKGRAY=exports.WHITE=exports.DEFAULT_GAME_TIME=exports.HEAVY_GRAVITY=exports.GRAVITY=exports.MAP_HEIGHT_PIXELS=exports.MAP_HEIGHT=exports.MAP_WIDTH_PIXELS=exports.MAP_WIDTH=exports.GRID_PIXEL_SIZE=void 0;var t,o=e(require("./kaboom")),r=o.default.rgb,E=o.default.vec2;exports.GRID_PIXEL_SIZE=32,exports.MAP_WIDTH=15,exports.MAP_WIDTH_PIXELS=exports.MAP_WIDTH*exports.GRID_PIXEL_SIZE,exports.MAP_HEIGHT=13,exports.MAP_HEIGHT_PIXELS=exports.MAP_HEIGHT*exports.GRID_PIXEL_SIZE,exports.GRAVITY=300,exports.HEAVY_GRAVITY=1600,exports.DEFAULT_GAME_TIME=180,exports.WHITE=r(1,1,1),exports.DARKGRAY=r(.25,.25,.25),exports.LIGHTGRAY=r(.5,.5,.5),exports.BLACK=r(0,0,0),exports.BLUE=r(.39,.47,.937),exports.GREEN=r(.223,.517,0),exports.RED=r(1,0,0),exports.YELLOW=r(1,1,0),exports.COLORS={WHITE:exports.WHITE,DARKGRAY:exports.DARKGRAY,LIGHTGRAY:exports.LIGHTGRAY,BLACK:exports.BLACK,BLUE:exports.BLUE,GREEN:exports.GREEN,RED:exports.RED,YELLOW:exports.YELLOW},exports.IDLE=E(0,0),exports.LEFT=E(-1,0),exports.RIGHT=E(1,0),exports.UP=E(0,-1),exports.DOWN=E(0,1),exports.DIRS={IDLE:exports.IDLE,LEFT:exports.LEFT,RIGHT:exports.RIGHT,UP:exports.UP,DOWN:exports.DOWN},exports.BOMB_SPEED=175,exports.WALK_SPEED=120,exports.ENEMY_SPEED=60,exports.MUSIC_HURRY_SPEED=1.75,exports.MUSIC_HURRY_DETUNE=-600,function(e){e.SFX_VOL="sfx_vol",e.MUS_VOL="mus_vol"}(t=exports.LOCALSTORAGE_KEYS||(exports.LOCALSTORAGE_KEYS={})),exports.DEFAULT_VOL="50",exports.POWERUPS={RADIUS:0,QUANTITY:2,SPEED:3,KICK:4,TIME:14,P_BOMB:15},exports.PLAYER_TYPES=["bomberman-tiny","daisy","luigi","mario","peach","toad","toadsworth","wario"];
},{"./kaboom":"hRpI"}],"BHXf":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.vec2floor=exports.snapToGrid=exports.getMusVol=exports.getSfxVol=exports.getOverlapped=exports.getAtPos=exports.findMapItem=exports.findMapItems=exports.convertMapPosToCoord=void 0;var r=require("./kaboom"),e=require("./types"),t=r.k.get,o=r.k.vec2;function n(r,e){var o=r.x,n=r.y;return t(e).filter(function(r){return!!r.pos&&(o>=r.pos.x&&o<=r.pos.x+r.width&&n>=r.pos.y&&n<=r.pos.y+r.height)})}function p(r,e){return t(e).filter(function(e){return e.area&&e.isOverlapped(r)})}function s(r,e){var t=[];return r.forEach(function(r,n){var p=-1;do{(p=r.indexOf(e,p+1))>=0&&t.push(o(p,n))}while(p>=0)}),t}function u(r,e){var t=s(r,e);return t.length?t[0]:void 0}function a(r){var t=r.x,n=r.y;return o(t*e.GRID_PIXEL_SIZE,(n+1)*e.GRID_PIXEL_SIZE)}function i(r){var t=r.x,n=r.y,p=t%e.GRID_PIXEL_SIZE,s=n%e.GRID_PIXEL_SIZE;return o(Math.round(t-p+(p<=e.GRID_PIXEL_SIZE/2?0:e.GRID_PIXEL_SIZE)),Math.round(n-s+(s<=e.GRID_PIXEL_SIZE/2?0:e.GRID_PIXEL_SIZE)))}function I(r){var e=r.x,t=r.y;return o(Math.floor(e),Math.floor(t))}function f(r){var t;return parseInt(null!==(t=localStorage[r])&&void 0!==t?t:e.DEFAULT_VOL)/100}exports.getAtPos=n,exports.getOverlapped=p,exports.findMapItems=s,exports.findMapItem=u,exports.convertMapPosToCoord=a,exports.snapToGrid=i,exports.vec2floor=I;var x=function(){return f(e.LOCALSTORAGE_KEYS.SFX_VOL)};exports.getSfxVol=x;var v=function(){return f(e.LOCALSTORAGE_KEYS.MUS_VOL)};exports.getMusVol=v;
},{"./kaboom":"hRpI","./types":"UL96"}],"hsLw":[function(require,module,exports) {
"use strict";var o=this&&this.__spreadArray||function(o,e,t){if(t||2===arguments.length)for(var i,n=0,r=e.length;n<r;n++)!i&&n in e||(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return o.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../model/Network"),t=require("../kaboom"),i=require("../util"),n=require("../types"),r=t.k.add,s=t.k.area,a=t.k.destroy,u=t.k.dt,c=t.k.get,p=t.k.origin,l=t.k.play,d=t.k.pos,h=t.k.rotate,f=t.k.scale,b=t.k.sprite,m=t.k.time,v=t.k.vec2,E=t.k.wait;function I(){var o=1,e=1,i=0,r=!1,s=!1,a=0,u=v(0,0);return{setRadius:function(e){return o=e},getRadius:function(){return o},canSpawnBomb:function(){return i<e&&this.isAlive()},decBombCnt:function(){return--i},incBombCnt:function(){return++i},canBombKick:function(){return r},canPBomb:function(){return s},spawnBomb:function(){if(!this.isDead()){var o=m(),e=this.pos.clone();if(!(o-a<.3&&e.eq(u))){a=o,u=e;var i=this.spawnBombAtPos(this.pos.add(this.area.p1).add(v(0,2)));return i&&t.k.readd(this),i}this.spawnPBomb(),a=0}},spawnBombAtPos:P,spawnPBomb:x,bombPowerup:function(i){i===n.POWERUPS.RADIUS?(o=o<9?o+1:9,(0,t.debug)("Sweet, your bomb radius is now "+o+"!")):i===n.POWERUPS.QUANTITY?(e=e<9?e+1:9,(0,t.debug)("Sweet, you can now drop "+e+" bombs!")):i===n.POWERUPS.KICK?(r=!0,(0,t.debug)("Kickin' the can!")):i===n.POWERUPS.P_BOMB&&(s=!0,(0,t.debug)("Sweet, let it all out!"))},kickBomb:function(o){if(this.canBombKick()){var e=.4*n.GRID_PIXEL_SIZE,i=o.pos.sub(this.pos);o.moving=i.x>e?n.RIGHT:i.x<-e?n.LEFT:i.y>e?n.DOWN:i.y<-e?n.UP:n.IDLE,(0,t.debug)("Kick bomb: "+o.moving.x+","+o.moving.y)}}}}function g(c){var m=3;return{update:function(){if(!this.paused){if((m-=u())<0)l("explosion",{volume:(0,i.getSfxVol)()}),this.explode();else if(m<=1&&(!this.moving||this.moving.eq(n.IDLE))){var o=Math.floor(m%1*10)%2==0;this.scale=2+(o?.05:0)}if(this.moving&&!this.moving.eq(n.IDLE)){var e=this.moving,t=e.x+e.y<0?.5:1.1;(0,i.getAtPos)(this.pos.add(this.moving.scale(n.GRID_PIXEL_SIZE*t))).some(function(o){return!!o.is("solid")||(!!o.is("player")||(!!o.is("enemy")||void(o.is("powerup")&&a(o))))})?(this.pos=(0,i.snapToGrid)(this.pos),this.moving=n.IDLE):this.move(this.moving.scale(n.BOMB_SPEED))}if(!this.solid)(0,i.getOverlapped)(this,"player").length||(this.solid=!0,this.use("solid"))}},remove:function(){a(this),c.decBombCnt()},explode:function(){a(this);var u=v(-14,-14),l=v(14,14),m=(0,i.snapToGrid)(this.pos).add(v(n.GRID_PIXEL_SIZE/2,n.GRID_PIXEL_SIZE/2));t.network.send(e.CMDS.BOMB_EXPLODE,m);for(var I=r([b("explosion"),f(.6666666),p("center"),s(u,l),d(m),"explosion"]),g=[],P=[],x=m.x,_=m.y,k=c.getRadius(),y=function(o){if((0,i.getAtPos)(o,"block").length)return!0;var e=(0,i.getAtPos)(o,"brick");if(e.length)return e.forEach(function(o){return o.explode()}),!0;var t=(0,i.getAtPos)(o,"powerup");if(t.length)return t.forEach(function(o){return a(o)}),!0;var n=(0,i.getAtPos)(o,"bomb");return!!n.length&&(n.forEach(function(o){return o.explode()}),!0)},S=1,B=!1;S<=k&&!B;S++){(B=y(D={x:x+n.GRID_PIXEL_SIZE*S,y:_}))||(S===k?P:g).push(r([b("explosion"),p("center"),f(.6666666),s(u,l),d(D),"explosion"]))}for(S=1,B=!1;S<=k&&!B;S++){(B=y(D={x:x-n.GRID_PIXEL_SIZE*S,y:_}))||(S===k?P:g).push(r([b("explosion"),p("center"),f(-.6666666,.6666666),s(u,l),d(D),"explosion"]))}for(S=1,B=!1;S<=k&&!B;S++){(B=y(D={x:x,y:_+n.GRID_PIXEL_SIZE*S}))||(S===k?P:g).push(r([b("explosion"),p("center"),f(.6666666,-.6666666),s(u,l),h(33),d(x,_+n.GRID_PIXEL_SIZE*S),"explosion"]))}for(S=1,B=!1;S<=k&&!B;S++){var D;(B=y(D={x:x,y:_-n.GRID_PIXEL_SIZE*S}))||(S===k?P:g).push(r([b("explosion"),p("center"),f(.6666666),s(u,l),h(33),d(x,_-n.GRID_PIXEL_SIZE*S),"explosion"]))}c.decBombCnt(),I.play("explode-origin"),g.forEach(function(o){return o.play("explode-mid")}),P.forEach(function(o){return o.play("explode-end")}),E(.7,function(){o(o([I],g,!0),P,!0).forEach(function(o){return a(o)})})}}}function P(o){if(this.paused)return!1;if(!this.canSpawnBomb())return!1;var n=(0,i.snapToGrid)(o);return!c().filter(function(o){var e;return!(null===(e=o.pos)||void 0===e||!e.eq(n))&&(o.is("bomb")||o.is("block")||o.is("brick")||o.is("powerup"))}).length&&(l("laybomb",{volume:(0,i.getSfxVol)()}),r([b("bomb"),f(2),s(v(2,4),v(14,16)),d(n),g(this),"bomb"]).play("bomb"),this.incBombCnt(),t.network.send(e.CMDS.BOMB_SPAWN,n),!0)}function x(){if(this.canPBomb())for(var o=0,e=!0;e;){o+=1;var t=this.pos.add(this.area.p1).add(v(0,2)).add(this.getDir().scale(o*n.GRID_PIXEL_SIZE));e=this.spawnBombAtPos(t)}}exports.default=I;
},{"../model/Network":"c3M1","../kaboom":"hRpI","../util":"BHXf","../types":"UL96"}],"eNmp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.gamepadDefaults=exports.keyboardDefaults=exports.KeyboardControlDefs=exports.GamepadControlDefs=void 0;var e,n=require("../kaboom"),r=require("../types");!function(e){e.left="left",e.right="right",e.up="up",e.down="down",e.primary="primary",e.secondary="secondary"}(e||(e={}));var o=function(){return function(e){Object.assign(this,e)}}();exports.GamepadControlDefs=o;var t=function(){function n(e){Object.assign(this,e)}return n.prototype.on=function(n,r,o){(n===e.primary||n===e.secondary?s:a)(this[n],r),o&&i(this[n],o)},n}();exports.KeyboardControlDefs=t,exports.keyboardDefaults=[new t({left:"left",right:"right",up:"up",down:"down",primary:"shift",secondary:"1"}),new t({left:"a",right:"d",up:"w",down:"s",primary:"space",secondary:"2"}),new t({left:"f",right:"h",up:"t",down:"g",primary:"b",secondary:"3"}),new t({left:"j",right:"l",up:"i",down:"k",primary:",",secondary:"4"})],exports.gamepadDefaults=[new o({id:"Logitech Dual Action (STANDARD GAMEPAD Vendor: 046d Product: c216)",left:1,right:2,up:3,down:4,primary:5,secondary:6})];var a=n.k.keyDown,s=n.k.keyPress,i=n.k.keyRelease;function u(n,a){return{add:function(){var a=this;n instanceof o?console.log("Add gamepad"):n instanceof t?(n.on(e.primary,function(){return a.spawnBomb()}),n.on(e.secondary,function(){return console.log(a)}),n.on(e.up,function(){return a.walk(r.DIRS.UP)}),n.on(e.down,function(){return a.walk(r.DIRS.DOWN)}),n.on(e.left,function(){return a.walk(r.DIRS.LEFT)}),n.on(e.right,function(){return a.walk(r.DIRS.RIGHT)})):console.log("Unknown def type.")}}}exports.default=u;
},{"../kaboom":"hRpI","../types":"UL96"}],"G3uk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../model/Network"),t=require("../kaboom"),i=require("../util"),r=require("../types"),s=t.k.body,u=t.k.destroy,o=t.k.gravity,n=t.k.play,a=t.k.vec2,l=t.k.wait;function d(){var d=!1;return{isDead:function(){return d},isAlive:function(){return!d},die:function(){var c=this;d||(d=!0,this.layer="ui",this.solid=!1,this.scale=this.scale.scale(2),this.pos=this.pos.sub(a(this.width,this.height)),n("die",{volume:(0,i.getSfxVol)()}),this.trigger("died"),t.network.send(e.CMDS.PLAYER_DIE),l(.8,function(){c.use(s({jumpForce:900,maxVel:5e3})),c.jump(),o(r.HEAVY_GRAVITY)}),l(3,function(){u(c),o(r.GRAVITY)}))}}}exports.default=d;
},{"../model/Network":"c3M1","../kaboom":"hRpI","../util":"BHXf","../types":"UL96"}],"Dhtq":[function(require,module,exports) {
"use strict";function e(e){return void 0===e&&(e=0),{getScore:function(){return e},decScore:function(r){e-=r,this.trigger("score_changed")},incScore:function(r){e+=r,this.trigger("score_changed")}}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"qcZE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../model/Network"),t=require("../types"),r=require("../util"),i=require("../kaboom"),o=i.k.time,n=i.k.vec2;function u(u){void 0===u&&(u=t.WALK_SPEED);var s=!1,a=1,d=0,c=n(0,1);return{isIdle:function(){return!s},isWalking:function(){return s},getDir:function(){return c},stop:function(){s=!1,i.network.send(e.CMDS.PLAYER_STOP)},walk:function(t){if(!this.paused&&!this.isDead()){s=!0,c=t,this.move(c.scale(u*a));var o=(0,r.vec2floor)(this.pos);i.network.send(e.CMDS.PLAYER_MOVE,[o.x,o.y,c.x,c.y,s])}},walkPowerup:function(e){e===t.POWERUPS.SPEED&&(a=2,d=(d>0?d:o())+30,(0,i.debug)("Greased LIGHTNING!"))},update:function(){this.resolve(),0!==d&&o()>d&&(d=0,a=1,(0,i.debug)("Back to normal speed."))}}}exports.default=u;
},{"../model/Network":"c3M1","../types":"UL96","../util":"BHXf","../kaboom":"hRpI"}],"AecW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../types"),r=require("../kaboom"),o=require("../util"),t=r.k.add,a=r.k.choose,i=r.k.destroy,s=r.k.pos,n=r.k.rand,c=r.k.randSeed,d=r.k.scale,u=r.k.sprite,h=r.k.vec2,l=r.k.wait,E=[e.LEFT,e.RIGHT,e.UP,e.DOWN],I=e.GRID_PIXEL_SIZE/2;function k(){return a(E)}function p(r){void 0===r&&(r=e.ENEMY_SPEED),c(Date.now());var a=k();return{checkMapToMy:function(r){var t=this.pos.add(this.area.p1.scale(this.scale.x,this.scale.y));return 0===(0,o.getAtPos)(t.add(r.scale(e.GRID_PIXEL_SIZE)),"solid").length},randomizeDir:function(){var r=0;do{a=k()}while(!this.checkMapToMy(a)&&r++<50);r>=50&&(a=e.IDLE)},die:function(){var e=t([u("smoke",{noArea:!0}),d(2),s(this.pos)]);e.play("smoke"),l(.8,function(){return i(e)}),i(this)},add:function(){var e=this;this.collides("solid",function(o){e.move(a.scale(-r)),e.randomizeDir()})},update:function(){var o=this;Array("x","y").some(function(r){if(a[r]&&Math.round(o.pos[r])%e.GRID_PIXEL_SIZE==0&&(o.checkMapToMy("x"===r?e.UP:e.LEFT)||o.checkMapToMy("x"===r?e.DOWN:e.RIGHT))&&n()<.4)return o.randomizeDir(),!0});var t=h(0,0);Array("x","y").forEach(function(i){if(0===a[i]){var s=Math.round(100*o.pos[i])/100%e.GRID_PIXEL_SIZE;0!==s&&(s=-s+(s>I?e.GRID_PIXEL_SIZE:0),s/=r/8,t[i]=s)}}),this.move(a.add(t).scale(r))}}}exports.default=p;
},{"../types":"UL96","../kaboom":"hRpI","../util":"BHXf"}],"yqLk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../kaboom"),t=e.k.area,r=e.k.scale,s=e.k.vec2;function u(){return{add:function(){this.use(r(2)),this.use(t(s(2,2),s(14,16)))}}}exports.default=u;
},{"../kaboom":"hRpI"}],"xDLI":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../kaboom"),t=e.k.area,r=e.k.scale,s=e.k.vec2;function u(){return{add:function(){this.use(r(1.15)),this.use(t(s(5,2),s(21,27)))}}}exports.default=u;
},{"../kaboom":"hRpI"}],"k1gU":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("./generic")),r=e(require("./toadsworth"));exports.default={generic:t.default,toadsworth:r.default};
},{"./generic":"yqLk","./toadsworth":"xDLI"}],"yFs6":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("../kaboom")),a=require("../types"),l=require("../util"),u=t.default.add,r=t.default.destroy,o=t.default.play,d=t.default.pos,s=t.default.rand,f=t.default.scale,i=t.default.sprite,_=t.default.width;function c(){o("bullet",{volume:(0,l.getSfxVol)()});var e=s()>.5?1:-1,t=u([i("bullet"),f(e,1),d(1===e?3*-a.GRID_PIXEL_SIZE:_()+a.GRID_PIXEL_SIZE,Math.floor(s(0,a.MAP_HEIGHT_PIXELS-a.GRID_PIXEL_SIZE))),"hazard","can-hurt-player"]);t.action(function(){t.move(125*t.scale.x,0),t.scale.x>0&&t.pos.x>_()&&r(t),t.scale.x<0&&t.pos.x<-t.width&&r(t)})}exports.default=c;
},{"../kaboom":"hRpI","../types":"UL96","../util":"BHXf"}],"s6WJ":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("../kaboom")),u=require("../util"),a=require("../types"),r=t.default.add,o=t.default.body,d=t.default.destroy,_=t.default.layer,f=t.default.pos,i=t.default.rand,l=t.default.scale,s=t.default.sprite;function I(){var e=i()>.5?1:-1,t=i(250,550),I=i(100,250)*e,p=e>0?i(4*-a.GRID_PIXEL_SIZE,.3*a.MAP_WIDTH_PIXELS):i(.7*a.MAP_WIDTH_PIXELS,a.MAP_WIDTH_PIXELS+4*a.GRID_PIXEL_SIZE),P=a.MAP_HEIGHT_PIXELS+a.GRID_PIXEL_SIZE,n=r([s("fish"),l(2*e,2),_("ui"),f(p,P),o({jumpForce:t}),"hazard"]);n.play("fish"),n.jump(),n.action(function(){n.move(I,0),n.pos.y<=P?(0,u.getAtPos)(n.pos,"player").forEach(function(e){e.die(),d(n)}):d(n)})}exports.default=I;
},{"../kaboom":"hRpI","../util":"BHXf","../types":"UL96"}],"rDEQ":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("../kaboom")),a=require("../types"),r=require("../util"),u=t.default.add,l=t.default.area,o=t.default.destroy,d=t.default.play,f=t.default.pos,i=t.default.rand,p=t.default.randSeed,s=t.default.scale,n=t.default.sprite,c=t.default.vec2,v=t.default.wait;function b(){var e=Object.values(a.POWERUPS),t=Math.floor(i(-5,20));return e.includes(t)?t:-1}function x(){return p(Date.now()),{explode:function(){d("breakbrick",{volume:(0,r.getSfxVol)()}),o(this);var e=u([n("brick"),s(2),f(this.pos)]);e.play("explode"),v(.5,function(){var t=b();t>=0&&(d("powerupappears",{volume:(0,r.getSfxVol)()}),u([n("powerups",{frame:t}),s(2),l(c(4,4),c(12,12)),f(e.pos),"powerup"])),o(e)})}}}exports.default=x;
},{"../kaboom":"hRpI","../types":"UL96","../util":"BHXf"}],"e9qO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../kaboom"),e=require("../types"),r=60;function u(t){var e=Math.floor(t%1*10),r=Math.floor(t)%60;return Math.floor(t/60)+":"+(r<10?"0":"")+r+"."+e}function n(n){var i=!1,o=!1,s=!0,a=0,f="",c=function(){return n-a<=r},p=function(){return a>=n},d=function(){return a>0},h=function(){return s},m=function(){return s=!1};return{isHurry:c,isTimeUp:p,isStarted:d,isPaused:h,getTime:function(){return a},pause:function(){return s=!0},unpause:m,start:function(){d()||(m(),a=.01)},powerup:function(r){r===e.POWERUPS.TIME&&(n+=30,(0,t.debug)("Sweet, you just increased game time by 30 sec!"))},writeTime:function(t){void 0===t&&(t=n);var e=u(t);f!==e&&(this.text=e,f=e)},update:function(){h()||d()&&(a+=t.k.dt(),this.writeTime(n-a),c()&&!o?(o=!0,this.trigger("hurry_up")):p()&&!i&&(i=!0,this.trigger("time_up")))}}}exports.default=n;
},{"../kaboom":"hRpI","../types":"UL96"}],"bBS3":[function(require,module,exports) {
module.exports=[["###############","#OOOOOOOOOOOOO#","#O1         2O#","#O           O#","#O           O#","#O           O#","#O OOOO OOOO O#","#O           O#","#O           O#","#O           O#","#O4         3O#","#OOOOOOOOOOOOO#","###############"],["###############","#1   O O$ O  2#","# #O# #O# #O# #","#    O O O g O#","# #O# # # #O# #","#O  g  O O O#","#O# #O# # #O# #","#O  O   OO  $O#","# #O##g#O# # #","#O   O O   OO #","# #O# # # # # #","#4 O    O  O 3#","###############"]];
},{}],"yj6k":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,r,n,t){return new(n||(n=Promise))(function(o,i){function a(e){try{c(t.next(e))}catch(r){i(r)}}function u(e){try{c(t.throw(e))}catch(r){i(r)}}function c(e){var r;e.done?o(e.value):(r=e.value,r instanceof n?r:new n(function(e){e(r)})).then(a,u)}c((t=t.apply(e,r||[])).next())})},r=this&&this.__generator||function(e,r){var n,t,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,t&&(o=2&i[0]?t.return:i[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,i[1])).done)return o;switch(t=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,t=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=r.call(e,a)}catch(u){i=[6,u],t=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},n=this&&this.__spreadArray||function(e,r,n){if(n||2===arguments.length)for(var t,o=0,i=r.length;o<i;o++)!t&&o in r||(t||(t=Array.prototype.slice.call(r,0,o)),t[o]=r[o]);return e.concat(t||Array.prototype.slice.call(r))},t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var o=require("../kaboom"),i=t(require("../abilities/canBomb")),a=t(require("../abilities/canControl")),u=t(require("../abilities/canDie")),c=t(require("../abilities/canScore")),l=t(require("../abilities/canWalk")),s=t(require("../abilities/enemy")),f=t(require("../characters")),p=t(require("../hazards/Bullet")),d=t(require("../hazards/Fish")),_=t(require("../features/brick")),m=t(require("../features/timer")),h=t(require("../maps/campaign.json")),b=require("../abilities/canControl"),E=require("../util"),I=require("../types"),g=!0,y=o.k.action,k=o.k.add,S=o.k.addLevel,P=o.k.area,v=o.k.choose,M=o.k.color,T=o.k.destroy,H=o.k.go,D=o.k.gravity,A=o.k.layer,R=o.k.layers,w=o.k.loadSound,L=o.k.origin,G=o.k.overlaps,U=o.k.play,q=o.k.pos,x=o.k.rand,X=o.k.rect,C=o.k.scale,Y=o.k.solid,W=o.k.sprite,Z=o.k.text,V=o.k.vec2,j=o.k.wait;function B(t,B,N){return void 0===t&&(t=1),void 0===B&&(B=1),void 0===N&&(N=!1),e(this,void 0,void 0,function(){var e,z,O,F,$,J,K,Q,ee,re,ne;return r(this,function(r){switch(r.label){case 0:return e=h.default[B],o.network.enabled=N,O=v(["mb","mp"]),[4,Promise.all([w("music-intro","assets/music/"+O+"i.ogg"),w("music","assets/music/"+O+".ogg")])];case 1:return r.sent(),R(["bg","obj","ui"],"obj"),D(I.GRAVITY),F={width:I.GRID_PIXEL_SIZE,height:I.GRID_PIXEL_SIZE,pos:V(0,I.GRID_PIXEL_SIZE),scale:2,"#":[W("block"),C(2),Y(),"solid","block"],O:[W("brick"),C(2),Y(),(0,_.default)(),"solid","brick"],any:function(e){return null}},S(e,F),k([X(I.MAP_WIDTH_PIXELS,I.MAP_HEIGHT_PIXELS,{noArea:g}),q(0,I.GRID_PIXEL_SIZE),M(I.GREEN),A("bg")]),n(n(n([],(0,E.findMapItems)(e,"").map(function(e){return k([W("coin",{animSpeed:.2,frame:0}),q((0,E.convertMapPosToCoord)(e)),P(V(4,4),V(28,28)),"coin","coin-10"])}),!0),(0,E.findMapItems)(e,"$").map(function(e){return k([W("coin",{animSpeed:.2,frame:4}),q((0,E.convertMapPosToCoord)(e)),P(V(4,4),V(28,28)),"coin","coin-30"])}),!0),(0,E.findMapItems)(e,"").map(function(e){return k([W("coin",{animSpeed:.2,frame:8}),q((0,E.convertMapPosToCoord)(e)),P(V(4,4),V(28,28)),"coin","coin-50"])}),!0).forEach(function(e){var r=["coin-10","coin-30","coin-50"].find(function(r){return e.is(r)});r&&e.play(r)}),n([],(0,E.findMapItems)(e,"g").map(function(e){return k([W("goomba",{animSpeed:.5}),(0,s.default)(),C(2),q((0,E.convertMapPosToCoord)(e)),P(V(2,2),V(14,14)),"can-get-hurt","can-hurt-player","enemy"])}),!0).forEach(function(e){e.play("walk")}),k([X(I.MAP_WIDTH_PIXELS-1,I.GRID_PIXEL_SIZE-1,{noArea:g}),M(I.WHITE)]),k([X(I.MAP_WIDTH_PIXELS-5,I.GRID_PIXEL_SIZE-5,{noArea:g}),q(2,2),M(I.BLUE)]),$=k([Z("",16,{noArea:g}),q(12,9),(0,m.default)(I.DEFAULT_GAME_TIME)]),J=k([Z("",16,{noArea:g}),q(I.MAP_WIDTH_PIXELS-10,9),L("topright")]),$.on("hurry_up",function(){(0,o.debug)("Time's running out!"),z.pause(),U("hurryup",{volume:(0,E.getMusVol)()}),j(3.3,function(){ee()||(z.speed(I.MUSIC_HURRY_SPEED),z.detune(I.MUSIC_HURRY_DETUNE),z.play())});for(var e,r,n=1,t=function(e,r,n){j(e,function(){var e=V(r,n).scale(I.GRID_PIXEL_SIZE);k([W("block"),C(2),"fallingblock",q(V(r,n).sub(V(0,I.MAP_HEIGHT)).scale(I.GRID_PIXEL_SIZE)),{targ:e}])})},i=1;i<=3;i+=1){for(r=1+i,e=i;e<I.MAP_WIDTH-i;e+=1)t(n+=.5,e,r);for(e=I.MAP_WIDTH-i-1,r=2+i;r<I.MAP_HEIGHT-i;r+=1)t(n+=.5,e,r);for(r=I.MAP_HEIGHT-i,e=I.MAP_WIDTH-1-i;e>=i;e-=1)t(n+=.5,e,r);for(e=i,r=I.MAP_HEIGHT-i-1;r>i+1;r-=1)t(n+=.5,e,r)}var a=[x(3,8),x(12,19),x(25,35),x(38,42),x(43,48),x(49,51),x(52,56)];x()>.5?((0,o.debug)("You better run, better run, faster than my bullet..."),a.forEach(function(e){j(e,p.default)})):((0,o.debug)("Gone fishin'..."),a.forEach(function(e){j(e,d.default)}))}),$.on("time_up",function(){z.stop(),H("timeup")}),K=function(){$.isStarted()||($.start(),z=U("music-intro",{volume:(0,E.getMusVol)(),detune:$.isHurry()?I.MUSIC_HURRY_DETUNE:0,speed:$.isHurry()?I.MUSIC_HURRY_SPEED:1}),j(2.4,function(){z.paused()||ee()||(z=U("music",{volume:(0,E.getMusVol)(),loop:!0,detune:$.isHurry()?I.MUSIC_HURRY_DETUNE:0,speed:$.isHurry()?I.MUSIC_HURRY_SPEED:1}))}))},Q=Array.from(Array(t).keys()).map(function(r){var n=(r+1).toString(),t=(0,E.convertMapPosToCoord)((0,E.findMapItem)(e,n)),o=t.x,s=t.y,p=v(I.PLAYER_TYPES),d=f.default[p]||f.default.generic;return k([W(p),q(o,s),d(),(0,i.default)(),(0,a.default)(b.keyboardDefaults[r]),(0,u.default)(),(0,c.default)(),(0,l.default)(),"can-get-hurt","player"])}),ee=function(){return Q.every(function(e){return e.isDead()})},re=function(){ee()&&(z.stop(),$.pause(),j(2.6,function(){return H("lose")}))},ne=function(){J.text="Score: "+Q[0].getScore().toLocaleString()},Q.forEach(function(e){e.on("died",re),e.on("score_changed",ne)}),G("bomb","player",function(e,r){e.solid&&r.kickBomb(e)}),G("explosion","can-get-hurt",function(e,r){r.die()}),G("can-hurt-player","player",function(e,r){r.die()}),G("coin","player",function(e,r){U("coin",{volume:(0,E.getSfxVol)()}),e.is("coin-10")?r.incScore(10):e.is("coin-30")?r.incScore(30):e.is("coin-50")&&r.incScore(50),T(e)}),G("powerup","player",function(e,r){U("powerup",{volume:(0,E.getSfxVol)()}),r.bombPowerup(e.frame),r.walkPowerup(e.frame),$.powerup(e.frame),T(e)}),y("fallingblock",function(e){e.move(0,250),e.pos.dist(e.targ)<I.GRID_PIXEL_SIZE/5&&(U("thud",{volume:(0,E.getSfxVol)()}),e.pos=e.targ,e.rmTag("fallingblock"),(0,E.getOverlapped)(e).forEach(function(e){e.is("can-get-hurt")?e.die():e.is("bomb")?e.explode():e._tags.length&&!e.is("hazard")&&T(e)}),e.use(Y()),e.use("block"),e.use("solid"))}),o.k.keyPress("escape",function(){U("pause",{volume:(0,E.getSfxVol)()}),$.isPaused()?($.unpause(),o.k.get().forEach(function(e){return e.paused=!1}),z.play()):($.pause(),o.k.get().forEach(function(e){return e.paused=!0}),z.pause())}),o.k.debug.clearLog(),$.writeTime(),ne(),K(),[2]}})})}exports.default=B;
},{"../kaboom":"hRpI","../abilities/canBomb":"hsLw","../abilities/canControl":"eNmp","../abilities/canDie":"G3uk","../abilities/canScore":"Dhtq","../abilities/canWalk":"qcZE","../abilities/enemy":"AecW","../characters":"k1gU","../hazards/Bullet":"yFs6","../hazards/Fish":"s6WJ","../features/brick":"rDEQ","../features/timer":"e9qO","../maps/campaign.json":"bBS3","../util":"BHXf","../types":"UL96"}],"ETT4":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../kaboom"),e=t.k.add,o=t.k.color,n=t.k.destroy,r=t.k.pos,i=t.k.text,u=t.k.readd,d=t.k.rect,a=t.k.rgba,c={fontColor:a(1,1,1,1),fontSize:12,backgroundColor:a(.25,.25,.25,1),focusColor:a(.4,.4,.4,1),highlightColor:a(.1,.1,.1,.5),maxRows:4,multiple:!0,padding:8};function l(t){return void 0===t&&(t=!1),{setSelected:function(e){return t=e},getSelected:function(){return t}}}function s(t){return void 0===t&&(t=""),{setValue:function(e){return t=e},getValue:function(){return t}}}function f(t,f){void 0===t&&(t=[]),void 0===f&&(f={});var g,h=Object.assign(c,f),p=t.length?0:-1,k=!1,b=[];return{setData:function(u){var d=this;b.forEach(function(t){return n(t)}),b=u.map(function(t,n){return e([i(t.label,h.fontSize,{noArea:!1,width:d.width-2*h.padding}),o(h.fontColor),r(d.pos.add(h.padding,h.padding+n*(h.fontSize+h.padding))),l(!!t.selected),s(t.value)])}),t=u},isFocused:function(){return k},getSelected:function(){return b.filter(function(t){return t.getSelected()}).map(function(t){return{label:t.text,value:t.getValue(),selected:t.getSelected()}})},getIndex:function(){return p},setIndex:function(e){e<0&&(e=0),e>t.length-1&&(e=t.length-1),p=e,this.updateUI()},blur:function(){k=!1,this.color=h.backgroundColor,this.updateUI()},focus:function(){k=!0,this.color=h.focusColor,this.updateUI()},updateUI:function(){p>=0&&k?(g.color=h.highlightColor,g.pos.y=b[p].pos.y-h.padding/2,u(b[p])):g.color=a(0,0,0,0)},add:function(){this.use(o(h.backgroundColor)),this.setData(t),g=e([d(this.width-h.padding,h.fontSize+h.padding,{noArea:!0}),o(h.highlightColor),r(this.pos.x+this.area.p1.x+h.padding/2,0)])},destroy:function(){b.forEach(function(t){return n(t)})}}}exports.default=f;
},{"../kaboom":"hRpI"}],"nIBZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var o=require("../kaboom"),t=o.k.add,e=o.k.color,r=o.k.destroy,n=o.k.keyIsDown,s=o.k.pos,i=o.k.text,a=o.k.time,u=o.k.rgb,c={fontColor:u(1,1,1),backgroundColor:u(.25,.25,.25),focusColor:u(.5,.5,.5),maxChars:100};function d(o,u,d){void 0===o&&(o=""),void 0===u&&(u=12),void 0===d&&(d={});var f,l=Object.assign(c,d),h=!1,k=!1;return{keyPress:function(t){h&&("backspace"===t?o=o.slice(0,-1):o.length<l.maxChars&&(n("shift")&&(t=t.toUpperCase()),o+=t),f.text=o+(k&&o.length<l.maxChars?"_":""))},getText:function(){return o},setText:function(t){o=t,f.text=t+(k&&o.length<l.maxChars?"_":"")},isFocused:function(){return h},blur:function(){h=!1,this.color=l.backgroundColor},focus:function(){h=!0,this.color=l.focusColor},add:function(){this.use(e(l.backgroundColor)),f=t([i(o,u,{width:this.width-6,noArea:!1}),s(this.pos.add(4,6)),e(l.fontColor)])},update:function(){if(h||k){var t=!!h&&a()%1>.5;k!==t&&(k=t,f.text=o+(k&&o.length<l.maxChars?"_":""))}},destroy:function(){r(f)}}}exports.default=d;
},{"../kaboom":"hRpI"}],"mndu":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../kaboom"),o=require("../types"),n=require("../util"),r=e(require("../features/select")),u=e(require("../features/textbox"));function l(e){return{menuAction:e}}function a(e){void 0===e&&(e="startCampaign");var a,i,s=t.k.add,c=t.k.charInput,f=t.k.color,d=t.k.destroy,p=t.k.go,k=t.k.keyPress,m=t.k.origin,y=t.k.play,b=t.k.pos,h=t.k.rect,v=t.k.rand,x=t.k.sprite,g=t.k.text,E=t.k.width,M=t.k.height,I=0,W=function(e){e<0&&(e=0),e>C.length-1&&(e=C.length-1);var t=C[e],n=C[T],r=t.pos.add(t.area.p2.add(t.area.p1).scale(.5)).y;(null==a?void 0:a.isFocused())&&a.blur(),(null==i?void 0:i.isFocused())&&i.blur(),n.text&&(n.color=o.WHITE),t.text&&(t.color=o.YELLOW),t===P&&(null==a||a.focus()),t===i&&i.focus(),D.forEach(function(e){return e.pos.y=r}),T=e},A=function(){return C[T].menuAction?C[T].menuAction():0},H=function(e){void 0===e&&(e=I+1),e<1&&(e=4),e>4&&(e=1),I=e,C[0].text="Number of Players: "+I},O=y("menu-3",{loop:!0,volume:(0,n.getMusVol)()});s([g("Game Setup",18),f(o.WHITE),m("center"),b(E()/2,.15*M())]);var P,T=0,_=s([g("Number of Players",14),f(o.WHITE),m("center"),b(E()/2,.3*M()),l(H)]),q=s([g("Online: Off",14),f(o.WHITE),m("center"),b(E()/2,.375*M()),l(function(){a?(d(a),d(i),d(P),a=null,i=null,q.text="Online: Disabled",R.pos.y=.525*M(),C.splice(3,2)):(P=s([g("Room:",14),m("left"),b(E()/2-175,.6*M()-30)]),a=s([h(270,24,{noArea:!1}),b(P.pos.x+80,P.pos.y-11),(0,u.default)("My great room #"+Math.floor(v(1e4,99999)).toString(),12,{maxChars:22})]),i=s([h(350,M()-.6*M()-65),b(E()/2-175,M()-.6*M()+95),f(o.DARKGRAY),(0,r.default)([{label:"Joe Blow",value:"beef-9842-4846"},{label:"Shy Guy!",value:"baad-98fe-ed46",selected:!0},{label:"Josh!",value:"adc3-4000-4140"}],{multiple:!0,maxRows:5})]),q.text="Online: Enabled",R.pos.y=M()-40,C.pop(),C.push(P,i,R))})]),w=s([g("Continue!",14),f(o.WHITE),m("center"),b(E()/2,.45*M()),l(function(){O.stop(),p(e,I)})]),R=s([g("Back to Main Menu",14),f(o.WHITE),m("center"),b(E()/2,.525*M()),l(function(){O.stop(),p("mainMenu")})]),C=[_,q,w,R],D=[s([x("title-mushroom"),b(E()/2-200,.3*M()),m("center")]),s([x("title-mushroom"),b(E()/2+200,.3*M()),m("center")])];k("up",function(){return W(T-1)}),k("down",function(){return W(T+1)}),k("enter",A),k("space",A),k("backspace",function(){return(null==a?void 0:a.isFocused())?a.keyPress("backspace"):0}),c(function(e){return null==a?void 0:a.keyPress(e)}),W(T),H()}exports.default=a;
},{"../kaboom":"hRpI","../types":"UL96","../util":"BHXf","../features/select":"ETT4","../features/textbox":"nIBZ"}],"FZKx":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("../kaboom"));function a(){var e=t.default.add,a=t.default.color,r=t.default.go,u=t.default.keyPress,d=t.default.origin,l=t.default.pos,o=t.default.scale,f=t.default.sprite,s=t.default.text,i=t.default.width,n=t.default.height;e([f("gameover",{noArea:!0}),d("center"),l(.5*i(),.4*n()),o(2)]),e([s("Press spacebar to try again",9),a(1,1,1,1),d("center"),l(.5*i(),.6*n())]);var c=function(){r("mainMenu")};u("space",c),u("enter",c),u("escape",c)}exports.default=a;
},{"../kaboom":"hRpI"}],"ulzC":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../kaboom");function t(){return{update:function(){this.scale=Math.abs(1.5*Math.sin(e.k.time()))+1.5}}}function i(){e.k.add([e.k.sprite("title-super",{noArea:!0}),e.k.pos(.5*e.k.width(),.25*e.k.height()),e.k.scale(1.8),t(),e.k.origin("center")]),e.k.add([e.k.sprite("title-bomber",{noArea:!0}),e.k.pos(.5*e.k.width()-60,.4*e.k.height()),e.k.scale(1.15),e.k.origin("center")]),e.k.add([e.k.sprite("title-bros",{noArea:!0}),e.k.pos(.5*e.k.width()+120,.4*e.k.height()),e.k.scale(1.5),e.k.origin("center")])}exports.default=i;
},{"../kaboom":"hRpI"}],"QSkN":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("./createTitle")),r=require("../kaboom"),o=require("../types"),n=require("../util");function u(e){void 0===e&&(e=0);var u=r.k.add,a=r.k.color,i=r.k.go,l=r.k.keyPress,s=r.k.origin,c=r.k.play,p=r.k.pos,f=r.k.sprite,k=r.k.text,d=r.k.width,m=r.k.height,g=c("menu-1",{loop:!0,volume:(0,n.getMusVol)()});(0,t.default)();var h=[u([k("Start a Campaign",14),a(o.WHITE),s("center"),p(.5*d(),.55*m())]),u([k("Play Battle Round",14),a(o.WHITE),s("center"),p(.5*d(),.65*m())]),u([k("Preferences",14),a(o.WHITE),s("center"),p(.5*d(),.75*m())])],v=[u([f("title-mushroom"),p(.5*d()-170,.55*m()),s("center")]),u([f("title-mushroom"),p(.5*d()+170,.55*m()),s("center")])],y=function(t){var r=h[t].pos.y;h[e].color=o.WHITE,h[t].color=o.YELLOW,v.forEach(function(e){return e.pos.y=r}),e=t};l("up",function(){y(0===e?0:e-1)}),l("down",function(){y(e===h.length-1?h.length-1:e+1)});var E=function(){g.stop(),0===e&&i("gameSetup","startCampaign"),1===e&&i("gameSetup","startBattle"),2===e&&i("pref")};l("space",E),l("enter",E),y(e)}exports.default=u;
},{"./createTitle":"ulzC","../kaboom":"hRpI","../types":"UL96","../util":"BHXf"}],"ZH20":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ControllerType=void 0;var t,e=require("../kaboom"),o=require("../types"),n=e.k.add,r=e.k.color,i=e.k.destroy,s=e.k.origin,u=e.k.pos,p=e.k.sprite,a=e.k.text,d=e.k.vec2;function c(){var e,c,l,f,h="",y=!1,x=!1;return{blur:function(){x=!1,this.updateUI()},focus:function(){x=!0,this.updateUI()},toggleDone:function(){y=!y,this.updateUI()},getDone:function(){return y},getCharacter:function(){return h},setCharacter:function(t){h=t,l.use(p(t))},clearController:function(){e=null,c=null,this.updateUI()},setController:function(t,o){e=t,c=o,this.updateUI()},reposition:function(t,e){this.pos=d(t,e),this.updateUI()},updateUI:function(){this.color=y?o.GREEN:x?o.LIGHTGRAY:o.DARKGRAY,l.pos=this.pos,f.pos=d(this.pos.add(0,this.height/2+16)),e===t.Keyboard&&"number"==typeof c?f.text="Kybd #"+(c+1).toString():e===t.Gamepad&&"number"==typeof c?f.text="Gamepad #"+(c+1).toString():e===t.Online?f.text=c:f.text="Unselected"},add:function(){this.use(r(o.DARKGRAY)),f=n([a("",9),s("center"),u(this.pos),r(o.DARKGRAY)]),l=n([u(this.pos),s("center")])},destroy:function(){i(l),i(f)}}}!function(t){t[t.Keyboard=0]="Keyboard",t[t.Gamepad=1]="Gamepad",t[t.Online=2]="Online"}(t=exports.ControllerType||(exports.ControllerType={})),exports.default=c;
},{"../kaboom":"hRpI","../types":"UL96"}],"sYg9":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../kaboom"),n=require("../types"),r=require("../util"),o=e(require("../features/playerRect")),u=e(require("../features/textbox"));function i(e,i){void 0===e&&(e=1),void 0===i&&(i="startCampaign");var a=t.k.add,l=t.k.charInput,c=t.k.color,f=t.k.destroy,s=t.k.go,p=t.k.keyPress,k=t.k.origin,h=t.k.play,d=t.k.pos,g=t.k.rect,y=t.k.rand,m=t.k.text,v=t.k.width,x=t.k.height,b=0,E=function(){return a([g(64,64,{noArea:!0}),d(.5*v(),.2*x()),k("center"),c(n.DARKGRAY),(0,o.default)()])};a([m("Player Selection",18),c(n.WHITE),k("center"),d(.5*v(),.06*x())]);var M,I=a([m("",11),c(n.RED),k("center"),d(.5*v(),.85*x())]),O=h("menu-3",{loop:!0,volume:(0,r.getMusVol)()}),P=[E()],W=function(e){for(void 0===e&&(e=1),e<1&&(e=4),e>4&&(e=1);P.length>e;)f(P.pop());for(;P.length<e;)P.push(E());var t=v()/(e+1);P.forEach(function(e,n){return e.reposition(t*(n+1),e.pos.y)}),T[0].text="Number of Players: "+P.length},H=[function(e){},function(e){M&&"space"===e||(M?(f(M),M=null,T[1].text="Online: Off",I.text=""):(T[1].text="Online room:",I.text="Sorry, online mode isn't available yet!",(M=_()).focus()))},function(e){O.stop(),s(i,P.length)},function(e){O.stop(),s("mainMenu")}],T=[a([m("Number of Players",14),c(n.WHITE),d(.1*v(),.4*x())]),a([m("Online: Off",14),c(n.WHITE),d(.1*v(),.475*x())]),a([m("Start game!",14),c(n.WHITE),d(.1*v(),.55*x())]),a([m("Back to Main Menu",14),c(n.WHITE),d(.1*v(),.625*x())])],_=function(){return a([g(250,24,{noArea:!1}),d(.1*v()+T[1].width+20,T[1].pos.y-6),(0,u.default)("My great room "+Math.floor(y(1e4,99999)).toString(),12,{maxChars:20})])},q=function(e){1===b&&(null==M||M.blur()),1===e&&(null==M||M.focus()),T[b].color=n.WHITE,T[e].color=n.YELLOW,b=e};p("up",function(){q(0===b?0:b-1)}),p("down",function(){q(b===T.length-1?T.length-1:b+1)}),p("left",function(){0===b&&W(P.length-1)}),p("right",function(){0===b&&W(P.length+1)});var A=function(e){H[b](e)};p("space",function(){return A("space")}),p("enter",function(){return A("enter")}),p("backspace",function(){1===b&&(null==M||M.keyPress("backspace"))}),l(function(e){null==M||M.keyPress(e)}),q(b),W()}exports.default=i;
},{"../kaboom":"hRpI","../types":"UL96","../util":"BHXf","../features/playerRect":"ZH20","../features/textbox":"nIBZ"}],"nrN0":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../kaboom"),o=t.k.add,e=t.k.color,i=t.k.destroy,r=t.k.origin,s=t.k.pos,n=t.k.rect,u=t.k.rgb,a=t.k.text,d={border:2,fontColor:u(1,1,1),fontSize:12,showValue:!0,color:u(1,1,1),focusColor:u(1,1,0),min:0,max:100};function h(t,u){void 0===t&&(t=0),void 0===u&&(u={});var h,l,f=Object.assign(d,u);return{inc:function(o){this.setValue(t+o)},getValue:function(){return t},setValue:function(o){o<f.min&&(o=f.min),o>f.max&&(o=f.max),t=o,this.updateUI()},updateUI:function(){var o,e;l&&(l.text=(null!==(o=f.valuePrefix)&&void 0!==o?o:"")+t.toLocaleString()+(null!==(e=f.valueSuffix)&&void 0!==e?e:"")),h.width=(this.width-2*f.border)*(f.max-t)/f.max},add:function(){this.use(e(f.color)),f.showValue&&(l=o([a("",f.fontSize),r("left"),s(this.pos.x+this.width+20,this.pos.y+this.height/2),e(f.fontColor)])),h=o([n(0,this.height-2*f.border),s(this.pos.x+this.width-f.border,this.pos.y+f.border),r("topright"),e(0,0,0)])},destroy:function(){i(h),i(l)}}}exports.default=h;
},{"../kaboom":"hRpI"}],"fKbW":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("../kaboom")),r=require("../types"),u=e(require("../features/slider")),n=r.LOCALSTORAGE_KEYS.SFX_VOL,a=r.LOCALSTORAGE_KEYS.MUS_VOL;function o(){var e=t.default.add,o=t.default.color,l=t.default.go,f=t.default.keyPress,i=t.default.origin,c=t.default.pos,s=t.default.play,d=t.default.rect,p=t.default.sprite,g=t.default.text,m=t.default.width,v=t.default.height,h=[n,a],S=s("menu-2",{loop:!0});S.pause();var _=0;e([g("Preferences",18),o(r.WHITE),i("center"),c(.5*m(),.15*v())]);var E=[e([p("audio-speaker"),c(.25*m(),.3*v())]),e([p("music-note"),c(.25*m(),.45*v())])].map(function(t,r){var n;return e([d(.32*m(),16),c(.35*m(),t.pos.y+8),(0,u.default)(parseInt(null!==(n=localStorage.getItem(h[r]))&&void 0!==n?n:"50"),{valueSuffix:"%"})])});E.push(e([g("Back to main menu",12),i("center"),c(.5*m(),.7*v()),o(r.WHITE)]));var y=function(e){e<0&&(e=0),e>E.length-1&&(e=E.length-1),E[_].color=r.WHITE,E[e].color=r.YELLOW,_=e},L=function(e,t){if(!(e>=E.length-1)){E[e].inc(t);var r=E[e].getValue();localStorage.setItem(h[e],r.toString()),h[e]===a&&S.volume(r/100),t&&h[e]===n&&s("laybomb",{volume:r/100})}},O=function(){_===E.length-1&&(S.stop(),l("mainMenu",2))};f("up",function(){return y(_-1)}),f("down",function(){return y(_+1)}),f("left",function(){return L(_,-5)}),f("right",function(){return L(_,5)}),f("space",O),f("enter",O),f("escape",O),y(_),Array(0,1).forEach(function(e){return L(e,0)}),S.play()}exports.default=o;
},{"../kaboom":"hRpI","../types":"UL96","../features/slider":"nrN0"}],"njTw":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var r=e(require("./createTitle")),t=require("../kaboom"),i=require("../types");function o(){var e=t.k.add,o=t.k.color,a=t.k.go,u=t.k.keyPress,n=t.k.origin,s=t.k.pos,k=t.k.text,c=t.k.width,d=t.k.height;(0,r.default)(),e([k("Press spacebar to begin!",14,{noArea:!0}),o(i.WHITE),n("center"),s(.5*c(),.65*d())]);var l=function(){return a("mainMenu")};u("space",l),u("enter",l)}exports.default=o;
},{"./createTitle":"ulzC","../kaboom":"hRpI","../types":"UL96"}],"fjfs":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("../kaboom")),a=require("../types"),u=require("../util");function r(){var e=t.default.add,r=t.default.color,l=t.default.go,o=t.default.keyPress,d=t.default.origin,s=t.default.pos,i=t.default.play,f=t.default.text,n=t.default.width,c=t.default.height,p=i("menu-3",{loop:!0,volume:(0,u.getMusVol)()});e([f("Battle Round",18),r(a.WHITE),d("center"),s(.5*n(),.25*c())]),e([f("Not available yet!",12),r(a.WHITE),d("center"),s(.5*n(),.4*c())]),e([f("Press spacebar to go back",9),r(a.WHITE),d("center"),s(.5*n(),.6*c())]);var v=function(){p.stop(),l("mainMenu",1)};o("space",v),o("enter",v),o("escape",v)}exports.default=r;
},{"../kaboom":"hRpI","../types":"UL96","../util":"BHXf"}],"LeIe":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("../kaboom")),u=require("../types"),r=require("../util");function a(e,a){void 0===e&&(e=1),void 0===a&&(a=1);var o=t.default.add,l=t.default.color,d=t.default.go,i=t.default.keyPress,s=t.default.origin,f=t.default.pos,n=t.default.play,c=t.default.text,p=t.default.width,v=t.default.height,g=n("menu-4",{loop:!0,volume:(0,r.getMusVol)()});o([c("Level "+a,18),l(u.WHITE),s("center"),f(.5*p(),.3*v())]),o([c("Get Ready!",12),l(u.WHITE),s("center"),f(.5*p(),.4*v())]),o([c("Press spacebar to begin",9),l(u.WHITE),s("center"),f(.5*p(),.6*v())]);var _=function(){g.stop(),d("game",e,a,!1)};i("space",_),i("enter",_)}exports.default=a;
},{"../kaboom":"hRpI","../types":"UL96","../util":"BHXf"}],"f2OD":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(a,u){function o(e){try{l(n.next(e))}catch(t){u(t)}}function i(e){try{l(n.throw(e))}catch(t){u(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,i)}l((n=n.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){var r,n,a,u,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return u={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function i(u){return function(i){return function(u){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(a=2&u[0]?n.return:u[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,u[1])).done)return a;switch(n=0,a&&(u=[2&u[0],a.value]),u[0]){case 0:case 1:a=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,n=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!a||u[1]>a[0]&&u[1]<a[3])){o.label=u[1];break}if(6===u[0]&&o.label<a[1]){o.label=a[1],a=u;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(u);break}a[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(i){u=[6,i],n=0}finally{r=a=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,i])}}},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var n=r(require("../kaboom")),a=require("../util");function u(){return e(this,void 0,void 0,function(){var e,r,u,o,i,l,s,c,f,p,d,h,b,y,v,m;return t(this,function(t){switch(t.label){case 0:return e=n.default.add,r=n.default.color,u=n.default.go,o=n.default.keyPress,i=n.default.loadSprite,l=n.default.loadSound,s=n.default.origin,c=n.default.play,f=n.default.pos,p=n.default.scale,d=n.default.sprite,h=n.default.text,b=n.default.width,y=n.default.height,[4,Promise.all([i("timeup","assets/title/timeup.png"),l("timeup","assets/sfx/smw_game_over.ogg")])];case 1:return t.sent(),v=c("timeup",{volume:(0,a.getMusVol)()}),e([d("timeup",{noArea:!0}),p(2),s("center"),f(.5*b(),.4*y())]),e([h("Press spacebar to try again",9),r(1,1,1,1),s("center"),f(.5*b(),.6*y())]),o("space",m=function(){v.stop(),u("game")}),o("enter",m),o("escape",m),[2]}})})}exports.default=u;
},{"../kaboom":"hRpI","../util":"BHXf"}],"LIbJ":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("./gameScene")),r=e(require("./gameSetupScene")),a=e(require("./loseScene")),u=e(require("./mainMenuScene")),n=e(require("./playerSelectionScene")),c=e(require("./prefScene")),i=e(require("./startScene")),l=e(require("./startBattleScene")),S=e(require("./startCampaignScene")),f=e(require("./timeupScene"));exports.default={gameScene:t.default,gameSetupScene:r.default,loseScene:a.default,mainMenuScene:u.default,playerSelectionScene:n.default,prefScene:c.default,startScene:i.default,startBattleScene:l.default,startCampaignScene:S.default,timeupScene:f.default};
},{"./gameScene":"yj6k","./gameSetupScene":"mndu","./loseScene":"FZKx","./mainMenuScene":"QSkN","./playerSelectionScene":"sYg9","./prefScene":"fKbW","./startScene":"njTw","./startBattleScene":"fjfs","./startCampaignScene":"LeIe","./timeupScene":"f2OD"}],"ZCfc":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});for(var s=e(require("./kaboom")),t=e(require("./scenes")),a=s.default.loadSound,o=s.default.loadSprite,r=s.default.scene,i=s.default.start,n=0,m=["bomberman-tiny","daisy","luigi","mario","peach","toad","toadsworth","wario"];n<m.length;n++){var g=m[n];o(g,"assets/characters/"+g+".png")}a("coin","assets/sfx/smw2_coin.ogg"),a("hurryup","assets/sfx/smb3_hurry_up.ogg"),a("die","assets/sfx/smb3_player_down.ogg"),a("bullet","assets/sfx/smb3_thwomp.ogg"),a("breakbrick","assets/sfx/smw_break_block.ogg"),a("laybomb","assets/sfx/smw_fireball.ogg"),a("pause","assets/sfx/smb_pause.ogg"),a("powerupappears","assets/sfx/smw_power-up_appears.ogg"),a("powerup","assets/sfx/smw_power-up.ogg"),a("explosion","assets/sfx/smw2_explosion.ogg"),a("thud","assets/sfx/smw_thud.ogg"),Array("super","bomber","bros","mushroom").forEach(function(e){return o("title-"+e,"assets/title/"+e+".png")}),Array(1,2,3,4).map(function(e){return a("menu-"+e,"assets/music/menu-"+e+".ogg")}),Array("audio-speaker","gameover","music-note").forEach(function(e){return o(e,"assets/title/"+e+".png")}),o("block","assets/map/block.png"),o("brick","assets/map/brick.png",{gridWidth:16,gridHeight:16,anims:{explode:{from:1,to:6}}}),o("bomb","assets/map/bomb.png",{gridWidth:16,gridHeight:16,anims:{bomb:{from:0,to:3}}}),o("smoke","assets/map/smoke.png",{gridWidth:16,gridHeight:16,anims:{smoke:{from:0,to:7}}}),o("bullet","assets/enemies/bullet.png"),o("coin","assets/map/coin.png",{gridWidth:32,gridHeight:32,anims:{"coin-10":{from:0,to:3},"coin-30":{from:4,to:7},"coin-50":{from:8,to:11}}}),o("explosion","assets/map/explosion.png",{gridWidth:48,gridHeight:48,anims:{"explode-origin":{from:0,to:6},"explode-mid":{from:7,to:13},"explode-end":{from:14,to:20}}}),o("fish","assets/enemies/fish.png",{gridWidth:21,gridHeight:18,anims:{fish:{from:0,to:1}}}),o("goomba","assets/enemies/goomba.png",{gridWidth:16,gridHeight:16,anims:{walk:{from:0,to:1}}}),o("powerups","assets/map/powerups.png",{gridWidth:16,gridHeight:16}),r("pref",t.default.prefScene),r("start",t.default.startScene),r("gameSetup",t.default.gameSetupScene),r("playerSelection",t.default.playerSelectionScene),r("startBattle",t.default.startBattleScene),r("startCampaign",t.default.startCampaignScene),r("lose",t.default.loseScene),r("mainMenu",t.default.mainMenuScene),r("game",t.default.gameScene),r("timeup",t.default.timeupScene),i("start");
},{"./kaboom":"hRpI","./scenes":"LIbJ"}]},{},["ZCfc"], null)
//# sourceMappingURL=main.185e1499.js.map