parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"tp4l":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,a=(e,t)=>{for(var r in t||(t={}))i.call(t,r)&&o(e,r,t[r]);if(n)for(var r of n(t))s.call(t,r)&&o(e,r,t[r]);return e},u=(e,n)=>t(e,r(n)),l=(t,r)=>e(t,"name",{value:r,configurable:!0}),h=(e,t)=>()=>(e&&(t=e(e=0)),t),c=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);function d(e){return e*Math.PI/180}function f(e){return 180*e/Math.PI}function m(e,t,r){return t>r?m(e,r,t):Math.min(Math.max(e,t),r)}function p(e,t,r){return e+(t-e)*r}function g(e,t,r,n,i){return n+(e-t)/(r-t)*(i-n)}function y(e,t,r,n,i){return m(g(e,t,r,n,i),n,i)}function w(...e){if(0===e.length)return w(0,0);if(1===e.length){if("number"==typeof e[0])return w(e[0],e[0]);if(b(e[0]))return w(e[0].x,e[0].y);if(Array.isArray(e[0])&&2===e[0].length)return w.apply(null,e[0])}return{x:e[0],y:e[1],clone(){return w(this.x,this.y)},add(...e){let t=w(...e);return w(this.x+t.x,this.y+t.y)},sub(...e){let t=w(...e);return w(this.x-t.x,this.y-t.y)},scale(e){return w(this.x*e,this.y*e)},dist(...e){let t=w(...e);return Math.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y))},len(){return this.dist(w(0,0))},unit(){return this.scale(1/this.len())},normal(){return w(this.y,-this.x)},dot(...e){let t=w(...e);return w(this.x*t.x,this.y*t.y)},angle(...e){let t=w(...e);return Math.atan2(this.y-t.y,this.x-t.x)},lerp(e,t){return w(p(this.x,e.x,t),p(this.y,e.y,t))},eq(e){return this.x===e.x&&this.y===e.y},str(){return`(${this.x}, ${this.y})`}}}function v(e){return w(Math.cos(e),Math.sin(e))}function x(e,t,r){return{x:e,y:t,z:r,xy(){return w(this.x,this.y)}}}function b(e){return void 0!==e&&void 0!==e.x&&void 0!==e.y}function k(e){return void 0!==e&&void 0!==e.x&&void 0!==e.y&&void 0!==e.z}function R(e){return void 0!==e&&void 0!==e.r&&void 0!==e.g&&void 0!==e.b&&void 0!==e.a}function A(e){if(void 0!==e&&Array.isArray(e.m)&&16===e.m.length)return e}function P(...e){if(0===e.length)return E();if(1===e.length){if(R(e[0]))return E(e[0]);if(Array.isArray(e[0])&&3===e[0].length)return P.apply(null,e[0])}return E(e[0],e[1],e[2],1)}function E(...e){var t;if(0===e.length)return E(1,1,1,1);if(1===e.length){if(R(e[0]))return E(e[0].r,e[0].g,e[0].b,e[0].a);if(Array.isArray(e[0])&&4===e[0].length)return E.apply(null,e[0])}return{r:e[0],g:e[1],b:e[2],a:null!=(t=e[3])?t:1,clone(){return E(this.r,this.g,this.b,this.a)},lighten(e){return E(this.r+e,this.g+e,this.b+e,this.a)},darken(e){return this.lighten(-e)},invert(){return E(1-this.r,1-this.g,1-this.b,this.a)},isDark(e=.5){return this.r+this.g+this.b<3*e},isLight(e=.5){return this.r+this.g+this.b>3*e},eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.g&&this.a===e.a}}}function S(e,t,r,n){return{x:e,y:t,w:r,h:n,clone(){return S(this.x,this.y,this.w,this.h)},eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}}}function T(e){return{m:e?[...e]:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],clone(){return T(this.m)},mult(e){let t=[];for(let r=0;r<4;r++)for(let n=0;n<4;n++)t[4*r+n]=this.m[0+n]*e.m[4*r+0]+this.m[4+n]*e.m[4*r+1]+this.m[8+n]*e.m[4*r+2]+this.m[12+n]*e.m[4*r+3];return T(t)},multVec4(e){return{x:e.x*this.m[0]+e.y*this.m[4]+e.z*this.m[8]+e.w*this.m[12],y:e.x*this.m[1]+e.y*this.m[5]+e.z*this.m[9]+e.w*this.m[13],z:e.x*this.m[2]+e.y*this.m[6]+e.z*this.m[10]+e.w*this.m[14],w:e.x*this.m[3]+e.y*this.m[7]+e.z*this.m[11]+e.w*this.m[15]}},multVec3(e){let t=this.multVec4({x:e.x,y:e.y,z:e.z,w:1});return x(t.x,t.y,t.z)},multVec2(e){return w(e.x*this.m[0]+e.y*this.m[4]+0*this.m[8]+1*this.m[12],e.x*this.m[1]+e.y*this.m[5]+0*this.m[9]+1*this.m[13])},translate(e){return this.mult(T([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,0,1]))},scale(e){return this.mult(T([e.x,0,0,0,0,e.y,0,0,0,0,1,0,0,0,0,1]))},rotateX(e){return this.mult(T([1,0,0,0,0,Math.cos(e),-Math.sin(e),0,0,Math.sin(e),Math.cos(e),0,0,0,0,1]))},rotateY(e){return this.mult(T([Math.cos(e),0,-Math.sin(e),0,0,1,0,0,Math.sin(e),0,Math.cos(e),0,0,0,0,1]))},rotateZ(e){return this.mult(T([Math.cos(e),-Math.sin(e),0,0,Math.sin(e),Math.cos(e),0,0,0,0,1,0,0,0,0,1]))},invert(){let e=[],t=this.m[10]*this.m[15]-this.m[14]*this.m[11],r=this.m[9]*this.m[15]-this.m[13]*this.m[11],n=this.m[9]*this.m[14]-this.m[13]*this.m[10],i=this.m[8]*this.m[15]-this.m[12]*this.m[11],s=this.m[8]*this.m[14]-this.m[12]*this.m[10],o=this.m[8]*this.m[13]-this.m[12]*this.m[9],a=this.m[6]*this.m[15]-this.m[14]*this.m[7],u=this.m[5]*this.m[15]-this.m[13]*this.m[7],l=this.m[5]*this.m[14]-this.m[13]*this.m[6],h=this.m[4]*this.m[15]-this.m[12]*this.m[7],c=this.m[4]*this.m[14]-this.m[12]*this.m[6],d=this.m[5]*this.m[15]-this.m[13]*this.m[7],f=this.m[4]*this.m[13]-this.m[12]*this.m[5],m=this.m[6]*this.m[11]-this.m[10]*this.m[7],p=this.m[5]*this.m[11]-this.m[9]*this.m[7],g=this.m[5]*this.m[10]-this.m[9]*this.m[6],y=this.m[4]*this.m[11]-this.m[8]*this.m[7],w=this.m[4]*this.m[10]-this.m[8]*this.m[6],v=this.m[4]*this.m[9]-this.m[8]*this.m[5];e[0]=this.m[5]*t-this.m[6]*r+this.m[7]*n,e[4]=-(this.m[4]*t-this.m[6]*i+this.m[7]*s),e[8]=this.m[4]*r-this.m[5]*i+this.m[7]*o,e[12]=-(this.m[4]*n-this.m[5]*s+this.m[6]*o),e[1]=-(this.m[1]*t-this.m[2]*r+this.m[3]*n),e[5]=this.m[0]*t-this.m[2]*i+this.m[3]*s,e[9]=-(this.m[0]*r-this.m[1]*i+this.m[3]*o),e[13]=this.m[0]*n-this.m[1]*s+this.m[2]*o,e[2]=this.m[1]*a-this.m[2]*u+this.m[3]*l,e[6]=-(this.m[0]*a-this.m[2]*h+this.m[3]*c),e[10]=this.m[0]*d-this.m[1]*h+this.m[3]*f,e[14]=-(this.m[0]*l-this.m[1]*c+this.m[2]*f),e[3]=-(this.m[1]*m-this.m[2]*p+this.m[3]*g),e[7]=this.m[0]*m-this.m[2]*y+this.m[3]*w,e[11]=-(this.m[0]*p-this.m[1]*y+this.m[3]*v),e[15]=this.m[0]*g-this.m[1]*w+this.m[2]*v;let x=this.m[0]*e[0]+this.m[1]*e[4]+this.m[2]*e[8]+this.m[3]*e[12];for(let b=0;b<4;b++)for(let t=0;t<4;t++)e[4*b+t]*=1/x;return T(e)}}}function _(e,t,r){return e+(Math.sin(r)+1)/2*(t-e)}function D(e){return{seed:e,gen(...e){if(0===e.length)return this.seed=(O*this.seed+j)%Y,this.seed/Y;if(1===e.length){if("number"==typeof e[0])return this.gen(0,e[0]);if(b(e[0]))return this.gen(w(0,0),e[0]);if(R(e[0]))return this.gen(E(0,0,0,0),e[0])}else if(2===e.length){if("number"==typeof e[0]&&"number"==typeof e[1])return this.gen()*(e[1]-e[0])+e[0];if(b(e[0])&&b(e[1]))return w(this.gen(e[0].x,e[1].x),this.gen(e[0].y,e[1].y));if(R(e[0])&&R(e[1]))return E(this.gen(e[0].r,e[1].r),this.gen(e[0].g,e[1].g),this.gen(e[0].b,e[1].b),this.gen(e[0].a,e[1].a))}}}}function F(e){N.seed=e}function M(...e){return N.gen(...e)}function I(e){return M()<=e}function L(e){return e[Math.floor(M(e.length))]}function C(e,t){return e.p2.x>=t.p1.x&&e.p1.x<=t.p2.x&&e.p2.y>=t.p1.y&&e.p1.y<=t.p2.y}function q(e,t){return e.p2.x>t.p1.x&&e.p1.x<t.p2.x&&e.p2.y>t.p1.y&&e.p1.y<t.p2.y}function B(e,t){return t.x>=e.p1.x&&t.x<=e.p2.x&&t.y>=e.p1.y&&t.y<e.p2.y}var O,j,Y,N,U=h(()=>{l(d,"deg2rad"),l(f,"rad2deg"),l(m,"clamp"),l(p,"lerp"),l(g,"map"),l(y,"mapc"),l(w,"vec2"),l(v,"vec2FromAngle"),l(x,"vec3"),l(b,"isVec2"),l(k,"isVec3"),l(R,"isColor"),l(A,"isMat4"),l(P,"rgb"),l(E,"rgba"),l(S,"quad"),l(T,"mat4"),l(_,"wave"),O=1103515245,j=12345,Y=2147483648,N=D(Date.now()),l(D,"makeRng"),l(F,"randSeed"),l(M,"rand"),l(I,"chance"),l(L,"choose"),l(C,"colRectRect"),l(q,"overlapRectRect"),l(B,"colRectPt")});function z(e,t){let r=typeof e,n=typeof t;if(r!==n)return!1;if("object"===r&&"object"===n){let r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(let i of r){let r=e[i],n=t[i];if(("function"!=typeof r||"function"!=typeof n)&&!z(r,n))return!1}return!0}return e===t}var H=h(()=>{l(z,"deepEq")});function X(e){switch(e){case"topleft":return w(-1,-1);case"top":return w(0,-1);case"topright":return w(1,-1);case"left":return w(-1,0);case"center":return w(0,0);case"right":return w(1,0);case"botleft":return w(-1,1);case"bot":return w(0,1);case"botright":return w(1,1);default:return e}}function J(e,t){let r=(()=>{switch(t.texFilter){case"linear":return e.LINEAR;case"nearest":default:return e.NEAREST}})(),n=(()=>{var r;let n=o($,ee),i=s(new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),a=null!=(r=t.clearColor)?r:E(0,0,0,1);e.clearColor(a.r,a.g,a.b,a.a),e.enable(e.BLEND),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);let u=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,u),e.bufferData(e.ARRAY_BUFFER,4*K,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null);let l=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,l),e.bufferData(e.ELEMENT_ARRAY_BUFFER,2*K,e.DYNAMIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null);let h=s(new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2));return{drawCalls:0,lastDrawCalls:0,defProg:n,curProg:n,defTex:i,curTex:i,curUniform:{},vbuf:u,ibuf:l,vqueue:[],iqueue:[],transform:T(),transformStack:[],clearColor:a,bgTex:h}})();function i(e){return Math.log(e)/Math.log(2)%1==0}function s(t){let n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r);let s=(()=>i(t.width)&&i(t.height)?e.REPEAT:e.CLAMP_TO_EDGE)();return e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,s),e.bindTexture(e.TEXTURE_2D,null),{width:t.width,height:t.height,bind(){e.bindTexture(e.TEXTURE_2D,n)},unbind(){e.bindTexture(e.TEXTURE_2D,null)}}}function o(t=$,r=ee){let n,i=Q.replace("{{user}}",null!=t?t:$),s=Z.replace("{{user}}",null!=r?r:ee),o=e.createShader(e.VERTEX_SHADER),a=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(o,i),e.shaderSource(a,s),e.compileShader(o),e.compileShader(a),n=e.getShaderInfoLog(o))throw new Error(n);if(n=e.getShaderInfoLog(a))throw new Error(n);let u=e.createProgram();if(e.attachShader(u,o),e.attachShader(u,a),e.bindAttribLocation(u,0,"a_pos"),e.bindAttribLocation(u,1,"a_uv"),e.bindAttribLocation(u,2,"a_color"),e.linkProgram(u),(n=e.getProgramInfoLog(u))&&"\n"!==n)throw new Error(n);return{bind(){e.useProgram(u)},unbind(){e.useProgram(null)},bindAttribs(){e.vertexAttribPointer(0,3,e.FLOAT,!1,4*V,0),e.enableVertexAttribArray(0),e.vertexAttribPointer(1,2,e.FLOAT,!1,4*V,12),e.enableVertexAttribArray(1),e.vertexAttribPointer(2,4,e.FLOAT,!1,4*V,20),e.enableVertexAttribArray(2)},send(t){this.bind();for(let r in t){let n=t[r],i=e.getUniformLocation(u,r);"number"==typeof n?e.uniform1f(i,n):A(n)?e.uniformMatrix4fv(i,!1,new Float32Array(n.m)):R(n)?e.uniform4f(i,n.r,n.g,n.b,n.a):k(n)?e.uniform3f(i,n.x,n.y,n.z):b(n)&&e.uniform2f(i,n.x,n.y)}this.unbind()}}}function h(e,t,r,n){let i=e.width/t,s=1/i,o=1/(e.height/r),a={},u=n.split("").entries();for(let[l,h]of u)a[h]=w(l%i*s,Math.floor(l/i)*o);return{tex:e,map:a,qw:s,qh:o}}function c(e,t,r=n.defTex,i=n.defProg,s={}){r=null!=r?r:n.defTex,i=null!=i?i:n.defProg,(r!==n.curTex||i!==n.curProg||!z(n.curUniform,s)||n.vqueue.length+e.length*V>K||n.iqueue.length+t.length>K)&&d(),n.curTex=r,n.curProg=i,n.curUniform=s;let o=t.map(e=>e+n.vqueue.length/V),a=e.map(e=>{let t=g(n.transform.multVec2(e.pos.xy()));return[t.x,t.y,e.pos.z,e.uv.x,e.uv.y,e.color.r,e.color.g,e.color.b,e.color.a]}).flat();o.forEach(e=>n.iqueue.push(e)),a.forEach(e=>n.vqueue.push(e))}function d(){!n.curTex||!n.curProg||0===n.vqueue.length||0===n.iqueue.length||(n.curProg.send(n.curUniform),e.bindBuffer(e.ARRAY_BUFFER,n.vbuf),e.bufferSubData(e.ARRAY_BUFFER,0,new Float32Array(n.vqueue)),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.ibuf),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(n.iqueue)),n.curProg.bind(),n.curProg.bindAttribs(),n.curTex.bind(),e.drawElements(e.TRIANGLES,n.iqueue.length,e.UNSIGNED_SHORT,0),n.curTex.unbind(),n.curProg.unbind(),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),n.iqueue=[],n.vqueue=[],n.drawCalls++)}function f(){e.clear(e.COLOR_BUFFER_BIT),t.clearColor||M({width:Y(),height:N(),quad:S(0,0,Y()*U()/W,N()*U()/W),tex:n.bgTex}),n.drawCalls=0,n.transformStack=[],n.transform=T()}function m(){d(),n.lastDrawCalls=n.drawCalls}function p(){return n.lastDrawCalls}function g(e){return w(e.x/Y()*2-1,-e.y/N()*2+1)}function y(e){n.transform=e.clone()}function v(e){!e||0===e.x&&0===e.y||(n.transform=n.transform.translate(e))}function P(e){!e||1===e.x&&1===e.y||(n.transform=n.transform.scale(e))}function _(e){!e||(n.transform=n.transform.rotateZ(e))}function D(){n.transformStack.push(n.transform.clone())}function F(){n.transformStack.length>0&&(n.transform=n.transformStack.pop())}function M(e={}){var t,r;let n=e.width||0,i=e.height||0,s=e.pos||w(0,0),o=X(e.origin||G).dot(w(n,i).scale(-.5)),a=w(null!=(t=e.scale)?t:1),u=e.rot||0,l=e.quad||S(0,0,1,1),h=1-(null!=(r=e.z)?r:0),d=e.color||E(1,1,1,1);D(),v(s),P(a),_(u),v(o),c([{pos:x(-n/2,i/2,h),uv:w(l.x,l.y+l.h),color:d},{pos:x(-n/2,-i/2,h),uv:w(l.x,l.y),color:d},{pos:x(n/2,-i/2,h),uv:w(l.x+l.w,l.y),color:d},{pos:x(n/2,i/2,h),uv:w(l.x+l.w,l.y+l.h),color:d}],[0,1,3,1,2,3],e.tex,e.prog,e.uniform),F()}function I(e,t={}){var r;let n=null!=(r=t.quad)?r:S(0,0,1,1),i=e.width*n.w,s=e.height*n.h;M(u(a({},t),{tex:e,quad:n,width:i,height:s}))}function L(e,t,r,n={}){M(u(a({},n),{pos:e,width:t,height:r}))}function C(e,t,r,n={}){let i=X(n.origin||G).dot(w(t,r)).scale(.5),s=e.add(w(-t/2,-r/2)).sub(i),o=e.add(w(-t/2,r/2)).sub(i),a=e.add(w(t/2,r/2)).sub(i),u=e.add(w(t/2,-r/2)).sub(i);q(s,o,n),q(o,a,n),q(a,u,n),q(u,s,n)}function q(e,t,r={}){let n=r.width||1,i=e.dist(t),s=Math.PI/2-e.angle(t);M(u(a({},r),{pos:e.add(t).scale(.5),width:n,height:i,rot:s,origin:"center"}))}function B(e,t,r={}){let n=(e+"").split(""),i=t.qw*t.tex.width,s=t.qh*t.tex.height,o=w((r.size||s)/s).dot(w(r.scale||1)),a=o.x*i,u=o.y*s,l=0,h=u,c=0,d=[[]];for(let w of n)("\n"===w||!!r.width&&l+a>r.width)&&(h+=u,l=0,d.push([])),"\n"!==w&&(d[d.length-1].push(w),l+=a),c=Math.max(c,l);r.width&&(c=r.width);let f=[],m=w(r.pos||0),p=X(r.origin||G).scale(.5),g=-p.x*a-(p.x+.5)*(c-a),y=-p.y*u-(p.y+.5)*(h-u);return d.forEach((e,n)=>{let i=(c-e.length*a)*(p.x+.5);e.forEach((e,s)=>{let l=t.map[e],h=s*a,c=n*u;l&&f.push({tex:t.tex,quad:S(l.x,l.y,t.qw,t.qh),ch:e,pos:w(m.x+h+g+i,m.y+c+y),color:r.color,origin:r.origin,scale:o,z:r.z})})}),{width:c,height:h,chars:f}}function O(e,t,r={}){j(B(e,t,r))}function j(e){for(let t of e.chars)M({tex:t.tex,width:t.tex.width*t.quad.w,height:t.tex.height*t.quad.h,pos:t.pos,scale:t.scale,color:t.color,quad:t.quad,origin:"center",z:t.z})}function Y(){return e.drawingBufferWidth/U()}function N(){return e.drawingBufferHeight/U()}function U(){var e;return null!=(e=t.scale)?e:1}function H(){return n.clearColor.clone()}return f(),m(),l(i,"powerOfTwo"),l(s,"makeTex"),l(o,"makeProgram"),l(h,"makeFont"),l(c,"drawRaw"),l(d,"flush"),l(f,"frameStart"),l(m,"frameEnd"),l(p,"drawCalls"),l(g,"toNDC"),l(y,"pushMatrix"),l(v,"pushTranslate"),l(P,"pushScale"),l(function(e){!e||(n.transform=n.transform.rotateX(e))},"pushRotateX"),l(function(e){!e||(n.transform=n.transform.rotateY(e))},"pushRotateY"),l(_,"pushRotateZ"),l(D,"pushTransform"),l(F,"popTransform"),l(M,"drawQuad"),l(I,"drawTexture"),l(L,"drawRect"),l(C,"drawRectStroke"),l(q,"drawLine"),l(B,"fmtText"),l(O,"drawText"),l(j,"drawFmtText"),l(Y,"width"),l(N,"height"),l(U,"scale"),l(H,"clearColor"),{width:Y,height:N,scale:U,makeTex:s,makeProgram:o,makeFont:h,drawTexture:I,drawText:O,drawFmtText:j,drawRect:L,drawRectStroke:C,drawLine:q,fmtText:B,frameStart:f,frameEnd:m,pushTransform:D,popTransform:F,pushMatrix:y,drawCalls:p,clearColor:H}}var G,V,K,W,Q,Z,$,ee,te=h(()=>{U(),H(),G="topleft",V=9,K=65536,W=64,Q="\nattribute vec3 a_pos;\nattribute vec2 a_uv;\nattribute vec4 a_color;\n\nvarying vec3 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nvec4 def_vert() {\n\treturn vec4(a_pos, 1.0);\n}\n\n{{user}}\n\nvoid main() {\n\tvec4 pos = vert(a_pos, a_uv, a_color);\n\tv_pos = a_pos;\n\tv_uv = a_uv;\n\tv_color = a_color;\n\tgl_Position = pos;\n}\n",Z="\nprecision mediump float;\n\nvarying vec3 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nuniform sampler2D u_tex;\n\nvec4 def_frag() {\n\treturn v_color * texture2D(u_tex, v_uv);\n}\n\n{{user}}\n\nvoid main() {\n\tgl_FragColor = frag(v_pos, v_uv, v_color, u_tex);\n\tif (gl_FragColor.a == 0.0) {\n\t\tdiscard;\n\t}\n}\n",$="\nvec4 vert(vec3 pos, vec2 uv, vec4 color) {\n\treturn def_vert();\n}\n",ee="\nvec4 frag(vec3 pos, vec2 uv, vec4 color, sampler2D tex) {\n\treturn def_frag();\n}\n",l(X,"originPt"),l(J,"gfxInit")});function re(e){return"pressed"===e||"rpressed"===e?"down":"released"===e?"up":e}function ne(e={}){var t,r;let n={canvas:null!=(t=e.canvas)?t:(()=>{var t;let r=document.createElement("canvas");return(null!=(t=e.root)?t:document.body).appendChild(r),r})(),keyStates:{},charInputted:[],mouseState:"up",mousePos:w(0,0),time:0,realTime:0,skipTime:!1,dt:0,scale:null!=(r=e.scale)?r:1,isTouch:!1,loopID:null,stopped:!1,fps:0,fpsBuf:[],fpsTimer:0},i={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"},s=["space","left","right","up","down","tab","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11"];e.fullscreen?(n.canvas.width=window.innerWidth,n.canvas.height=window.innerHeight):(n.canvas.width=(e.width||640)*n.scale,n.canvas.height=(e.height||480)*n.scale);let o=["outline: none","cursor: default"];e.crisp&&(o.push("image-rendering: pixelated"),o.push("image-rendering: crisp-edges")),n.canvas.style=o.join(";"),n.canvas.setAttribute("tabindex","0");let a=n.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0});function u(){return n.mousePos.clone()}function h(){return"pressed"===n.mouseState}function c(){return"pressed"===n.mouseState||"down"===n.mouseState}function d(){return"released"===n.mouseState}function f(e){return"pressed"===n.keyStates[e]}function m(e){return"pressed"===n.keyStates[e]||"rpressed"===n.keyStates[e]}function p(e){return"pressed"===n.keyStates[e]||"rpressed"===n.keyStates[e]||"down"===n.keyStates[e]}function g(e){return"released"===n.keyStates[e]}function y(){return[...n.charInputted]}function v(){return n.dt}function x(){return n.time}function b(){return n.fps}function k(){return n.canvas.toDataURL()}function R(e){return e&&(n.canvas.style.cursor=null!=e?e:"default"),n.canvas.style.cursor}function A(e){let t=l(r=>{let i=r/1e3,s=i-n.realTime;n.realTime=i,n.skipTime||(n.dt=s,n.time+=n.dt,n.fpsBuf.push(1/n.dt),n.fpsTimer+=n.dt,n.fpsTimer>=1&&(n.fpsTimer=0,n.fps=Math.round(n.fpsBuf.reduce((e,t)=>e+t)/n.fpsBuf.length),n.fpsBuf=[])),n.skipTime=!1,e();for(let e in n.keyStates)n.keyStates[e]=re(n.keyStates[e]);n.mouseState=re(n.mouseState),n.charInputted=[],n.stopped||(n.loopID=requestAnimationFrame(t))},"frame");n.loopID=requestAnimationFrame(t)}function P(){cancelAnimationFrame(n.loopID),n.stopped=!0}return n.isTouch="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,n.canvas.addEventListener("mousemove",e=>{n.mousePos=w(e.offsetX,e.offsetY).scale(1/n.scale)}),n.canvas.addEventListener("mousedown",()=>{n.mouseState="pressed"}),n.canvas.addEventListener("mouseup",()=>{n.mouseState="released"}),n.canvas.addEventListener("touchstart",e=>{let t=e.touches[0];n.mousePos=w(t.clientX,t.clientY).scale(1/n.scale),n.mouseState="pressed"}),n.canvas.addEventListener("touchmove",e=>{let t=e.touches[0];n.mousePos=w(t.clientX,t.clientY).scale(1/n.scale)}),n.canvas.addEventListener("keydown",e=>{let t=i[e.key]||e.key.toLowerCase();s.includes(t)&&e.preventDefault(),1===t.length&&n.charInputted.push(t),"space"===t&&n.charInputted.push(" "),e.repeat?n.keyStates[t]="rpressed":n.keyStates[t]="pressed"}),n.canvas.addEventListener("keyup",e=>{let t=i[e.key]||e.key.toLowerCase();n.keyStates[t]="released"}),n.canvas.focus(),document.addEventListener("visibilitychange",()=>{switch(document.visibilityState){case"visible":n.skipTime=!0}}),l(u,"mousePos"),l(h,"mouseClicked"),l(c,"mouseDown"),l(d,"mouseReleased"),l(f,"keyPressed"),l(m,"keyPressedRep"),l(p,"keyDown"),l(g,"keyReleased"),l(y,"charInputted"),l(v,"dt"),l(x,"time"),l(b,"fps"),l(k,"screenshot"),l(R,"cursor"),l(A,"run"),l(P,"quit"),{gl:a,mousePos:u,keyDown:p,keyPressed:f,keyPressedRep:m,keyReleased:g,mouseDown:c,mouseClicked:h,mouseReleased:d,charInputted:y,cursor:R,dt:v,time:x,fps:b,screenshot:k,run:A,quit:P}}var ie=h(()=>{U(),l(re,"processBtnState"),l(ne,"appInit")});function se(){let e=(()=>{let e=new(window.AudioContext||window.webkitAudioContext),t=e.createGain(),r=t;return r.connect(e.destination),{ctx:e,gainNode:t,masterNode:r}})();function t(t){return void 0!==t&&(e.gainNode.gain.value=m(t,oe,ae)),e.gainNode.gain.value}function r(t,r={loop:!1,volume:1,speed:1,detune:0,seek:0}){var n;let i=!1,s=e.ctx.createBufferSource();s.buffer=t,s.loop=!!r.loop;let o=e.ctx.createGain();s.connect(o),o.connect(e.masterNode);let a=null!=(n=r.seek)?n:0;s.start(0,a);let u=e.ctx.currentTime-a,l=null,h={stop(){i||(this.pause(),u=e.ctx.currentTime)},play(t){if(!i)return;let r=s;(s=e.ctx.createBufferSource()).buffer=r.buffer,s.loop=r.loop,s.playbackRate.value=r.playbackRate.value,s.detune&&(s.detune.value=r.detune.value),s.connect(o);let n=null!=t?t:this.time();s.start(0,n),u=e.ctx.currentTime-n,i=!1,l=null},pause(){i||(s.stop(),i=!0,l=e.ctx.currentTime)},paused:()=>i,stopped:()=>i,speed:e=>(void 0!==e&&(s.playbackRate.value=m(e,ue,le)),s.playbackRate.value),detune:e=>s.detune?(void 0!==e&&(s.detune.value=m(e,he,ce)),s.detune.value):0,volume:e=>(void 0!==e&&(o.gain.value=m(e,oe,ae)),o.gain.value),loop(){s.loop=!0},unloop(){s.loop=!1},duration:()=>t.duration,time:()=>i?l-u:e.ctx.currentTime-u};return h.speed(r.speed),h.detune(r.detune),h.volume(r.volume),h}function n(){return e.ctx}return l(t,"volume"),l(r,"play"),l(n,"ctx"),{ctx:n,volume:t,play:r}}var oe,ae,ue,le,he,ce,de,fe=h(()=>{U(),oe=0,ae=3,ue=0,le=3,he=-1200,ce=1200,l(se,"audioInit")}),me=h(()=>{de="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAvgAAAAICAYAAACML4vTAAAAAXNSR0IArs4c6QAABo1JREFUeJzdW9uO5SgMJKv9/1/OPnQnDabKVQb6zGgtjeYkvmJsYwh9tQLc931//7yu63retdba+/4hTZ6ZDMQ3wHVdPe1kXk/60He2D/J7HLMhGyOwHQKji/o/BYmv40DecRq+cfgr8l8dhBfRLPF3v6F9Cu/ObwFPYxRBFptE7mA/wQ2yWMwI/1r+y3Bq/h4H3TwJ3fl16xcz4UfQPB+oplF9QJ7id+SjMVjz/wf5e5rK+hKfB9+a86PsZTIm+7P6942jufsqSvg7/END5WSg6ojLt7uurcjL6v8pfQ4doinIL9v+f4HTMfQ3gopR5gOQ+6jviPj7EfLvqQGsQFiXb/B7KMBGc/rQ3x1ONuHmBmOQfd93XwDVguPI/3Uw/fc8Dz5s4/xMogU/xScNKILJb4W5Q/YyXtt+IWcyF+GzMajY7ehZbCK5vf2sGczmJ+J6O6J8pT8dB5HPwPU706/knsjfVRlxvhje0Zn5H+F/m/+kf6uA1oxqPVD1Jeqj+kHuRr5x0ZzzU8nJANrCalDS5A54xV9Ynyd+p/6bNXSiBfY5Dk1pkPyObzI0s10ceFr+3+FXsMq/qk+BM97TusU6bIvp+Flf1ufuy/OJBh817s/vlcKOaOHgRBOeyu0nppt4uIEA+gcboLLv96oIu18IFLhfSRooMh19hsvkKyNjkCo6R+fXC3ya/ddAdjrekxH2i8VmiH23oGTNYy+n2iBHyPhYjtWV8IJtyz38BW6a42JMKuJtn30IfgJT+PdkziayaP1W+OpX6J6HyJ+ac8MXaJEvNfnGGheVow34neAn/tag30aByRfI5PDBlZ9tzNghHuJDMnZpGO37rMam/L/Jj2w6wY/8TH1gPCNfQ3zxAJTZ3wPKkS9EIS9bm3OfbDonof9YWgw7gCJ0uqF+390/JIs1QZE+yhjkKOcifMKDdMX3kYbxKB3xn8fsNZEPPm2SBQ7KD/OkkgXZfYV/PV/U/+rok0IswDH+HDyCmAcuXs1LHP8gBzTyd487dIrgAPPfC489wK6K/GwjouYoo6nmZQXUHCtA9RThd+yX87fIn9X3T8Kkl2yC3zlS+NZK9XUClruFjU3093IcBFui8U79Zfg74Flj7dRHJJ/1Hq58xAs3JAdgNb9QDxHB9f8JfgSV+c96QaVnCcRhzx3+r+hXY9qtq1HmKy+up3Ft3T7BN06gWVDGZhI5JL4b6Mh9yolu5T6iukMN7M4KQqWZ/SKYP9+lYJyAOYtPveMy5IPdZja//XPVnkw+tBHdPe35w8kWs3UX+tjNrtggvpWvM3H8Lihi5f/dE1kVD068PL7O+Fc2z65eNseuDEfHKoxFpx4fjm9bS+LjFyEu4F8P4gras1geqq8QzK9wlJ3IWYJk3TtS8zbvV8MN2qGvaxQOXt3YafKe2NjN8U8A2hzGDQpdg37xqzurObB3dOY9uyYG8nG37pXjp9rg7wQm+v0A201GvGqUd4KfFlejgUobxCDjixAXod3NiWVfRaa6YsT0hitIWWAqXyr+JdhYBDJbSg32Y8fOFZvVDdziBq/cABPY8WEKpxf31fgnMM2xq681u9HYagAM/6mxDmM0eXaBNhCELgKt36Z+Vf9GYoDLrsg496TZ8yFg629dEL+D7sDq4FB8bIF7xTaxI2X8Q9dJWf7Y/ks2iPYGf2HsWf5HnOovUH2m4896Q9JDDs+rV7TduKs2+EcLNdnhvM/f+MqCEp8tO437h9C2YEP2nL7/5WR2G79sgYwGqo1ElJHu4F9msAkC84Lscxd4Bg5/ansGhVOAKf7MAuBu4NC8seJ1mQ0lku/okM090M/iS8HuAq/ivxJ/To1RMrDg/G8OTuVHub4e1j/wg9xBuF5fbPJVTlTsdOaPrmdiHVqK3UN/w+Xmz2r+K/mQf6G5RnauwDuHm80oGwCLkZMbHLYB/nkYm9Md/yF6NDa3SR9sNPM/0rD+cpgf8ws+qifOGN35XK2bHznBj3xWEKHTy+QT5HYiGJ83kW3lP5ZI4MTmKU1a9rcFbNyFT76OzVC+olP2tQYLEJNfGmO2iVs4AU/nd/PzejrHiM58z/BWvjnzs+J7QEvxzlcQgFupJxXfVuSjuFP11NFp4bI76IVnpZ/a7cxfRkNiIxtL9n41f1yayhrngmrG5LwYdWkp/x35h9Yg1WC6vlYNuStvKeZW+h9zfR/eIboHxD12Bml87PYgiCZZP5Z81fI5lrm5k0fxfWVj+x9lSgjp7YOOoAAAAABJRU5ErkJggg=="});function pe(e){let t=new Image;return t.src=e,t.crossOrigin="anonymous",new Promise((r,n)=>{t.onload=(()=>{r(t)}),t.onerror=(()=>{n(`failed to load ${e}`)})})}function ge(e){return e.startsWith("data:")}function ye(e,t,r={}){let n={lastLoaderID:0,loadRoot:"",loaders:{},sprites:{},sounds:{},fonts:{},shaders:{}};function i(e){var t;let i=n.lastLoaderID;n.loaders[i]=!1,n.lastLoaderID++,e.catch(null!=(t=r.errHandler)?t:console.error).finally(()=>{n.loaders[i]=!0})}function s(){let e=0,t=0;for(let r in n.loaders)e+=1,n.loaders[r]&&(t+=1);return t/e}function o(e){return e&&(n.loadRoot=e),n.loadRoot}function a(t,r,s,o,a=we){let u=new Promise((i,u)=>{pe(ge(r)?r:n.loadRoot+r).then(r=>{let u=e.makeFont(e.makeTex(r),s,o,a);n.fonts[t]=u,i(u)}).catch(u)});return i(u),u}function u(t,r,s={sliceX:1,sliceY:1,anims:{}}){function o(t,r,i={sliceX:1,sliceY:1,gridWidth:0,gridHeight:0,anims:{}}){let s=[],o=e.makeTex(r),a=i.sliceX||o.width/(i.gridWidth||o.width),u=i.sliceY||o.height/(i.gridHeight||o.height),l=1/a,h=1/u;for(let e=0;e<u;e++)for(let t=0;t<a;t++)s.push(S(t*l,e*h,l,h));let c={tex:o,frames:s,anims:i.anims||{}};return n.sprites[t]=c,c}l(o,"loadRawSprite");let a=new Promise((e,i)=>{if(!r)return i(`expected sprite src for "${t}"`);if("string"==typeof r){pe(ge(r)?r:n.loadRoot+r).then(r=>{e(o(t,r,s))}).catch(i)}else e(o(t,r,s))});return i(a),a}function h(t,r,s,o=!1){function a(t,r,i){let s=e.makeProgram(r,i);return n.shaders[t]=s,s}l(a,"loadRawShader");let u=new Promise((e,i)=>{if(!r&&!s)return i("no shader");function u(e){return e?fetch(n.loadRoot+e).then(t=>{if(t.ok)return t.text();throw new Error(`failed to load ${e}`)}).catch(i):new Promise(e=>e(null))}if(l(u,"resolveUrl"),o)Promise.all([u(r),u(s)]).then(([r,n])=>{e(a(t,r,n))}).catch(i);else try{e(a(t,r,s))}catch(h){i(h)}});return i(u),u}function c(e,r){let s=n.loadRoot+r,o=new Promise((i,o)=>{if(!r)return o(`expected sound src for "${e}"`);"string"==typeof r&&fetch(s).then(e=>{if(e.ok)return e.arrayBuffer();throw new Error(`failed to load ${s}`)}).then(e=>new Promise((r,n)=>{t.ctx().decodeAudioData(e,r,n)})).then(t=>{n.sounds[e]=t,i(t)}).catch(o)});return i(o),o}function d(){return n.fonts[ve]}return l(i,"addLoader"),l(s,"loadProgress"),l(o,"loadRoot"),l(a,"loadFont"),l(u,"loadSprite"),l(h,"loadShader"),l(c,"loadSound"),l(d,"defFont"),a(ve,de,8,8),{loadRoot:o,loadSprite:u,loadSound:c,loadFont:a,loadShader:h,loadProgress:s,addLoader:i,defFont:d,sprites:n.sprites,fonts:n.fonts,sounds:n.sounds,shaders:n.shaders}}var we,ve,xe=h(()=>{U(),me(),we=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",ve="unscii",l(pe,"loadImg"),l(ge,"isDataUrl"),l(ye,"assetsInit")});function be(e,t,r={max:8}){var n;let i=[],s=null!=(n=r.max)?n:8;function o(){i.length>s&&(i=i.slice(0,s));let r=w(0,e.height());i.forEach((n,i)=>{let o=g(i,0,s,1,.5),a=g(i,0,s,.8,.2),u=(()=>{switch(n.type){case"info":return E(1,1,1,o);case"error":return E(1,0,.5,o)}})(),l=e.fmtText(n.msg,t.defFont(),{pos:r,origin:"botleft",color:u,size:ke/e.scale(),width:e.width()});e.drawRect(r,l.width,l.height,{origin:"botleft",color:E(0,0,0,a)}),e.drawFmtText(l),r.y-=l.height})}function a(e){console.error(e),i.unshift({type:"error",msg:e})}function u(e){i.unshift({type:"info",msg:e})}function h(){i=[]}return l(o,"draw"),l(a,"error"),l(u,"info"),l(h,"clear"),{info:u,error:a,draw:o,clear:h}}var ke,Re=h(()=>{U(),ke=16,l(be,"loggerInit")});function Ae(e){let t={},r=[],n=null;function i(){return null!==n&&1===n.readyState}function s(){let i=new WebSocket(e);return new Promise((s,o)=>{i.onopen=(()=>{s(i),n=i;for(let e of r)i.send(e)}),i.onerror=(()=>{o(`failed to connect to ${e}`)}),i.onmessage=(e=>{let r=JSON.parse(e.data);if(t[r.type])for(let n of t[r.type])n(r.data,r.id)})})}function o(e,r){t[e]||(t[e]=[]),t[e].push(r)}function a(e,t){let i=JSON.stringify({type:e,data:t});n?n.send(i):r.push(i)}function u(){n&&n.close()}return l(i,"connected"),l(s,"connect"),l(o,"recv"),l(a,"send"),l(u,"close"),{connect:s,close:u,connected:i,recv:o,send:a}}var Pe=h(()=>{l(Ae,"netInit")}),Ee=c((e,t)=>{U(),te(),ie(),fe(),xe(),Re(),Pe(),t.exports=((e={width:640,height:480,scale:1,fullscreen:!1,debug:!1,crisp:!1,canvas:null,connect:null,logMax:8,root:document.body})=>{let t=ne({width:e.width,height:e.height,scale:e.scale,fullscreen:e.fullscreen,crisp:e.crisp,canvas:e.canvas,root:e.root}),r=J(t.gl,{clearColor:e.clearColor?E(e.clearColor):void 0,scale:e.scale,texFilter:e.texFilter}),n=se(),i=ye(r,n,{errHandler:e=>{s.error(e)}}),s=be(r,i,{max:e.logMax}),o=(()=>e.connect?Ae(e.connect):null)();function h(e,t){if(!o)throw new Error("not connected to any websockets");o.recv(e,(e,r)=>{try{t(e,r)}catch(n){s.error(n)}})}function c(e,t){if(!o)throw new Error("not connected to any websockets");o.send(e,t)}function x(){return t.dt()*tt.timeScale}function b(e,t={}){let r=i.sounds[e];if(!r)throw new Error(`sound not found: "${e}"`);return n.play(r,t)}function k(e){var t;let r=z();return!(null==(t=r.layers[null!=e?e:r.defLayer])?void 0:t.noCam)}function R(e){return k(e)?z().cam.mpos:t.mousePos()}function A(e,t={}){var n;let s=(()=>"string"==typeof e?i.sprites[e]:e)();if(!s)throw new Error(`sprite not found: "${e}"`);let o=s.frames[null!=(n=t.frame)?n:0];r.drawTexture(s.tex,u(a({},t),{quad:o}))}function O(e,t={}){var n;let s=null!=(n=t.font)?n:ve,o=i.fonts[s];if(!o)throw new Error(`font not found: ${s}`);r.drawText(e,o,t)}l(h,"recv"),l(c,"send"),l(x,"dt"),l(b,"play"),l(k,"isCamLayer"),l(R,"mousePos"),l(A,"drawSprite"),l(O,"drawText");let j=980,Y="topleft",N={loaded:!1,scenes:{},curScene:null,nextScene:null};function U(e,t){N.scenes[e]={init:t,initialized:!1,events:{add:[],update:[],draw:[],destroy:[],keyDown:[],keyPress:[],keyPressRep:[],keyRelease:[],mouseClick:[],mouseRelease:[],mouseDown:[],charInput:[]},action:[],render:[],objs:new Map,lastObjID:0,timers:{},lastTimerID:0,cam:{pos:w(r.width()/2,r.height()/2),scale:w(1,1),angle:0,shake:0,mpos:w(0),matrix:T()},layers:{},defLayer:null,gravity:j,data:{}}}function z(){return N.scenes[N.curScene]}function H(){return z().data}function G(){we("`",()=>{tt.showLog=!tt.showLog,s.info(`show log: ${tt.showLog?"on":"off"}`)}),we("f1",()=>{tt.inspect=!tt.inspect,s.info(`inspect: ${tt.inspect?"on":"off"}`)}),we("f2",()=>{tt.clearLog()}),we("f8",()=>{tt.paused=!tt.paused,s.info(`${tt.paused?"paused":"unpaused"}`)}),we("f7",()=>{tt.timeScale=m(tt.timeScale-.2,0,2),s.info(`time scale: ${tt.timeScale.toFixed(1)}`)}),we("f9",()=>{tt.timeScale=m(tt.timeScale+.2,0,2),s.info(`time scale: ${tt.timeScale.toFixed(1)}`)}),we("f10",()=>{tt.stepFrame(),s.info("stepped frame")})}function V(e,...t){N.nextScene={name:e,args:[...t]}}function K(t,...r){W(t),N.curScene=t;let n=N.scenes[t];if(!n)throw new Error(`scene not found: '${t}'`);if(!n.initialized){try{n.init(...r)}catch(i){s.error(i.stack)}e.debug&&G(),n.initialized=!0}}function W(e){if(!N.scenes[e])throw new Error(`scene not found: '${e}'`);U(e,N.scenes[e].init)}function Q(e,t){let r=z();!r||(e.forEach((e,t)=>{r.layers[e]={alpha:1,order:t+1,noCam:!1}}),t&&(r.defLayer=t))}function Z(...e){let t=z().cam;return e.length>0&&(t.pos=w(...e)),t.pos.clone()}function $(...e){let t=z().cam;return e.length>0&&(t.scale=w(...e)),t.scale.clone()}function ee(e){let t=z().cam;return void 0!==e&&(t.angle=e),t.angle}function te(e){z().cam.shake=e}function re(e){let t=z();e.forEach(e=>{t.layers[e]&&(t.layers[e].noCam=!0)})}function ie(e){let t={hidden:!1,paused:!1,_tags:[],_id:null,_events:{add:[],update:[],draw:[],destroy:[],inspect:[]},use(e){if(void 0===e)return;let t=typeof e;if("string"!==t){if("object"!==t)throw new Error(`invalid comp type: ${t}`);if(Array.isArray(e))for(let t of e)this.use(t);else for(let t in e)"function"!=typeof e[t]?this[t]=e[t]:this._events[t]?this._events[t].push(e[t].bind(this)):this[t]=e[t].bind(this)}else this._tags.push(e)},exists(){return void 0!==this._id},is(e){if("*"===e)return!0;if(Array.isArray(e)){for(let t of e)if(!this._tags.includes(t))return!1;return!0}return this._tags.includes(e)},on(e,t){this._events[e]||(this._events[e]=[]),this._events[e].push(t)},action(e){this.on("update",e)},trigger(e,...t){if(this._events[e])for(let n of this._events[e])n.call(this,...t);let r=z().events[e];if(r)for(let n of r)this.is(n.tag)&&n.cb(this,...t)},rmTag(e){let t=this._tags.indexOf(e);t>-1&&this._tags.splice(t,1)}};t.use(e);let r=z(),n=r.lastObjID++;r.objs.set(n,t),t._id=n,t.trigger("add");for(let i of r.events.add)t.is(i.tag)&&i.cb(t);return t}function oe(e){if(!e.exists())return;let t=z();t.objs.delete(e._id);let r=t.lastObjID++;return t.objs.set(r,e),e._id=r,e}function ae(e,t,r){let n=z();n.events[e]||(n.events[e]=[]),n.events[e].push({tag:t,cb:r})}function ue(e,t){"function"==typeof e&&void 0===t?z().action.push(e):"string"==typeof e&&ae("update",e,t)}function le(e,t){"function"==typeof e&&void 0===t?z().render.push(e):"string"==typeof e&&ae("update",e,t)}function he(e,t,r){ue(e,e=>{e._checkCollisions(t,t=>{r(e,t)})})}function ce(e,t,r){ue(e,e=>{e._checkOverlaps(t,t=>{r(e,t)})})}function de(e,t){ue(e,e=>{e.isClicked()&&t(e)})}function fe(e,t){return new Promise(r=>{let n=z();n.timers[n.lastTimerID++]={time:e,cb:()=>{t&&t(),r()}}})}function me(e,t){let r=!1,n=l(()=>{r||(t(),fe(e,n))},"newF");return n(),{stop(){r=!0}}}function pe(e,t,r){if(Array.isArray(t))for(let n of t)pe(e,n,r);else z().events[e].push({key:t,cb:r})}function ge(e,t){pe("keyDown",e,t)}function we(e,t){pe("keyPress",e,t)}function xe(e,t){pe("keyPressRep",e,t)}function ke(e,t){pe("keyRelease",e,t)}function Re(e){z().events.charInput.push({cb:e})}function Pe(e){z().events.mouseDown.push({cb:e})}function Ee(e){z().events.mouseClick.push({cb:e})}function Se(e){z().events.mouseRelease.push({cb:e})}function Te(e){let t=z(),r=[...t.objs.values()].sort((e,r)=>{var n,i,s,o,a,u;return(null!=(s=null==(i=t.layers[null!=(n=e.layer)?n:t.defLayer])?void 0:i.order)?s:0)-(null!=(u=null==(a=t.layers[null!=(o=r.layer)?o:t.defLayer])?void 0:a.order)?u:0)});return e?r.filter(t=>t.is(e)):r}function _e(e,t){"function"==typeof e&&void 0===t?Te().forEach(e):"string"==typeof e&&Te(e).forEach(t)}function De(e,t){"function"==typeof e&&void 0===t?Te().reverse().forEach(e):"string"==typeof e&&Te(e).reverse().forEach(t)}function Fe(e){if(!e.exists())return;let t=z();!t||(e.trigger("destroy"),t.objs.delete(e._id),delete e._id)}function Me(e){_e(e,e=>{Fe(e)})}function Ie(e){let t=z();return void 0!==e&&(t.gravity=e),t.gravity}function Le(e){let n=z();if(!n)throw new Error(`scene not found: '${N.curScene}'`);let i=e||!tt.paused;if(i)for(let t in n.timers){let e=n.timers[t];e.time-=x(),e.time<=0&&(e.cb(),delete n.timers[t])}if(De(e=>{!e.paused&&i&&e.trigger("update")}),i)for(let t of n.action)t();let s=w(r.width(),r.height()),o=n.cam,a=v(M(0,2*Math.PI)).scale(o.shake);o.shake=p(o.shake,0,5*x()),o.matrix=T().translate(s.scale(.5)).scale(o.scale).rotateZ(o.angle).translate(s.scale(-.5)).translate(o.pos.scale(-1).add(s.scale(.5)).add(a)),o.mpos=o.matrix.invert().multVec2(t.mousePos()),_e(e=>{e.hidden||(r.pushTransform(),k(e.layer)&&r.pushMatrix(o.matrix),e.trigger("draw"),r.popTransform())});for(let t of n.render)t()}function Ce(){let e=z();for(let r of e.events.charInput)t.charInputted().forEach(r.cb);for(let r of e.events.keyDown)t.keyDown(r.key)&&r.cb();for(let r of e.events.keyPress)t.keyPressed(r.key)&&r.cb();for(let r of e.events.keyPressRep)t.keyPressedRep(r.key)&&r.cb();for(let r of e.events.keyRelease)t.keyReleased(r.key)&&r.cb();for(let r of e.events.mouseDown)t.mouseDown()&&r.cb();for(let r of e.events.mouseClick)t.mouseClicked()&&r.cb();for(let r of e.events.mouseRelease)t.mouseReleased()&&r.cb()}function qe(){var n;let s=z(),o=null,a=i.defFont(),u=E(null!=(n=e.inspectColor)?n:[0,1,1,1]);function h(e,t,n){let i=w(4).scale(1/n),s=r.fmtText(t,a,{size:12/n,pos:e.add(w(i.x,i.y))});r.drawRect(e,s.width+2*i.x,s.height+2*i.x,{color:E(0,0,0,1)}),r.drawFmtText(s)}function c(e,t){let n=k(e.layer),i=r.scale()*(n?(s.cam.scale.x+s.cam.scale.y)/2:1);n&&(r.pushTransform(),r.pushMatrix(s.cam.matrix)),t(i),n&&r.popTransform()}l(h,"drawInspectTxt"),l(c,"drawObj"),De(e=>{!e.area||e.hidden||c(e,t=>{o||e.isHovered()&&(o=e);let n=(o===e?6:2)/t,i=e._worldArea(),s=i.p2.x-i.p1.x,a=i.p2.y-i.p1.y;r.drawRectStroke(i.p1,s,a,{width:n,color:u})})}),o&&c(o,e=>{let t=R(o.layer),r=[];for(let n of o._tags)r.push(`"${n}"`);for(let n of o._events.inspect){let e=n();for(let t in e)r.push(`${t}: ${e[t]}`)}h(t,r.join("\n"),e)}),h(w(0),t.fps()+"",r.scale())}function Be(e,...n){t.run(()=>{if(r.frameStart(),N.loaded){try{if(!z())throw new Error(`scene not found: '${N.curScene}'`);Ce(),Le(),tt.inspect&&qe()}catch(a){s.error(a.stack),t.quit()}tt.showLog&&s.draw(),N.nextScene&&(K.apply(null,[N.nextScene.name,...N.nextScene.args]),N.nextScene=null)}else{let t=i.loadProgress();if(1===t)N.loaded=!0,K(e,...n),o&&o.connect().catch(s.error);else{let e=r.width()/2,n=24/r.scale(),i=w(r.width()/2,r.height()/2).sub(w(e/2,n/2));r.drawRect(w(0),r.width(),r.height(),{color:P(0,0,0)}),r.drawRectStroke(i,e,n,{width:4/r.scale()}),r.drawRect(i,e*t,n)}}r.frameEnd()})}function Oe(...e){return{pos:w(...e),move(...e){let t=w(...e),r=t.x*x(),n=t.y*x();this.pos.x+=r,this.pos.y+=n},inspect(){return{pos:`(${~~this.pos.x}, ${~~this.pos.y})`}}}}function je(...e){return 0===e.length?je(1):{scale:w(...e),flipX(e){this.scale.x=Math.sign(e)*Math.abs(this.scale.x)},flipY(e){this.scale.y=Math.sign(e)*Math.abs(this.scale.y)}}}function Ye(e){return{angle:null!=e?e:0}}function Ne(...e){return{color:E(...e)}}function Ue(e){return{origin:e}}function ze(e){return{layer:e,inspect(){var e;let t=z();return{layer:null!=(e=this.layer)?e:t.defLayer}}}}function He(e,t){var r,n;let i=z();return(null!=(r=e.layer)?r:i.defLayer)===(null!=(n=t.layer)?n:i.defLayer)}function Xe(e,r){let n={},i={};return{area:{p1:e,p2:r},areaWidth(){let{p1:e,p2:t}=this._worldArea();return t.x-e.x},areaHeight(){let{p1:e,p2:t}=this._worldArea();return t.y-e.y},isClicked(){return t.mouseClicked()&&this.isHovered()},isHovered(){return this.hasPt(R(this.layer))},isCollided(e){if(!e.area||!He(this,e))return!1;return C(this._worldArea(),e._worldArea())},isOverlapped(e){if(!e.area||!He(this,e))return!1;return q(this._worldArea(),e._worldArea())},clicks(e){this.action(()=>{this.isClicked()&&e()})},hovers(e){this.action(()=>{this.isHovered()&&e()})},collides(e,t){this.action(()=>{this._checkCollisions(e,t)})},overlaps(e,t){this.action(()=>{this._checkOverlaps(e,t)})},hasPt(e){let t=this._worldArea();return B({p1:t.p1,p2:t.p2},e)},resolve(){let e=[];return _e(t=>{if(t===this||!t.solid||!t.area||!He(this,t))return;let r=this._worldArea(),n=t._worldArea();if(!C(r,n))return;let i=r.p2.x-n.p1.x,s=n.p2.x-r.p1.x,o=r.p2.y-n.p1.y,a=n.p2.y-r.p1.y,u=Math.min(i,s,o,a),l=(()=>{switch(u){case i:return this.pos.x-=i,"right";case s:return this.pos.x+=s,"left";case o:return this.pos.y-=o,"bottom";case a:return this.pos.y+=a,"top"}})();e.push({obj:t,side:l})}),e},_checkCollisions(e,t){_e(e,e=>{this!==e&&(n[e._id]||this.isCollided(e)&&(t(e),n[e._id]=e))});for(let r in n){let e=n[r];this.isCollided(e)||delete n[r]}},_checkOverlaps(e,t){_e(e,e=>{this!==e&&(i[e._id]||this.isOverlapped(e)&&(t(e),i[e._id]=e))});for(let r in i){let e=i[r];this.isOverlapped(e)||delete i[r]}},_worldArea(){let e=this.area,t=this.pos||w(0),r=this.scale||w(1),n=t.add(e.p1.dot(r)),i=t.add(e.p2.dot(r));return{p1:w(Math.min(n.x,i.x),Math.min(n.y,i.y)),p2:w(Math.max(n.x,i.x),Math.max(n.y,i.y))}}}}function Je(e,t,r){let n=w(e,t),i=X(r||Y).dot(n).scale(-.5);return Xe(i.sub(n.scale(.5)),i.add(n.scale(.5)))}function Ge(e,t={}){let r=i.sprites[e];if(!r)throw new Error(`sprite not found: "${e}"`);let n=a({},r.frames[0]);t.quad&&(n.x+=t.quad.x*n.w,n.y+=t.quad.y*n.h,n.w*=t.quad.w,n.h*=t.quad.h);let s=r.tex.width*n.w,o=r.tex.height*n.h,u=null;return{width:s,height:o,animSpeed:t.animSpeed||.1,frame:t.frame||0,quad:t.quad||S(0,0,1,1),add(){!this.area&&!t.noArea&&this.use(Je(this.width,this.height,this.origin))},draw(){z(),r.frames[this.frame];A(r,{pos:this.pos,scale:this.scale,rot:this.angle,color:this.color,frame:this.frame,origin:this.origin,quad:this.quad,prog:i.shaders[this.shader],uniform:this.uniform})},update(){if(!u)return;let e=r.anims[u.name];u.timer+=x(),u.timer>=this.animSpeed&&(this.frame++,this.frame>e.to&&(u.loop?this.frame=e.from:(this.frame--,this.stop())),u&&(u.timer-=this.animSpeed))},play(e,t=!0){let n=r.anims[e];if(!n)throw new Error(`anim not found: ${e}`);u&&this.stop(),u={name:e,loop:t,timer:0},this.frame=n.from,this.trigger("animPlay",e)},stop(){if(!u)return;let e=u.name;u=null,this.trigger("animEnd",e)},changeSprite(e){if(!(r=i.sprites[e]))throw new Error(`sprite not found: "${e}"`);let n=a({},r.frames[0]);t.quad&&(n.x+=t.quad.x*n.w,n.y+=t.quad.y*n.h,n.w*=t.quad.w,n.h*=t.quad.h),this.width=r.tex.width*n.w,this.height=r.tex.height*n.h,this.area&&!t.noArea&&this.use(Je(this.width,this.height,this.origin)),u=null,this.frame=0},numFrames:()=>r.frames.length,curAnim:()=>null==u?void 0:u.name,inspect(){let e={};return u&&(e.curAnim=`"${u.name}"`),e}}}function Ve(e,t,n={}){return{text:e,textSize:t,font:n.font,width:0,height:0,add(){var e,t,s;if(!this.area&&!n.noArea){z();let o=i.fonts[null!=(e=this.font)?e:ve],a=r.fmtText(this.text+"",o,{pos:this.pos,scale:this.scale,rot:this.angle,size:this.textSize,origin:this.origin,color:this.color,width:n.width});this.width=a.width/((null==(t=this.scale)?void 0:t.x)||1),this.height=a.height/((null==(s=this.scale)?void 0:s.y)||1),this.use(Je(this.width,this.height,this.origin))}},draw(){var e;z();let t=i.fonts[null!=(e=this.font)?e:ve],s=r.fmtText(this.text+"",t,{pos:this.pos,scale:this.scale,rot:this.angle,size:this.textSize,origin:this.origin,color:this.color,width:n.width});this.width=s.width,this.height=s.height,r.drawFmtText(s)}}}function Ke(e,t,n={}){return{width:e,height:t,add(){!this.area&&!n.noArea&&this.use(Je(this.width,this.height,this.origin))},draw(){z();r.drawRect(this.pos,this.width,this.height,{scale:this.scale,rot:this.angle,color:this.color,origin:this.origin,prog:i.shaders[this.shader],uniform:this.uniform})}}}function We(){return{solid:!0}}l(U,"scene"),l(z,"curScene"),l(H,"sceneData"),l(G,"regDebugInputs"),l(V,"go"),l(K,"goSync"),l(W,"reload"),l(Q,"layers"),l(Z,"camPos"),l($,"camScale"),l(ee,"camRot"),l(te,"camShake"),l(re,"camIgnore"),l(ie,"add"),l(oe,"readd"),l(ae,"on"),l(ue,"action"),l(le,"render"),l(he,"collides"),l(ce,"overlaps"),l(de,"clicks"),l(fe,"wait"),l(me,"loop"),l(pe,"pushKeyEvent"),l(ge,"keyDown"),l(we,"keyPress"),l(xe,"keyPressRep"),l(ke,"keyRelease"),l(Re,"charInput"),l(Pe,"mouseDown"),l(Ee,"mouseClick"),l(Se,"mouseRelease"),l(Te,"get"),l(_e,"every"),l(De,"revery"),l(Fe,"destroy"),l(Me,"destroyAll"),l(Ie,"gravity"),l(Le,"gameFrame"),l(Ce,"handleEvents"),l(qe,"drawInspect"),l(Be,"start"),l(Oe,"pos"),l(je,"scale"),l(Ye,"rotate"),l(Ne,"color"),l(Ue,"origin"),l(ze,"layer"),l(He,"isSameLayer"),l(Xe,"area"),l(Je,"getAreaFromSize"),l(Ge,"sprite"),l(Ve,"text"),l(Ke,"rect"),l(We,"solid");let Qe=960,Ze=480;function $e(e={}){var t,r;let n=0,i=null,s=null,o=null!=(t=e.maxVel)?t:Qe;return{jumpForce:null!=(r=e.jumpForce)?r:Ze,update(){this.move(0,n);let e=this.resolve(),t=!1;if(i&&(i.exists()&&this.isCollided(i)?s&&(this.pos=this.pos.add(i.pos.sub(s)),s=i.pos.clone()):(i=null,s=null,t=!0)),!i){n=Math.min(n+Ie()*x(),o);for(let r of e)"bottom"===r.side&&n>0?(i=r.obj,n=0,s=i.pos.clone(),t||this.trigger("grounded",i)):"top"===r.side&&n<0&&(n=0,this.trigger("headbump",r.obj))}},curPlatform:()=>i,grounded:()=>null!==i,falling:()=>n>0,jump(e){i=null,n=-e||-this.jumpForce}}}function et(e,t={}){i.shaders[e];return{shader:e,uniform:t}}l($e,"body"),l(et,"shader");let tt={paused:!1,inspect:!1,timeScale:1,showLog:!0,fps:t.fps,objCount:()=>z().objs.size,stepFrame(){Le(!0)},drawCalls:r.drawCalls,clearLog:s.clear,log:s.info,error:s.error};function rt(e,t){let r=[],n=w(t.pos||0),i=0,s={getPos(...e){let r=w(...e);return w(n.x+r.x*t.width,n.y+r.y*t.height)},spawn(e,i){let s=(()=>{if(Array.isArray(e))return e;if(t[e]){if("function"==typeof t[e])return t[e]();if(Array.isArray(t[e]))return[...t[e]]}else if(t.any)return t.any(e)})();if(!s)return;s.push(Oe(n.x+i.x*t.width,n.y+i.y*t.height));let o=ie(s);return r.push(o),o.use({gridPos:i.clone(),setGridPos(e){this.gridPos=e.clone(),this.pos=w(n.x+this.gridPos.x*t.width,n.y+this.gridPos.y*t.height)},moveLeft(){this.setGridPos(this.gridPos.add(w(-1,0)))},moveRight(){this.setGridPos(this.gridPos.add(w(1,0)))},moveUp(){this.setGridPos(this.gridPos.add(w(0,-1)))},moveDown(){this.setGridPos(this.gridPos.add(w(0,1)))}}),o},width:()=>i*t.width,height:()=>e.length*t.height,destroy(){for(let e of r)Fe(e)}};return e.forEach((e,t)=>{let r=e.split("");i=Math.max(r.length,i),r.forEach((e,r)=>{s.spawn(e,w(r,t))})}),s}l(rt,"addLevel");let nt={start:Be,loadRoot:i.loadRoot,loadSprite:i.loadSprite,loadSound:i.loadSound,loadFont:i.loadFont,loadShader:i.loadShader,addLoader:i.addLoader,width:r.width,height:r.height,dt:x,time:t.time,screenshot:t.screenshot,scene:U,go:V,sceneData:H,layers:Q,camPos:Z,camScale:$,camRot:ee,camShake:te,camIgnore:re,gravity:Ie,add:ie,readd:oe,destroy:Fe,destroyAll:Me,get:Te,every:_e,revery:De,send:c,recv:h,pos:Oe,scale:je,rotate:Ye,color:Ne,origin:Ue,layer:ze,area:Xe,sprite:Ge,text:Ve,rect:Ke,solid:We,body:$e,shader:et,on:ae,action:ue,render:le,collides:he,overlaps:ce,clicks:de,keyDown:ge,keyPress:we,keyPressRep:xe,keyRelease:ke,charInput:Re,mouseDown:Pe,mouseClick:Ee,mouseRelease:Se,mousePos:R,cursor:t.cursor,keyIsDown:t.keyDown,keyIsPressed:t.keyPressed,keyIsPressedRep:t.keyPressedRep,keyIsReleased:t.keyReleased,mouseIsDown:t.mouseDown,mouseIsClicked:t.mouseClicked,mouseIsReleased:t.mouseReleased,loop:me,wait:fe,play:b,volume:n.volume,makeRng:D,rand:M,randSeed:F,vec2:w,rgb:P,rgba:E,quad:S,choose:L,chance:I,lerp:p,map:g,mapc:y,wave:_,deg2rad:d,rad2deg:f,drawSprite:A,drawText:O,drawRect:r.drawRect,drawRectStroke:r.drawRectStroke,drawLine:r.drawLine,debug:tt,addLevel:rt};if(e.plugins)for(let a of e.plugins){let e=a(nt);for(let t in e)nt[t]=e[t]}if(e.global)for(let a in nt)window[a]=nt[a];return nt})}),Se=Ee();exports.default=Se;
},{}],"wdwR":[function(require,module,exports) {
var define;
var global = arguments[3];
var e,t=arguments[3];function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(t,i){"object"===("undefined"==typeof exports?"undefined":n(exports))&&"undefined"!=typeof module?i(exports):"function"==typeof e&&e.amd?e("colyseus.js",["exports"],i):i((t="undefined"!=typeof globalThis?globalThis:t||self).Colyseus={})}(this,function(e){"use strict";ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return null!==e&&"object"===n(e)&&e.buffer instanceof ArrayBuffer}),"undefined"==typeof globalThis&&"undefined"!=typeof window&&(window.globalThis=window);var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function o(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{f(i.next(e))}catch(t){o(t)}}function a(e){try{f(i.throw(e))}catch(t){o(t)}}function f(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}f((i=i.apply(e,t||[])).next())})}function s(e,t){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(a){o=[6,a],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function a(e,t){t.headers=e.headers||{},t.statusMessage=e.statusText,t.statusCode=e.status,t.data=e.response}function f(e,t,i){return new Promise(function(r,o){i=i||{};var s,f,h,c=new XMLHttpRequest,u=i.body,d=i.headers||{};for(s in i.timeout&&(c.timeout=i.timeout),c.ontimeout=c.onerror=function(e){e.timeout="timeout"==e.type,o(e)},c.open(e,t.href||t),c.onload=function(){for(h=c.getAllResponseHeaders().trim().split(/[\r\n]+/),a(c,c);f=h.shift();)f=f.split(": "),c.headers[f.shift().toLowerCase()]=f.join(": ");if((f=c.headers["content-type"])&&~f.indexOf("application/json"))try{c.data=JSON.parse(c.data,i.reviver)}catch(e){return a(c,e),o(e)}(c.status>=400?o:r)(c)},("undefined"==typeof FormData?"undefined":n(FormData))<"u"&&u instanceof FormData||u&&"object"==n(u)&&(d["content-type"]="application/json",u=JSON.stringify(u)),c.withCredentials=!!i.withCredentials,d)c.setRequestHeader(s,d[s]);c.send(u)})}var h=f.bind(f,"GET"),c=f.bind(f,"POST"),u=f.bind(f,"PATCH"),d=f.bind(f,"DELETE"),p=h,l=u,v=c,y=f.bind(f,"PUT"),g=f,m={del:d,get:p,patch:l,post:v,put:y,send:g},_=Object.freeze(Object.assign(Object.create(null),m,{default:m,del:d,get:p,patch:l,post:v,put:y,send:g})),w=function(e){function t(t,n){var i=e.call(this,n)||this;return i.name="ServerError",i.code=t,i}return r(t,e),t}(Error);function A(e,t){if(this._offset=t,e instanceof ArrayBuffer)this._buffer=e,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(e))throw new Error("Invalid argument");this._buffer=e.buffer,this._view=new DataView(this._buffer,e.byteOffset,e.byteLength)}}function $(e,t,n){for(var i=0,r=0,o=n.length;r<o;r++)(i=n.charCodeAt(r))<128?e.setUint8(t++,i):i<2048?(e.setUint8(t++,192|i>>6),e.setUint8(t++,128|63&i)):i<55296||i>=57344?(e.setUint8(t++,224|i>>12),e.setUint8(t++,128|i>>6&63),e.setUint8(t++,128|63&i)):(r++,i=65536+((1023&i)<<10|1023&n.charCodeAt(r)),e.setUint8(t++,240|i>>18),e.setUint8(t++,128|i>>12&63),e.setUint8(t++,128|i>>6&63),e.setUint8(t++,128|63&i))}function E(e){var t=[],i=[],r=function e(t,i,r){var o=n(r),s=0,a=0,f=0,h=0,c=0,u=0;if("string"===o){if((c=function(e){for(var t=0,n=0,i=0,r=e.length;i<r;i++)(t=e.charCodeAt(i))<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(i++,n+=4);return n}(r))<32)t.push(160|c),u=1;else if(c<256)t.push(217,c),u=2;else if(c<65536)t.push(218,c>>8,c),u=3;else{if(!(c<4294967296))throw new Error("String too long");t.push(219,c>>24,c>>16,c>>8,c),u=5}return i.push({_str:r,_length:c,_offset:t.length}),u+c}if("number"===o)return Math.floor(r)===r&&isFinite(r)?r>=0?r<128?(t.push(r),1):r<256?(t.push(204,r),2):r<65536?(t.push(205,r>>8,r),3):r<4294967296?(t.push(206,r>>24,r>>16,r>>8,r),5):(f=r/Math.pow(2,32)>>0,h=r>>>0,t.push(207,f>>24,f>>16,f>>8,f,h>>24,h>>16,h>>8,h),9):r>=-32?(t.push(r),1):r>=-128?(t.push(208,r),2):r>=-32768?(t.push(209,r>>8,r),3):r>=-2147483648?(t.push(210,r>>24,r>>16,r>>8,r),5):(f=Math.floor(r/Math.pow(2,32)),h=r>>>0,t.push(211,f>>24,f>>16,f>>8,f,h>>24,h>>16,h>>8,h),9):(t.push(203),i.push({_float:r,_length:8,_offset:t.length}),9);if("object"===o){if(null===r)return t.push(192),1;if(Array.isArray(r)){if((c=r.length)<16)t.push(144|c),u=1;else if(c<65536)t.push(220,c>>8,c),u=3;else{if(!(c<4294967296))throw new Error("Array too large");t.push(221,c>>24,c>>16,c>>8,c),u=5}for(s=0;s<c;s++)u+=e(t,i,r[s]);return u}if(r instanceof Date){var d=r.getTime();return f=Math.floor(d/Math.pow(2,32)),h=d>>>0,t.push(215,0,f>>24,f>>16,f>>8,f,h>>24,h>>16,h>>8,h),10}if(r instanceof ArrayBuffer){if((c=r.byteLength)<256)t.push(196,c),u=2;else if(c<65536)t.push(197,c>>8,c),u=3;else{if(!(c<4294967296))throw new Error("Buffer too large");t.push(198,c>>24,c>>16,c>>8,c),u=5}return i.push({_bin:r,_length:c,_offset:t.length}),u+c}if("function"==typeof r.toJSON)return e(t,i,r.toJSON());var p=[],l="",v=Object.keys(r);for(s=0,a=v.length;s<a;s++)"function"!=typeof r[l=v[s]]&&p.push(l);if((c=p.length)<16)t.push(128|c),u=1;else if(c<65536)t.push(222,c>>8,c),u=3;else{if(!(c<4294967296))throw new Error("Object too large");t.push(223,c>>24,c>>16,c>>8,c),u=5}for(s=0;s<c;s++)u+=e(t,i,l=p[s]),u+=e(t,i,r[l]);return u}if("boolean"===o)return t.push(r?195:194),1;if("undefined"===o)return t.push(212,0,0),3;throw new Error("Could not encode")}(t,i,e),o=new ArrayBuffer(r),s=new DataView(o),a=0,f=0,h=-1;i.length>0&&(h=i[0]._offset);for(var c,u=0,d=0,p=0,l=t.length;p<l;p++)if(s.setUint8(f+p,t[p]),p+1===h){if(u=(c=i[a])._length,d=f+h,c._bin)for(var v=new Uint8Array(c._bin),y=0;y<u;y++)s.setUint8(d+y,v[y]);else c._str?$(s,d,c._str):void 0!==c._float&&s.setFloat64(d,c._float);f+=u,i[++a]&&(h=i[a]._offset)}return o}A.prototype._array=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=this._parse();return t},A.prototype._map=function(e){for(var t={},n=0;n<e;n++)t[this._parse()]=this._parse();return t},A.prototype._str=function(e){var t=function(e,t,n){for(var i="",r=0,o=t,s=t+n;o<s;o++){var a=e.getUint8(o);if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));(r=(7&a)<<18|(63&e.getUint8(++o))<<12|(63&e.getUint8(++o))<<6|(63&e.getUint8(++o))<<0)>=65536?(r-=65536,i+=String.fromCharCode(55296+(r>>>10),56320+(1023&r))):i+=String.fromCharCode(r)}else i+=String.fromCharCode((15&a)<<12|(63&e.getUint8(++o))<<6|(63&e.getUint8(++o))<<0);else i+=String.fromCharCode((31&a)<<6|63&e.getUint8(++o));else i+=String.fromCharCode(a)}return i}(this._view,this._offset,e);return this._offset+=e,t},A.prototype._bin=function(e){var t=this._buffer.slice(this._offset,this._offset+e);return this._offset+=e,t},A.prototype._parse=function(){var e,t=this._view.getUint8(this._offset++),n=0,i=0,r=0,o=0;if(t<192)return t<128?t:t<144?this._map(15&t):t<160?this._array(15&t):this._str(31&t);if(t>223)return-1*(255-t+1);switch(t){case 192:return null;case 194:return!1;case 195:return!0;case 196:return n=this._view.getUint8(this._offset),this._offset+=1,this._bin(n);case 197:return n=this._view.getUint16(this._offset),this._offset+=2,this._bin(n);case 198:return n=this._view.getUint32(this._offset),this._offset+=4,this._bin(n);case 199:return n=this._view.getUint8(this._offset),i=this._view.getInt8(this._offset+1),this._offset+=2,[i,this._bin(n)];case 200:return n=this._view.getUint16(this._offset),i=this._view.getInt8(this._offset+2),this._offset+=3,[i,this._bin(n)];case 201:return n=this._view.getUint32(this._offset),i=this._view.getInt8(this._offset+4),this._offset+=5,[i,this._bin(n)];case 202:return e=this._view.getFloat32(this._offset),this._offset+=4,e;case 203:return e=this._view.getFloat64(this._offset),this._offset+=8,e;case 204:return e=this._view.getUint8(this._offset),this._offset+=1,e;case 205:return e=this._view.getUint16(this._offset),this._offset+=2,e;case 206:return e=this._view.getUint32(this._offset),this._offset+=4,e;case 207:return r=this._view.getUint32(this._offset)*Math.pow(2,32),o=this._view.getUint32(this._offset+4),this._offset+=8,r+o;case 208:return e=this._view.getInt8(this._offset),this._offset+=1,e;case 209:return e=this._view.getInt16(this._offset),this._offset+=2,e;case 210:return e=this._view.getInt32(this._offset),this._offset+=4,e;case 211:return r=this._view.getInt32(this._offset)*Math.pow(2,32),o=this._view.getUint32(this._offset+4),this._offset+=8,r+o;case 212:return i=this._view.getInt8(this._offset),this._offset+=1,0===i?void(this._offset+=1):[i,this._bin(1)];case 213:return i=this._view.getInt8(this._offset),this._offset+=1,[i,this._bin(2)];case 214:return i=this._view.getInt8(this._offset),this._offset+=1,[i,this._bin(4)];case 215:return i=this._view.getInt8(this._offset),this._offset+=1,0===i?(r=this._view.getInt32(this._offset)*Math.pow(2,32),o=this._view.getUint32(this._offset+4),this._offset+=8,new Date(r+o)):[i,this._bin(8)];case 216:return i=this._view.getInt8(this._offset),this._offset+=1,[i,this._bin(16)];case 217:return n=this._view.getUint8(this._offset),this._offset+=1,this._str(n);case 218:return n=this._view.getUint16(this._offset),this._offset+=2,this._str(n);case 219:return n=this._view.getUint32(this._offset),this._offset+=4,this._str(n);case 220:return n=this._view.getUint16(this._offset),this._offset+=2,this._array(n);case 221:return n=this._view.getUint32(this._offset),this._offset+=4,this._array(n);case 222:return n=this._view.getUint16(this._offset),this._offset+=2,this._map(n);case 223:return n=this._view.getUint32(this._offset),this._offset+=4,this._map(n)}throw new Error("Could not parse")};var O,I,b=globalThis.WebSocket||function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},x=function(){function e(e){this.events=e}return e.prototype.send=function(e){e instanceof ArrayBuffer?this.ws.send(e):Array.isArray(e)&&this.ws.send(new Uint8Array(e).buffer)},e.prototype.connect=function(e){this.ws=new b(e,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror},e.prototype.close=function(e,t){this.ws.close(e,t)},e}(),R=function(){function e(){this.events={},this.transport=new x(this.events)}return e.prototype.send=function(e){this.transport.send(e)},e.prototype.connect=function(e){this.transport.connect(e)},e.prototype.close=function(e,t){this.transport.close(e,t)},e}(),T={};function C(e,t){T[e]=t}function P(e){var t=T[e];if(!t)throw new Error("missing serializer: "+e);return t}e.Protocol=void 0,(O=e.Protocol||(e.Protocol={}))[O.HANDSHAKE=9]="HANDSHAKE",O[O.JOIN_ROOM=10]="JOIN_ROOM",O[O.ERROR=11]="ERROR",O[O.LEAVE_ROOM=12]="LEAVE_ROOM",O[O.ROOM_DATA=13]="ROOM_DATA",O[O.ROOM_STATE=14]="ROOM_STATE",O[O.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",O[O.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",e.ErrorCode=void 0,(I=e.ErrorCode||(e.ErrorCode={}))[I.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",I[I.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",I[I.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",I[I.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",I[I.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",I[I.AUTH_FAILED=4215]="AUTH_FAILED",I[I.APPLICATION_ERROR=4216]="APPLICATION_ERROR";var S=function(){return{events:{},emit:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];(this.events[e]||[]).forEach(function(e){return e.apply(void 0,n)})},on:function(e,t){var n=this;return(this.events[e]=this.events[e]||[]).push(t),function(){return n.events[e]=(n.events[e]||[]).filter(function(e){return e!==t})}}}},N=function(){function e(){this.handlers=[]}return e.prototype.register=function(e,t){return this.handlers.push(e),this},e.prototype.invoke=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.handlers.forEach(function(n){return n.apply(e,t)})},e.prototype.invokeAsync=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Promise.all(this.handlers.map(function(n){return n.apply(e,t)}))},e.prototype.remove=function(e){var t=this.handlers.indexOf(e);this.handlers[t]=this.handlers[this.handlers.length-1],this.handlers.pop()},e.prototype.clear=function(){this.handlers=[]},e}();function D(){var e=new N;function t(t){return e.register(t,null===this)}return t.once=function(t){e.register(function n(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];t.apply(this,i),e.remove(n)})},t.remove=function(t){return e.remove(t)},t.invoke=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.invoke.apply(e,t)},t.invokeAsync=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.invokeAsync.apply(e,t)},t.clear=function(){return e.clear()},t}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t||"undefined"!=typeof self&&self;var M,k,j=(function(e,t){!function(e){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,n)};function i(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}function r(e,t,i,r){var o,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"===("undefined"==typeof Reflect?"undefined":n(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var f=e.length-1;f>=0;f--)(o=e[f])&&(a=(s<3?o(a):s>3?o(t,i,a):o(t,i))||a);return s>3&&a&&Object.defineProperty(t,i,a),a}function o(e,t){for(var n=0,i=t.length,r=e.length;n<i;n++,r++)e[r]=t[n];return e}var s,a=255;e.OPERATION=void 0,(s=e.OPERATION||(e.OPERATION={}))[s.ADD=128]="ADD",s[s.REPLACE=0]="REPLACE",s[s.DELETE=64]="DELETE",s[s.DELETE_AND_ADD=192]="DELETE_AND_ADD",s[s.TOUCH=1]="TOUCH",s[s.CLEAR=10]="CLEAR";var f=function(){function e(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return e.prototype.getNextUniqueId=function(){return this.nextUniqueId++},e.prototype.addRef=function(e,t,n){void 0===n&&(n=!0),this.refs.set(e,t),n&&(this.refCounts[e]=(this.refCounts[e]||0)+1)},e.prototype.removeRef=function(e){this.refCounts[e]=this.refCounts[e]-1,this.deletedRefs.add(e)},e.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},e.prototype.garbageCollectDeletedRefs=function(){var e=this;this.deletedRefs.forEach(function(t){if(e.refCounts[t]<=0){var n=e.refs.get(t);if(n instanceof ce)for(var i in n._definition.schema)"string"!=typeof n._definition.schema[i]&&n[i]&&n[i].$changes&&e.removeRef(n[i].$changes.refId);else{var r=n.$changes.parent._definition,o=r.schema[r.fieldsByIndex[n.$changes.parentIndex]];"function"==typeof Object.values(o)[0]&&Array.from(n.values()).forEach(function(t){return e.removeRef(t.$changes.refId)})}e.refs.delete(t),delete e.refCounts[t]}}),this.deletedRefs.clear()},e}(),h=function(){function t(e,t,n){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=e,this.setParent(t,n)}return t.prototype.setParent=function(e,t,i){var r=this;if(this.indexes||(this.indexes=this.ref instanceof ce?this.ref._definition.indexes:{}),this.parent=e,this.parentIndex=i,t)if(this.root=t,this.ref instanceof ce){var o=this.ref._definition;for(var s in o.schema){var a=this.ref[s];if(a&&a.$changes){var f=o.indexes[s];a.$changes.setParent(this.ref,t,f)}}}else"object"===n(this.ref)&&this.ref.forEach(function(e,t){if(e instanceof ce){var n=e.$changes,i=r.ref.$changes.indexes[t];n.setParent(r.ref,r.root,i)}})},t.prototype.operation=function(e){this.changes.set(--this.currentCustomOperation,e)},t.prototype.change=function(t,n){void 0===n&&(n=e.OPERATION.ADD);var i="number"==typeof t?t:this.indexes[t];this.assertValidIndex(i,t);var r=this.changes.get(i);r&&r.op!==e.OPERATION.DELETE&&r.op!==e.OPERATION.TOUCH||this.changes.set(i,{op:r&&r.op===e.OPERATION.DELETE?e.OPERATION.DELETE_AND_ADD:n,index:i}),this.allChanges.add(i),this.changed=!0,this.touchParents()},t.prototype.touch=function(t){var n="number"==typeof t?t:this.indexes[t];this.assertValidIndex(n,t),this.changes.has(n)||this.changes.set(n,{op:e.OPERATION.TOUCH,index:n}),this.allChanges.add(n),this.touchParents()},t.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},t.prototype.getType=function(e){if(this.ref._definition){var t=this.ref._definition;return t.schema[t.fieldsByIndex[e]]}var t=this.parent._definition,n=t.schema[t.fieldsByIndex[this.parentIndex]];return Object.values(n)[0]},t.prototype.getChildrenFilter=function(){var e=this.parent._definition.childFilters;return e&&e[this.parentIndex]},t.prototype.getValue=function(e){return this.ref.getByIndex(e)},t.prototype.delete=function(t){var n="number"==typeof t?t:this.indexes[t];if(void 0!==n){var i=this.getValue(n);this.changes.set(n,{op:e.OPERATION.DELETE,index:n}),this.allChanges.delete(n),delete this.caches[n],i&&i.$changes&&(i.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema "+this.ref.constructor.name+": trying to delete non-existing index: "+t+" ("+n+")")},t.prototype.discard=function(t,n){var i=this;void 0===t&&(t=!1),void 0===n&&(n=!1),this.ref instanceof ce||this.changes.forEach(function(t){if(t.op===e.OPERATION.DELETE){var n=i.ref.getIndex(t.index);delete i.indexes[n]}}),this.changes.clear(),this.changed=t,n&&this.allChanges.clear(),this.currentCustomOperation=0},t.prototype.discardAll=function(){var e=this;this.changes.forEach(function(t){var n=e.getValue(t.index);n&&n.$changes&&n.$changes.discardAll()}),this.discard()},t.prototype.cache=function(e,t){this.caches[e]=t},t.prototype.clone=function(){return new t(this.ref,this.parent,this.root)},t.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},t.prototype.assertValidIndex=function(e,t){if(void 0===e)throw new Error('ChangeTree: missing index for field "'+t+'"')},t}(),c=function(e,t){var n=e.toString(),i=t.toString();return n<i?-1:n>i?1:0};function u(e){return e.$proxy=!0,e=new Proxy(e,{get:function(e,t){return"symbol"===n(t)||isNaN(t)?e[t]:e.at(t)},set:function(e,t,i){if("symbol"===n(t)||isNaN(t))e[t]=i;else{var r=Array.from(e.$items.keys()),o=parseInt(r[t]||t);null==i?e.deleteAt(o):e.setAt(o,i)}return!0},deleteProperty:function(e,t){return"number"==typeof t?e.deleteAt(t):delete e[t],!0}})}var d=function(){function t(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.$changes=new h(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,e)}return t.is=function(e){return Array.isArray(e)||void 0!==e.array},Object.defineProperty(t.prototype,"length",{get:function(){return this.$items.size},set:function(e){0===e?this.clear():this.splice(e,this.length-e)},enumerable:!1,configurable:!0}),t.prototype.push=function(){for(var e,t=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return n.forEach(function(n){e=t.$refId++,t.setAt(e,n)}),e},t.prototype.pop=function(){var e=Array.from(this.$indexes.values()).pop();if(void 0!==e){this.$changes.delete(e),this.$indexes.delete(e);var t=this.$items.get(e);return this.$items.delete(e),t}},t.prototype.at=function(e){var t=Array.from(this.$items.keys())[e];return this.$items.get(t)},t.prototype.setAt=function(t,n){var i,r;void 0!==n.$changes&&n.$changes.setParent(this,this.$changes.root,t);var o=null!==(r=null===(i=this.$changes.indexes[t])||void 0===i?void 0:i.op)&&void 0!==r?r:e.OPERATION.ADD;this.$changes.indexes[t]=t,this.$indexes.set(t,t),this.$items.set(t,n),this.$changes.change(t,o)},t.prototype.deleteAt=function(e){var t=Array.from(this.$items.keys())[e];return void 0!==t&&this.$deleteAt(t)},t.prototype.$deleteAt=function(e){return this.$changes.delete(e),this.$indexes.delete(e),this.$items.delete(e)},t.prototype.clear=function(t){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(e){n.$changes.root.removeRef(e.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.concat=function(){for(var e,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return new(t.bind.apply(t,o([void 0],(e=Array.from(this.$items.values())).concat.apply(e,n))))},t.prototype.join=function(e){return Array.from(this.$items.values()).join(e)},t.prototype.reverse=function(){var e=this,t=Array.from(this.$items.keys()),n=Array.from(this.$items.values()).reverse();return n.forEach(function(n,i){e.setAt(t[i],n)}),this},t.prototype.shift=function(){var e=Array.from(this.$items.keys()),t=e.shift();if(void 0!==t){var n=this.$items.get(t);return this.$deleteAt(t),n}},t.prototype.slice=function(e,n){return new(t.bind.apply(t,o([void 0],Array.from(this.$items.values()).slice(e,n))))},t.prototype.sort=function(e){var t=this;void 0===e&&(e=c);var n=Array.from(this.$items.keys()),i=Array.from(this.$items.values()).sort(e);return i.forEach(function(e,i){t.setAt(n[i],e)}),this},t.prototype.splice=function(e,t){void 0===t&&(t=this.length-e);for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];for(var r=Array.from(this.$items.keys()),o=[],s=e;s<e+t;s++)o.push(this.$items.get(r[s])),this.$deleteAt(r[s]);return o},t.prototype.unshift=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=this.length,r=t.length,o=Array.from(this.$items.values());return t.forEach(function(t,n){e.setAt(n,t)}),o.forEach(function(t,n){e.setAt(r+n,t)}),i+r},t.prototype.indexOf=function(e,t){return Array.from(this.$items.values()).indexOf(e,t)},t.prototype.lastIndexOf=function(e,t){return void 0===t&&(t=this.length-1),Array.from(this.$items.values()).lastIndexOf(e,t)},t.prototype.every=function(e,t){return Array.from(this.$items.values()).every(e,t)},t.prototype.some=function(e,t){return Array.from(this.$items.values()).some(e,t)},t.prototype.forEach=function(e,t){Array.from(this.$items.values()).forEach(e,t)},t.prototype.map=function(e,t){return Array.from(this.$items.values()).map(e,t)},t.prototype.filter=function(e,t){return Array.from(this.$items.values()).filter(e,t)},t.prototype.reduce=function(e,t){return Array.from(this.$items.values()).reduce(e,t)},t.prototype.reduceRight=function(e,t){return Array.from(this.$items.values()).reduceRight(e,t)},t.prototype.find=function(e,t){return Array.from(this.$items.values()).find(e,t)},t.prototype.findIndex=function(e,t){return Array.from(this.$items.values()).findIndex(e,t)},t.prototype.fill=function(e,t,n){throw new Error("ArraySchema#fill() not implemented")},t.prototype.copyWithin=function(e,t,n){throw new Error("ArraySchema#copyWithin() not implemented")},t.prototype.toString=function(){return this.$items.toString()},t.prototype.toLocaleString=function(){return this.$items.toLocaleString()},t.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},t.prototype[Symbol.unscopables]=function(){return this.$items[Symbol.unscopables]()},t.prototype.entries=function(){return this.$items.entries()},t.prototype.keys=function(){return this.$items.keys()},t.prototype.values=function(){return this.$items.values()},t.prototype.includes=function(e,t){return Array.from(this.$items.values()).includes(e,t)},t.prototype.flatMap=function(e,t){throw new Error("ArraySchema#flatMap() is not supported.")},t.prototype.flat=function(e){throw new Error("ArraySchema#flat() is not supported.")},t.prototype.setIndex=function(e,t){this.$indexes.set(e,t)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){return this.toArray().map(function(e){return"function"==typeof e.toJSON?e.toJSON():e})},t.prototype.clone=function(e){return e?new(t.bind.apply(t,o([void 0],Array.from(this.$items.values())))):new(t.bind.apply(t,o([void 0],this.map(function(e){return e.$changes?e.clone():e}))))},t.prototype.triggerAll=function(){ce.prototype.triggerAll.apply(this)},t}();function p(e){return e.$proxy=!0,e=new Proxy(e,{get:function(e,t){return"symbol"!==n(t)&&void 0===e[t]?e.get(t):e[t]},set:function(e,t,i){return"symbol"!==n(t)&&-1===t.indexOf("$")&&"onAdd"!==t&&"onRemove"!==t&&"onChange"!==t?e.set(t,i):e[t]=i,!0},deleteProperty:function(e,t){return e.delete(t),!0}})}var l=function(){function t(e){var t=this;if(this.$changes=new h(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e)if(e instanceof Map)e.forEach(function(e,n){return t.set(n,e)});else for(var n in e)this.set(n,e[n])}return t.is=function(e){return void 0!==e.map},t.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(t.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),t.prototype.set=function(t,n){if(null==n)throw new Error("MapSchema#set('"+t+"', "+n+"): trying to set "+n+" value on '"+t+"'.");var i=void 0!==this.$changes.indexes[t],r=i?this.$changes.indexes[t]:this.$refId++,o=i?e.OPERATION.REPLACE:e.OPERATION.ADD,s=void 0!==n.$changes;return s&&n.$changes.setParent(this,this.$changes.root,r),i?s&&this.$items.get(t)!==n&&(o=e.OPERATION.ADD):(this.$changes.indexes[t]=r,this.$indexes.set(r,t)),this.$items.set(t,n),this.$changes.change(t,o),this},t.prototype.get=function(e){return this.$items.get(e)},t.prototype.delete=function(e){return this.$changes.delete(e),this.$items.delete(e)},t.prototype.clear=function(t){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(e){n.$changes.root.removeRef(e.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){return this.$items.has(e)},t.prototype.forEach=function(e){this.$items.forEach(e)},t.prototype.entries=function(){return this.$items.entries()},t.prototype.keys=function(){return this.$items.keys()},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,t){this.$indexes.set(e,t)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)},t.prototype.toJSON=function(){var e={};return this.forEach(function(t,n){e[n]="function"==typeof t.toJSON?t.toJSON():t}),e},t.prototype.clone=function(e){var n;return e?n=Object.assign(new t,this):(n=new t,this.forEach(function(e,t){e.$changes?n.set(t,e.clone()):n.set(t,e)})),n},t.prototype.triggerAll=function(){ce.prototype.triggerAll.apply(this)},t}(),v={};function y(e,t){v[e]=t}function g(e){return v[e]}var m=function(){function e(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return e.create=function(t){var n=new e;return n.schema=Object.assign({},t&&t.schema||{}),n.indexes=Object.assign({},t&&t.indexes||{}),n.fieldsByIndex=Object.assign({},t&&t.fieldsByIndex||{}),n.descriptors=Object.assign({},t&&t.descriptors||{}),n.deprecated=Object.assign({},t&&t.deprecated||{}),n},e.prototype.addField=function(e,t){var n=this.getNextFieldIndex();this.fieldsByIndex[n]=e,this.indexes[e]=n,this.schema[e]=Array.isArray(t)?{array:t[0]}:t},e.prototype.addFilter=function(e,t){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[e]]=t,this.indexesWithFilters.push(this.indexes[e]),!0},e.prototype.addChildrenFilter=function(e,t){var n=this.indexes[e],i=this.schema[e];if(g(Object.keys(i)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[n]=t,!0;console.warn("@filterChildren: field '"+e+"' can't have children. Ignoring filter.")},e.prototype.getChildrenFilter=function(e){return this.childFilters&&this.childFilters[this.indexes[e]]},e.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},e}(),_=function(){function e(){this.types={},this.schemas=new Map,this.useFilters=!1}return e.prototype.has=function(e){return this.schemas.has(e)},e.prototype.get=function(e){return this.types[e]},e.prototype.add=function(e,t){void 0===t&&(t=this.schemas.size),e._definition=m.create(e._definition),e._typeid=t,this.types[t]=e,this.schemas.set(e,t)},e.create=function(t){return void 0===t&&(t=new e),function(e){return A(e,t)}},e}(),w=new _;function A(e,t){return void 0===t&&(t=w),function(n,i){var r=n.constructor;r._context=t,t.has(r)||t.add(r);var s=r._definition;if(s.addField(i,e),s.descriptors[i]){if(s.deprecated[i])return;try{throw new Error("@colyseus/schema: Duplicate '"+i+"' definition on '"+r.name+"'.\nCheck @type() annotation")}catch(y){var a=y.stack.split("\n")[4].trim();throw new Error(y.message+" "+a)}}var f=d.is(e),h=!f&&l.is(e);if("string"!=typeof e&&!ce.is(e)){var c=Object.values(e)[0];"string"==typeof c||t.has(c)||t.add(c)}var v="_"+i;s.descriptors[v]={enumerable:!1,configurable:!1,writable:!0},s.descriptors[i]={get:function(){return this[v]},set:function(e){e!==this[v]&&(null!=e?(!f||e instanceof d||(e=new(d.bind.apply(d,o([void 0],e)))),!h||e instanceof l||(e=new l(e)),void 0===e.$proxy&&(h?e=p(e):f&&(e=u(e))),this.$changes.change(i),e.$changes&&e.$changes.setParent(this,this.$changes.root,this._definition.indexes[i])):this.$changes.delete(i),this[v]=e)},enumerable:!0,configurable:!0}}}function $(e,t,n){for(var i=0,r=0,o=n.length;r<o;r++)(i=n.charCodeAt(r))<128?e[t++]=i:i<2048?(e[t++]=192|i>>6,e[t++]=128|63&i):i<55296||i>=57344?(e[t++]=224|i>>12,e[t++]=128|i>>6&63,e[t++]=128|63&i):(r++,i=65536+((1023&i)<<10|1023&n.charCodeAt(r)),e[t++]=240|i>>18,e[t++]=128|i>>12&63,e[t++]=128|i>>6&63,e[t++]=128|63&i)}function E(e,t){e.push(255&t)}function O(e,t){e.push(255&t)}function I(e,t){e.push(255&t),e.push(t>>8&255)}function b(e,t){e.push(255&t),e.push(t>>8&255)}function x(e,t){e.push(255&t),e.push(t>>8&255),e.push(t>>16&255),e.push(t>>24&255)}function R(e,t){var n=t>>24,i=t>>16,r=t>>8,o=t;e.push(255&o),e.push(255&r),e.push(255&i),e.push(255&n)}function T(e,t){var n=Math.floor(t/Math.pow(2,32)),i=t>>>0;R(e,i),R(e,n)}function C(e,t){var n=t/Math.pow(2,32)>>0,i=t>>>0;R(e,i),R(e,n)}var P=new Int32Array(2),S=new Float32Array(P.buffer),N=new Float64Array(P.buffer);function D(e,t){S[0]=t,x(e,P[0])}function M(e,t){N[0]=t,x(e,P[0]),x(e,P[1])}function k(e,t){t||(t="");var n=function(e){for(var t=0,n=0,i=0,r=e.length;i<r;i++)(t=e.charCodeAt(i))<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(i++,n+=4);return n}(t),i=0;if(n<32)e.push(160|n),i=1;else if(n<256)e.push(217),O(e,n),i=2;else if(n<65536)e.push(218),b(e,n),i=3;else{if(!(n<4294967296))throw new Error("String too long");e.push(219),R(e,n),i=5}return $(e,e.length,t),i+n}function j(e,t){return isNaN(t)?j(e,0):isFinite(t)?t!==(0|t)?(e.push(203),M(e,t),9):t>=0?t<128?(O(e,t),1):t<256?(e.push(204),O(e,t),2):t<65536?(e.push(205),b(e,t),3):t<4294967296?(e.push(206),R(e,t),5):(e.push(207),C(e,t),9):t>=-32?(e.push(224|t+32),1):t>=-128?(e.push(208),E(e,t),2):t>=-32768?(e.push(209),I(e,t),3):t>=-2147483648?(e.push(210),x(e,t),5):(e.push(211),T(e,t),9):j(e,t>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var U=Object.freeze({__proto__:null,utf8Write:$,int8:E,uint8:O,int16:I,uint16:b,int32:x,uint32:R,int64:T,uint64:C,float32:function(e,t){D(e,t)},float64:function(e,t){M(e,t)},writeFloat32:D,writeFloat64:M,boolean:function(e,t){return O(e,t?1:0)},string:k,number:j});function L(e,t){return F(e,t)<<24>>24}function F(e,t){return e[t.offset++]}function H(e,t){return B(e,t)<<16>>16}function B(e,t){return e[t.offset++]|e[t.offset++]<<8}function V(e,t){return e[t.offset++]|e[t.offset++]<<8|e[t.offset++]<<16|e[t.offset++]<<24}function z(e,t){return V(e,t)>>>0}function q(e,t){var n=z(e,t),i=V(e,t)*Math.pow(2,32);return i+n}function J(e,t){var n=z(e,t),i=z(e,t)*Math.pow(2,32);return i+n}var K=new Int32Array(2),W=new Float32Array(K.buffer),X=new Float64Array(K.buffer);function G(e,t){return K[0]=V(e,t),W[0]}function Q(e,t){return K[0]=V(e,t),K[1]=V(e,t),X[0]}function Y(e,t){var n,i=e[t.offset++];i<192?n=31&i:217===i?n=F(e,t):218===i?n=B(e,t):219===i&&(n=z(e,t));var r=function(e,t,n){for(var i="",r=0,o=t,s=t+n;o<s;o++){var a=e[o];0!=(128&a)?192!=(224&a)?224!=(240&a)?240!=(248&a)?console.error("Invalid byte "+a.toString(16)):(r=(7&a)<<18|(63&e[++o])<<12|(63&e[++o])<<6|(63&e[++o])<<0)>=65536?(r-=65536,i+=String.fromCharCode(55296+(r>>>10),56320+(1023&r))):i+=String.fromCharCode(r):i+=String.fromCharCode((15&a)<<12|(63&e[++o])<<6|(63&e[++o])<<0):i+=String.fromCharCode((31&a)<<6|63&e[++o]):i+=String.fromCharCode(a)}return i}(e,t.offset,n);return t.offset+=n,r}function Z(e,t){var n=e[t.offset++];return n<128?n:202===n?G(e,t):203===n?Q(e,t):204===n?F(e,t):205===n?B(e,t):206===n?z(e,t):207===n?J(e,t):208===n?L(e,t):209===n?H(e,t):210===n?V(e,t):211===n?q(e,t):n>223?-1*(255-n+1):void 0}function ee(e,t){return e[t.offset-1]===a&&(e[t.offset]<128||e[t.offset]>=202&&e[t.offset]<=211)}var te=Object.freeze({__proto__:null,int8:L,uint8:F,int16:H,uint16:B,int32:V,uint32:z,float32:function(e,t){return G(e,t)},float64:function(e,t){return Q(e,t)},int64:q,uint64:J,readFloat32:G,readFloat64:Q,boolean:function(e,t){return F(e,t)>0},string:Y,stringCheck:function(e,t){var n=e[t.offset];return n<192&&n>160||217===n||218===n||219===n},number:Z,numberCheck:function(e,t){var n=e[t.offset];return n<128||n>=202&&n<=211},arrayCheck:function(e,t){return e[t.offset]<160},switchStructureCheck:ee}),ne=function(){function t(e){var t=this;this.$changes=new h(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach(function(e){return t.add(e)})}return t.is=function(e){return void 0!==e.collection},t.prototype.add=function(e){var t=this.$refId++,n=void 0!==e.$changes;return n&&e.$changes.setParent(this,this.$changes.root,t),this.$changes.indexes[t]=t,this.$indexes.set(t,t),this.$items.set(t,e),this.$changes.change(t),t},t.prototype.at=function(e){var t=Array.from(this.$items.keys())[e];return this.$items.get(t)},t.prototype.entries=function(){return this.$items.entries()},t.prototype.delete=function(e){for(var t,n,i=this.$items.entries();(n=i.next())&&!n.done;)if(e===n.value[1]){t=n.value[0];break}return void 0!==t&&(this.$changes.delete(t),this.$indexes.delete(t),this.$items.delete(t))},t.prototype.clear=function(t){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(e){n.$changes.root.removeRef(e.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){return Array.from(this.$items.values()).some(function(t){return t===e})},t.prototype.forEach=function(e){var t=this;this.$items.forEach(function(n,i,r){return e(n,i,t)})},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,t){this.$indexes.set(e,t)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){var e=[];return this.forEach(function(t,n){e.push("function"==typeof t.toJSON?t.toJSON():t)}),e},t.prototype.clone=function(e){var n;return e?n=Object.assign(new t,this):(n=new t,this.forEach(function(e){e.$changes?n.add(e.clone()):n.add(e)})),n},t.prototype.triggerAll=function(){ce.prototype.triggerAll.apply(this)},t}(),ie=function(){function t(e){var t=this;this.$changes=new h(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach(function(e){return t.add(e)})}return t.is=function(e){return void 0!==e.set},t.prototype.add=function(t){var n,i;if(this.has(t))return!1;var r=this.$refId++;void 0!==t.$changes&&t.$changes.setParent(this,this.$changes.root,r);var o=null!==(i=null===(n=this.$changes.indexes[r])||void 0===n?void 0:n.op)&&void 0!==i?i:e.OPERATION.ADD;return this.$changes.indexes[r]=r,this.$indexes.set(r,r),this.$items.set(r,t),this.$changes.change(r,o),r},t.prototype.entries=function(){return this.$items.entries()},t.prototype.delete=function(e){for(var t,n,i=this.$items.entries();(n=i.next())&&!n.done;)if(e===n.value[1]){t=n.value[0];break}return void 0!==t&&(this.$changes.delete(t),this.$indexes.delete(t),this.$items.delete(t))},t.prototype.clear=function(t){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(e){n.$changes.root.removeRef(e.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){for(var t,n=this.$items.values(),i=!1;(t=n.next())&&!t.done;)if(e===t.value){i=!0;break}return i},t.prototype.forEach=function(e){var t=this;this.$items.forEach(function(n,i,r){return e(n,i,t)})},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,t){this.$indexes.set(e,t)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){var e=[];return this.forEach(function(t,n){e.push("function"==typeof t.toJSON?t.toJSON():t)}),e},t.prototype.clone=function(e){var n;return e?n=Object.assign(new t,this):(n=new t,this.forEach(function(e){e.$changes?n.add(e.clone()):n.add(e)})),n},t.prototype.triggerAll=function(){ce.prototype.triggerAll.apply(this)},t}(),re=function(){function e(){this.handlers=[]}return e.prototype.register=function(e,t){return this.handlers.push(e),this},e.prototype.invoke=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.handlers.forEach(function(t){return t.apply(void 0,e)})},e.prototype.invokeAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Promise.all(this.handlers.map(function(t){return t.apply(void 0,e)}))},e.prototype.remove=function(e){var t=this.handlers.indexOf(e);this.handlers[t]=this.handlers[this.handlers.length-1],this.handlers.pop()},e.prototype.clear=function(){this.handlers=[]},e}(),oe=function(){function e(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return e.prototype.addRefId=function(e){this.refIds.has(e)||(this.refIds.add(e),this.containerIndexes.set(e,new Set))},e.get=function(t){return void 0===t.$filterState&&(t.$filterState=new e),t.$filterState},e}(),se=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(Error);function ae(e,t,n,i){if(!(e instanceof t))throw new se("a '"+t.name+"' was expected, but '"+e.constructor.name+"' was provided in "+n.constructor.name+"#"+i)}function fe(e,t,i,r,o){!function(e,t,i,r){var o,s=!1;switch(t){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":o="number",isNaN(e)&&console.log('trying to encode "NaN" in '+i.constructor.name+"#"+r);break;case"string":o="string",s=!0;break;case"boolean":return}if(n(e)!==o&&(!s||s&&null!==e)){var a="'"+JSON.stringify(e)+"'"+(e&&e.constructor&&" ("+e.constructor.name+")"||"");throw new se("a '"+o+"' was expected, but "+a+" was provided in "+i.constructor.name+"#"+r)}}(i,e,r,o);var s=U[e];if(!s)throw new se("a '"+e+"' was expected, but "+i+" was provided in "+r.constructor.name+"#"+o);s(t,i)}function he(e,t,n){return te[e](t,n)}var ce=function(){function t(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Object.defineProperties(this,{$changes:{value:new h(this,void 0,new f),enumerable:!1,writable:!0},$listeners:{value:{},enumerable:!1,writable:!0}});var n=this._definition.descriptors;n&&Object.defineProperties(this,n),e[0]&&this.assign(e[0])}return t.onError=function(e){console.error(e)},t.is=function(e){return e._definition&&void 0!==e._definition.schema},t.prototype.assign=function(e){return Object.assign(this,e),this},Object.defineProperty(t.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),t.prototype.listen=function(e,t){var n=this;return this.$listeners[e]||(this.$listeners[e]=new re),this.$listeners[e].register(t),function(){return n.$listeners[e].remove(t)}},t.prototype.decode=function(n,i,r,o){void 0===i&&(i={offset:0}),void 0===r&&(r=this),void 0===o&&(o=new Map);var s=this.$changes.root,f=n.length,h=0,c=[];for(s.refs.set(h,this),o.set(h,c);i.offset<f;){var u=n[i.offset++];if(u!=a){var p=r.$changes,v=void 0!==r._definition,y=v?u>>6<<6:u;if(y!==e.OPERATION.CLEAR){var m=v?u%(y||255):Z(n,i),_=v?r._definition.fieldsByIndex[m]:"",w=p.getType(m),A=void 0,$=void 0,E=void 0;if(v?$=r["_"+_]:($=r.getByIndex(m),(y&e.OPERATION.ADD)===e.OPERATION.ADD?(E=r instanceof l?Y(n,i):m,r.setIndex(m,E)):E=r.getIndex(m)),(y&e.OPERATION.DELETE)===e.OPERATION.DELETE&&(y!==e.OPERATION.DELETE_AND_ADD&&r.deleteByIndex(m),$&&$.$changes&&s.removeRef($.$changes.refId),A=null),void 0!==_){if(y===e.OPERATION.DELETE);else if(t.is(w)){var O=Z(n,i);if(A=s.refs.get(O),y!==e.OPERATION.REPLACE){var I=this.getSchemaType(n,i,w);A||((A=this.createTypeInstance(I)).$changes.refId=O,$&&(A.onChange=$.onChange,A.onRemove=$.onRemove,A.$listeners=$.$listeners,$.$changes.refId&&O!==$.$changes.refId&&s.removeRef($.$changes.refId))),s.addRef(O,A,A!==$)}}else if("string"==typeof w)A=he(w,n,i);else{var b=g(Object.keys(w)[0]),x=Z(n,i),R=s.refs.has(x)?$||s.refs.get(x):new b.constructor;if((A=R.clone(!0)).$changes.refId=x,$&&(A.onAdd=$.onAdd,A.onRemove=$.onRemove,A.onChange=$.onChange,$.$changes.refId&&x!==$.$changes.refId)){s.removeRef($.$changes.refId);for(var T=[],C=$.entries(),P=void 0;(P=C.next())&&!P.done;){var S=P.value,N=S[0],D=S[1];T.push({op:e.OPERATION.DELETE,field:N,value:void 0,previousValue:D})}o.set($.$changes.refId,T)}s.addRef(x,A,R!==$),b.getProxy&&(A=b.getProxy(A))}var M=$!==A;if(null!=A)if(A.$changes&&A.$changes.setParent(p.ref,p.root,m),r instanceof t)r[_]=A;else if(r instanceof l){var N=E;r.$items.set(N,A)}else if(r instanceof d)r.setAt(m,A);else if(r instanceof ne){var k=r.add(A);r.setIndex(m,k)}else if(r instanceof ie){var k=r.add(A);!1!==k&&r.setIndex(m,k)}M&&c.push({op:y,field:_,dynamicIndex:E,value:A,previousValue:$})}else{console.warn("@colyseus/schema: definition mismatch");for(var j={offset:i.offset};i.offset<f&&(!ee(n,i)||(j.offset=i.offset+1,!s.refs.has(Z(n,j))));)i.offset++}}else r.clear(!0)}else{h=Z(n,i);var U=s.refs.get(h);if(!U)throw new Error('"refId" not found: '+h);r=U,c=[],o.set(h,c)}}return this._triggerChanges(o),s.garbageCollectDeletedRefs(),o},t.prototype.encode=function(n,i,r){void 0===n&&(n=!1),void 0===i&&(i=[]),void 0===r&&(r=!1);for(var o=this.$changes,s=new WeakSet,f=[o],h=1,c=0;c<h;c++){var u=f[c],d=u.ref,p=d instanceof t;u.ensureRefId(),s.add(u),u!==o&&(u.changed||n)&&(O(i,a),j(i,u.refId));for(var v=n?Array.from(u.allChanges):Array.from(u.changes.values()),y=0,m=v.length;y<m;y++){var _=n?{op:e.OPERATION.ADD,index:v[y]}:v[y],w=_.index,A=p?d._definition.fieldsByIndex&&d._definition.fieldsByIndex[w]:w,$=i.length;if(_.op!==e.OPERATION.TOUCH)if(p)O(i,w|_.op);else{if(O(i,_.op),_.op===e.OPERATION.CLEAR)continue;j(i,w)}if(!p&&(_.op&e.OPERATION.ADD)==e.OPERATION.ADD&&d instanceof l){var E=u.ref.$indexes.get(w);k(i,E)}if(_.op!==e.OPERATION.DELETE){var I=u.getType(w),b=u.getValue(w);if(b&&b.$changes&&!s.has(b.$changes)&&(f.push(b.$changes),b.$changes.ensureRefId(),h++),_.op!==e.OPERATION.TOUCH){if(t.is(I))ae(b,I,d,A),j(i,b.$changes.refId),(_.op&e.OPERATION.ADD)===e.OPERATION.ADD&&this.tryEncodeTypeId(i,I,b.constructor);else if("string"==typeof I)fe(I,i,b,d,A);else{var x=g(Object.keys(I)[0]);ae(d["_"+A],x.constructor,d,A),j(i,b.$changes.refId)}r&&u.cache(w,i.slice($))}}}n||r||u.discard()}return i},t.prototype.encodeAll=function(e){return this.encode(!0,[],e)},t.prototype.applyFilters=function(n,i){var r,o;void 0===i&&(i=!1);for(var s=this,f=new Set,h=oe.get(n),c=[this.$changes],u=1,d=[],p=function(p){var v=c[p];if(f.has(v.refId))return"continue";var y=v.ref,g=y instanceof t;O(d,a),j(d,v.refId);var m=h.refIds.has(v),_=i||!m;h.addRefId(v);var w=h.containerIndexes.get(v),A=_?Array.from(v.allChanges):Array.from(v.changes.values());if(!i&&g&&y._definition.indexesWithFilters){var $=y._definition.indexesWithFilters;$.forEach(function(t){!w.has(t)&&v.allChanges.has(t)&&(_?A.push(t):A.push({op:e.OPERATION.ADD,index:t}))})}for(var E=0,I=A.length;E<I;E++){var b=_?{op:e.OPERATION.ADD,index:A[E]}:A[E];if(b.op!==e.OPERATION.CLEAR){var x=b.index;if(b.op!==e.OPERATION.DELETE){var R=v.getValue(x),T=v.getType(x);if(g){var C=y._definition.filters&&y._definition.filters[x];if(C&&!C.call(y,n,R,s)){R&&R.$changes&&f.add(R.$changes.refId);continue}}else{var P=v.parent,C=v.getChildrenFilter();if(C&&!C.call(P,n,y.$indexes.get(x),R,s)){R&&R.$changes&&f.add(R.$changes.refId);continue}}if(R.$changes&&(c.push(R.$changes),u++),b.op!==e.OPERATION.TOUCH)if(b.op===e.OPERATION.ADD||g)d.push.apply(d,null!==(r=v.caches[x])&&void 0!==r?r:[]),w.add(x);else if(w.has(x))d.push.apply(d,null!==(o=v.caches[x])&&void 0!==o?o:[]);else{if(w.add(x),O(d,e.OPERATION.ADD),j(d,x),y instanceof l){var S=v.ref.$indexes.get(x);k(d,S)}R.$changes?j(d,R.$changes.refId):U[T](d,R)}else if(R.$changes&&!g){if(O(d,e.OPERATION.ADD),j(d,x),y instanceof l){var S=v.ref.$indexes.get(x);k(d,S)}j(d,R.$changes.refId)}}else g?O(d,b.op|x):(O(d,b.op),j(d,x))}else O(d,b.op)}},v=0;v<u;v++)p(v);return d},t.prototype.clone=function(){var e=new this.constructor,t=this._definition.schema;for(var i in t)"object"===n(this[i])&&"function"==typeof this[i].clone?e[i]=this[i].clone():e[i]=this[i];return e},t.prototype.triggerAll=function(){if(0!==this.$changes.root.refs.size){var e=new Map;t.prototype._triggerAllFillChanges.call(this,this,e);try{t.prototype._triggerChanges.call(this,e)}catch(n){t.onError(n)}}},t.prototype.toJSON=function(){var e=this._definition.schema,t=this._definition.deprecated,n={};for(var i in e)t[i]||null===this[i]||void 0===this[i]||(n[i]="function"==typeof this[i].toJSON?this[i].toJSON():this["_"+i]);return n},t.prototype.discardAllChanges=function(){this.$changes.discardAll()},t.prototype.getByIndex=function(e){return this[this._definition.fieldsByIndex[e]]},t.prototype.deleteByIndex=function(e){this[this._definition.fieldsByIndex[e]]=void 0},t.prototype.tryEncodeTypeId=function(e,t,n){t._typeid!==n._typeid&&(O(e,213),j(e,n._typeid))},t.prototype.getSchemaType=function(e,t,n){var i;return 213===e[t.offset]&&(t.offset++,i=this.constructor._context.get(Z(e,t))),i||n},t.prototype.createTypeInstance=function(e){var t=new e;return t.$changes.root=this.$changes.root,t},t.prototype._triggerAllFillChanges=function(n,i){if(!i.has(n.$changes.refId)){var r=[];if(i.set(n.$changes.refId||0,r),n instanceof t){var o=n._definition.schema;for(var s in o){var a="_"+s,f=n[a];void 0!==f&&(r.push({op:e.OPERATION.ADD,field:s,value:f,previousValue:void 0}),void 0!==f.$changes&&t.prototype._triggerAllFillChanges.call(this,f,i))}}else for(var h=n.entries(),c=void 0;(c=h.next())&&!c.done;){var u=c.value,d=u[0],f=u[1];r.push({op:e.OPERATION.ADD,field:d,dynamicIndex:d,value:f,previousValue:void 0}),void 0!==f.$changes&&t.prototype._triggerAllFillChanges.call(this,f,i)}}},t.prototype._triggerChanges=function(n){var i=this;n.forEach(function(n,r){var o,s,a,f,h,c,u,d,p,l,v,y;if(n.length>0){for(var g=i.$changes.root.refs.get(r),m=g instanceof t,_=0;_<n.length;_++){var w=n[_],A=g.$listeners&&g.$listeners[w.field];if(m||(w.op===e.OPERATION.ADD&&void 0===w.previousValue?null===(s=(o=g).onAdd)||void 0===s||s.call(o,w.value,null!==(a=w.dynamicIndex)&&void 0!==a?a:w.field):w.op===e.OPERATION.DELETE?void 0!==w.previousValue&&(null===(h=(f=g).onRemove)||void 0===h||h.call(f,w.previousValue,null!==(c=w.dynamicIndex)&&void 0!==c?c:w.field)):w.op===e.OPERATION.DELETE_AND_ADD?(void 0!==w.previousValue&&(null===(d=(u=g).onRemove)||void 0===d||d.call(u,w.previousValue,w.dynamicIndex)),null===(l=(p=g).onAdd)||void 0===l||l.call(p,w.value,w.dynamicIndex)):w.op!==e.OPERATION.REPLACE&&w.value===w.previousValue||null===(y=(v=g).onChange)||void 0===y||y.call(v,w.value,w.dynamicIndex)),(w.op&e.OPERATION.DELETE)===e.OPERATION.DELETE&&w.previousValue instanceof t&&w.previousValue.onRemove&&w.previousValue.onRemove(),A)try{A.invoke(w.value,w.previousValue)}catch($){t.onError($)}}if(m&&g.onChange)try{g.onChange(n)}catch($){t.onError($)}}})},t._definition=m.create(),t}(),ue=new _,de=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),r([A("string",ue)],t.prototype,"name",void 0),r([A("string",ue)],t.prototype,"type",void 0),r([A("number",ue)],t.prototype,"referencedType",void 0),t}(ce),pe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fields=new d,t}return i(t,e),r([A("number",ue)],t.prototype,"id",void 0),r([A([de],ue)],t.prototype,"fields",void 0),t}(ce),le=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.types=new d,t}return i(t,e),t.encode=function(e){var n=e.constructor,i=new t;i.rootType=n._typeid;var r=function(e,t){for(var n in t){var r=new de;r.name=n;var o=void 0;if("string"==typeof t[n])o=t[n];else{var s=t[n],a=void 0;ce.is(s)?(o="ref",a=t[n]):(o=Object.keys(s)[0],"string"==typeof s[o]?o+=":"+s[o]:a=s[o]),r.referencedType=a?a._typeid:-1}r.type=o,e.fields.push(r)}i.types.push(e)},o=n._context.types;for(var s in o){var a=new pe;a.id=Number(s),r(a,o[s]._definition.schema)}return i.encodeAll()},t.decode=function(e,n){var r=new _,o=new t;o.decode(e,n);var s=o.types.reduce(function(e,t){var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(ce),o=t.id;return e[o]=n,r.add(n,o),e},{});o.types.forEach(function(e){var t=s[e.id];e.fields.forEach(function(e){var n;if(void 0!==e.referencedType){var i=e.type,o=s[e.referencedType];if(!o){var a=e.type.split(":");i=a[0],o=a[1]}"ref"===i?A(o,r)(t.prototype,e.name):A(((n={})[i]=o,n),r)(t.prototype,e.name)}else A(e.type,r)(t.prototype,e.name)})});var a=s[o.rootType],f=new a;for(var h in a._definition.schema){var c=a._definition.schema[h];"string"!=typeof c&&(f[h]="function"==typeof c?new c:new(g(Object.keys(c)[0]).constructor))}return f},r([A([pe],ue)],t.prototype,"types",void 0),r([A("number",ue)],t.prototype,"rootType",void 0),t}(ce);y("map",{constructor:l,getProxy:p}),y("array",{constructor:d,getProxy:u}),y("set",{constructor:ie}),y("collection",{constructor:ne}),e.ArraySchema=d,e.CollectionSchema=ne,e.Context=_,e.MapSchema=l,e.Reflection=le,e.ReflectionField=de,e.ReflectionType=pe,e.Schema=ce,e.SchemaDefinition=m,e.SetSchema=ie,e.decode=te,e.defineTypes=function(e,t,n){for(var i in void 0===n&&(n=e._context||w),t)A(t[i],n)(e.prototype,i);return e},e.deprecated=function(e,t){return void 0===e&&(e=!0),function(t,n){var i=t.constructor,r=i._definition;r.deprecated[n]=!0,e&&(r.descriptors[n]={get:function(){throw new Error(n+" is deprecated.")},set:function(e){},enumerable:!1,configurable:!0})}},e.dumpChanges=function(e){for(var t=[e.$changes],n={},i=n,r=function(e){var n=t[e];n.changes.forEach(function(e){var t=n.ref,r=e.index,o=t._definition?t._definition.fieldsByIndex[r]:t.$indexes.get(r);i[o]=n.getValue(r)})},o=0;o<1;o++)r(o);return n},e.encode=U,e.filter=function(e){return function(t,n){var i=t.constructor,r=i._definition;r.addFilter(n,e)&&(i._context.useFilters=!0)}},e.filterChildren=function(e){return function(t,n){var i=t.constructor,r=i._definition;r.addChildrenFilter(n,e)&&(i._context.useFilters=!0)}},e.hasFilter=function(e){return e._context&&e._context.useFilters},e.registerType=y,e.type=A,Object.defineProperty(e,"__esModule",{value:!0})}(t)}(M={exports:{}},M.exports),M.exports),U=function(){function t(e,t){var n=this;this.onStateChange=D(),this.onError=D(),this.onLeave=D(),this.onJoin=D(),this.hasJoined=!1,this.onMessageHandlers=S(),this.id=null,this.name=e,t&&(this.serializer=new(P("schema")),this.rootSchema=t,this.serializer.state=new t),this.onError(function(e,t){return console.warn("colyseus.js - onError => ("+e+") "+t)}),this.onLeave(function(){return n.removeAllListeners()})}return t.prototype.connect=function(e){var t=this;this.connection=new R,this.connection.events.onmessage=this.onMessageCallback.bind(this),this.connection.events.onclose=function(e){if(!t.hasJoined)return console.warn("Room connection was closed unexpectedly ("+e.code+"): "+e.reason),void t.onError.invoke(e.code,e.reason);t.onLeave.invoke(e.code),t.destroy()},this.connection.events.onerror=function(e){console.warn("Room, onError ("+e.code+"): "+e.reason),t.onError.invoke(e.code,e.reason)},this.connection.connect(e)},t.prototype.leave=function(t){var n=this;return void 0===t&&(t=!0),new Promise(function(i){n.onLeave(function(e){return i(e)}),n.connection?t?n.connection.send([e.Protocol.LEAVE_ROOM]):n.connection.close():n.onLeave.invoke(4e3)})},t.prototype.onMessage=function(e,t){return this.onMessageHandlers.on(this.getMessageHandlerKey(e),t)},t.prototype.send=function(t,n){var i,r=[e.Protocol.ROOM_DATA];if("string"==typeof t?j.encode.string(r,t):j.encode.number(r,t),void 0!==n){var o=E(n);(i=new Uint8Array(r.length+o.byteLength)).set(new Uint8Array(r),0),i.set(new Uint8Array(o),r.length)}else i=new Uint8Array(r);this.connection.send(i.buffer)},Object.defineProperty(t.prototype,"state",{get:function(){return this.serializer.getState()},enumerable:!1,configurable:!0}),t.prototype.removeAllListeners=function(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}},t.prototype.onMessageCallback=function(t){var n=Array.from(new Uint8Array(t.data)),i=n[0];if(i===e.Protocol.JOIN_ROOM){var r=1;if(this.serializerId=function(e,t){for(var n=e[t++],i="",r=0,o=t,s=t+n;o<s;o++){var a=e[o];if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));(r=(7&a)<<18|(63&e[++o])<<12|(63&e[++o])<<6|(63&e[++o])<<0)>=65536?(r-=65536,i+=String.fromCharCode(55296+(r>>>10),56320+(1023&r))):i+=String.fromCharCode(r)}else i+=String.fromCharCode((15&a)<<12|(63&e[++o])<<6|(63&e[++o])<<0);else i+=String.fromCharCode((31&a)<<6|63&e[++o]);else i+=String.fromCharCode(a)}return i}(n,r),r+=function(e){void 0===e&&(e="");for(var t=0,n=0,i=0,r=e.length;i<r;i++)(t=e.charCodeAt(i))<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(i++,n+=4);return n+1}(this.serializerId),!this.serializer){var o=P(this.serializerId);this.serializer=new o}n.length>r&&this.serializer.handshake&&this.serializer.handshake(n,{offset:r}),this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([e.Protocol.JOIN_ROOM])}else if(i===e.Protocol.ERROR){var s={offset:1},a=j.decode.number(n,s),f=j.decode.string(n,s);this.onError.invoke(a,f)}else if(i===e.Protocol.LEAVE_ROOM)this.leave();else if(i===e.Protocol.ROOM_DATA_SCHEMA){var h={offset:1};(f=new(u=this.serializer.getState().constructor._context.get(j.decode.number(n,h)))).decode(n,h),this.dispatchMessage(u,f)}else if(i===e.Protocol.ROOM_STATE)n.shift(),this.setState(n);else if(i===e.Protocol.ROOM_STATE_PATCH)n.shift(),this.patch(n);else if(i===e.Protocol.ROOM_DATA){var c={offset:1},u=j.decode.stringCheck(n,c)?j.decode.string(n,c):j.decode.number(n,c);f=n.length>c.offset?function(e,t){void 0===t&&(t=0);var n=new A(e,t),i=n._parse();if(n._offset!==e.byteLength)throw new Error(e.byteLength-n._offset+" trailing bytes");return i}(t.data,c.offset):void 0;this.dispatchMessage(u,f)}},t.prototype.setState=function(e){this.serializer.setState(e),this.onStateChange.invoke(this.serializer.getState())},t.prototype.patch=function(e){this.serializer.patch(e),this.onStateChange.invoke(this.serializer.getState())},t.prototype.dispatchMessage=function(e,t){var n=this.getMessageHandlerKey(e);this.onMessageHandlers.events[n]?this.onMessageHandlers.emit(n,t):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",e,t):console.warn("colyseus.js: onMessage() not registered for type '"+e+"'.")},t.prototype.destroy=function(){this.serializer&&this.serializer.teardown()},t.prototype.getMessageHandlerKey=function(e){switch(n(e)){case"function":return"$"+e._typeid;case"string":return e;case"number":return"i"+e;default:throw new Error("invalid message type.")}},t}();function L(){return k||(k="undefined"!=typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!=typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(e,t){this.cache[e]=t},getItem:function(e){this.cache[e]},removeItem:function(e){delete this.cache[e]}}),k}var F,H="colyseus-auth-token";e.Platform=void 0,(F=e.Platform||(e.Platform={})).ios="ios",F.android="android";var B,V=function(){function e(e){var t,n,i,r=this;this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=e.replace("ws","http"),t=H,n=function(e){return r.token=e},i=L().getItem(t),"undefined"!=typeof Promise&&i instanceof Promise?i.then(function(e){return n(e)}):n(i)}return Object.defineProperty(e.prototype,"hasToken",{get:function(){return!!this.token},enumerable:!1,configurable:!0}),e.prototype.login=function(e){return void 0===e&&(e={}),o(this,void 0,void 0,function(){var t,n,i;return s(this,function(r){switch(r.label){case 0:return t=Object.assign({},e),this.hasToken&&(t.token=this.token),[4,this.request("post","/auth",t)];case 1:for(i in n=r.sent(),this.token=n.token,o=H,s=this.token,L().setItem(o,s),n)this.hasOwnProperty(i)&&(this[i]=n[i]);return this.registerPingService(),[2,this]}var o,s})})},e.prototype.save=function(){return o(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone})];case 1:return e.sent(),[2,this]}})})},e.prototype.getFriends=function(){return o(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,this.request("get","/friends/all")];case 1:return[2,e.sent()]}})})},e.prototype.getOnlineFriends=function(){return o(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,this.request("get","/friends/online")];case 1:return[2,e.sent()]}})})},e.prototype.getFriendRequests=function(){return o(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,this.request("get","/friends/requests")];case 1:return[2,e.sent()]}})})},e.prototype.sendFriendRequest=function(e){return o(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.request("post","/friends/requests",{userId:e})];case 1:return[2,t.sent()]}})})},e.prototype.acceptFriendRequest=function(e){return o(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.request("put","/friends/requests",{userId:e})];case 1:return[2,t.sent()]}})})},e.prototype.declineFriendRequest=function(e){return o(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.request("del","/friends/requests",{userId:e})];case 1:return[2,t.sent()]}})})},e.prototype.blockUser=function(e){return o(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.request("post","/friends/block",{userId:e})];case 1:return[2,t.sent()]}})})},e.prototype.unblockUser=function(e){return o(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.request("put","/friends/block",{userId:e})];case 1:return[2,t.sent()]}})})},e.prototype.request=function(e,t,n,i,r){return void 0===n&&(n={}),void 0===r&&(r={}),o(this,void 0,void 0,function(){var o,a,f,h;return s(this,function(s){switch(s.label){case 0:for(a in r.Accept="application/json",this.hasToken&&(r.Authorization="Bearer "+this.token),o=[],n)o.push(a+"="+n[a]);return f=o.length>0?"?"+o.join("&"):"",h={headers:r},i&&(h.body=i),[4,_[e](""+this.endpoint+t+f,h)];case 1:return[2,s.sent().data]}})})},e.prototype.logout=function(){var e;this.token=void 0,e=H,L().removeItem(e),this.unregisterPingService()},e.prototype.registerPingService=function(e){var t=this;void 0===e&&(e=15e3),this.unregisterPingService(),this.keepOnlineInterval=setInterval(function(){return t.request("get","/auth")},e)},e.prototype.unregisterPingService=function(){clearInterval(this.keepOnlineInterval)},e}(),z=function(e){function t(n,i){var r=e.call(this,n)||this;return r.code=i,Object.setPrototypeOf(r,t.prototype),r}return r(t,e),t}(Error),q="undefined"!=typeof window&&void 0!==(null===(B=null===window||void 0===window?void 0:window.location)||void 0===B?void 0:B.hostname)?window.location.protocol.replace("http","ws")+"//"+window.location.hostname+(window.location.port&&":"+window.location.port):"ws://127.0.0.1:2567",J=function(){function e(e){void 0===e&&(e=q),this.endpoint=e}return Object.defineProperty(e.prototype,"auth",{get:function(){return this._auth||(this._auth=new V(this.endpoint)),this._auth},enumerable:!1,configurable:!0}),e.prototype.joinOrCreate=function(e,t,n){return void 0===t&&(t={}),o(this,void 0,void 0,function(){return s(this,function(i){switch(i.label){case 0:return[4,this.createMatchMakeRequest("joinOrCreate",e,t,n)];case 1:return[2,i.sent()]}})})},e.prototype.create=function(e,t,n){return void 0===t&&(t={}),o(this,void 0,void 0,function(){return s(this,function(i){switch(i.label){case 0:return[4,this.createMatchMakeRequest("create",e,t,n)];case 1:return[2,i.sent()]}})})},e.prototype.join=function(e,t,n){return void 0===t&&(t={}),o(this,void 0,void 0,function(){return s(this,function(i){switch(i.label){case 0:return[4,this.createMatchMakeRequest("join",e,t,n)];case 1:return[2,i.sent()]}})})},e.prototype.joinById=function(e,t,n){return void 0===t&&(t={}),o(this,void 0,void 0,function(){return s(this,function(i){switch(i.label){case 0:return[4,this.createMatchMakeRequest("joinById",e,t,n)];case 1:return[2,i.sent()]}})})},e.prototype.reconnect=function(e,t,n){return o(this,void 0,void 0,function(){return s(this,function(i){switch(i.label){case 0:return[4,this.createMatchMakeRequest("joinById",e,{sessionId:t},n)];case 1:return[2,i.sent()]}})})},e.prototype.getAvailableRooms=function(e){return void 0===e&&(e=""),o(this,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:return t=this.endpoint.replace("ws","http")+"/matchmake/"+e,[4,p(t,{headers:{Accept:"application/json"}})];case 1:return[2,n.sent().data]}})})},e.prototype.consumeSeatReservation=function(e,t){return o(this,void 0,void 0,function(){var n;return s(this,function(i){return(n=this.createRoom(e.room.name,t)).id=e.room.roomId,n.sessionId=e.sessionId,n.connect(this.buildEndpoint(e.room,{sessionId:n.sessionId})),[2,new Promise(function(e,t){var i=function(e,n){return t(new w(e,n))};n.onError.once(i),n.onJoin.once(function(){n.onError.remove(i),e(n)})})]})})},e.prototype.createMatchMakeRequest=function(e,t,n,i){return void 0===n&&(n={}),o(this,void 0,void 0,function(){var r,o;return s(this,function(s){switch(s.label){case 0:return r=this.endpoint.replace("ws","http")+"/matchmake/"+e+"/"+t,this._auth&&this._auth.hasToken&&(n.token=this._auth.token),[4,v(r,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)})];case 1:if((o=s.sent().data).error)throw new z(o.error,o.code);return[2,this.consumeSeatReservation(o,i)]}})})},e.prototype.createRoom=function(e,t){return new U(e,t)},e.prototype.buildEndpoint=function(e,t){void 0===t&&(t={});var n=[];for(var i in t)t.hasOwnProperty(i)&&n.push(i+"="+t[i]);return this.endpoint+"/"+e.processId+"/"+e.roomId+"?"+n.join("&")},e}(),K=function(){function e(){}return e.prototype.setState=function(e){this.state.decode(e)},e.prototype.getState=function(){return this.state},e.prototype.patch=function(e){this.state.decode(e)},e.prototype.teardown=function(){var e,t;null===(t=null===(e=this.state)||void 0===e?void 0:e.$changes)||void 0===t||t.root.clearRefs()},e.prototype.handshake=function(e,t){this.state?(new j.Reflection).decode(e,t):this.state=j.Reflection.decode(e,t)},e}(),W=function(){function e(){}return e.prototype.setState=function(e){},e.prototype.getState=function(){return null},e.prototype.patch=function(e){},e.prototype.teardown=function(){},e.prototype.handshake=function(e){},e}();C("schema",K),C("none",W),e.Auth=V,e.Client=J,e.Room=U,e.SchemaSerializer=K,e.registerSerializer=C,Object.defineProperty(e,"__esModule",{value:!0})});
},{}],"EsWj":[function(require,module,exports) {
"use strict";var O;Object.defineProperty(exports,"__esModule",{value:!0}),exports.CMDS=void 0,function(O){O.PLAYER_DIE="D",O.PLAYER_MOVE="M",O.PLAYER_STOP="S",O.BOMB_SPAWN="B",O.BOMB_EXPLODE="X",O.ROOM_ENTER="ROOM_ENTER",O.ROOM_EXIT="ROOM_EXIT"}(O=exports.CMDS||(exports.CMDS={}));
},{}],"c3M1":[function(require,module,exports) {
"use strict";var t=this&&this.__awaiter||function(t,e,r,o){return new(r||(r=Promise))(function(n,i){function s(t){try{c(o.next(t))}catch(e){i(e)}}function a(t){try{c(o.throw(t))}catch(e){i(e)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(s,a)}c((o=o.apply(t,e||[])).next())})},e=this&&this.__generator||function(t,e){var r,o,n,i,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(n=2&i[0]?o.return:i[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,i[1])).done)return n;switch(o=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){s.label=i[1];break}if(6===i[0]&&s.label<n[1]){s.label=n[1],n=i;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(i);break}n[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(a){i=[6,a],o=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.CMDS=void 0;var r=require("colyseus.js"),o=require("../../../shared/types");Object.defineProperty(exports,"CMDS",{enumerable:!0,get:function(){return o.CMDS}});var n=100,i=function(){function i(t,e,r){if(void 0===e&&(e=""),void 0===r&&(r=!1),this.id=t,this.wsuri=e,this.enabled=r,this.lastUpdate=0,!this.wsuri.length){var o=location.host.replace(/:.*/,"");this.wsuri=location.protocol.replace("http","ws")+"//"+o+(location.port?":"+location.port:""),"www.curtiss.me"===o&&(this.wsuri="wss://bomberbros.curtiss.me"+(location.port?":"+location.port:""))}return this}return i.prototype.connect=function(t){this.enabled&&(t&&(this.wsuri=t),this.client=new r.Client(this.wsuri))},i.prototype.create=function(r,o){return t(this,void 0,void 0,function(){var t,n;return e(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),t=this,[4,this.client.create("game",{metadata:{name:r}})];case 1:return t.room=e.sent(),o&&o(this.room),console.log('Created "'+r+'" room.'),[3,3];case 2:return n=e.sent(),console.error(n),[3,3];case 3:return[2]}})})},i.prototype.join=function(r,o,n){return t(this,void 0,void 0,function(){var t,i;return e(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),t=this,[4,this.client.joinById(r,{name:o})];case 1:return t.room=e.sent(),this.room&&(n&&n(this.room),console.log("Joined room "+r+"!")),[3,3];case 2:return i=e.sent(),console.error(i),[3,3];case 3:return[2]}})})},i.prototype.lobby=function(r){return t(this,void 0,void 0,function(){var t,o;return e(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),t=this,[4,this.client.joinOrCreate("lobby")];case 1:return t.room=e.sent(),this.room&&(r&&r(this.room),console.log("Welcome to the lobby!")),[3,3];case 2:return o=e.sent(),console.error(o),[3,3];case 3:return[2]}})})},i.prototype.leave=function(t){this.enabled&&this.room&&(this.room.removeAllListeners(),this.room.leave(t))},i.prototype.send=function(t,e){if(void 0===e&&(e={}),this.enabled&&this.room){if(t===o.CMDS.PLAYER_MOVE){var r=Date.now();if(r-this.lastUpdate<n)return;this.lastUpdate=r}this.room.send(t,e)}},i.prototype.on=function(t,e){this.enabled&&this.room.onMessage(t,e)},i}();exports.default=i;
},{"colyseus.js":"wdwR","../../../shared/types":"EsWj"}],"cT7V":[function(require,module,exports) {
"use strict";var e;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=o;var t=new Uint8Array(16);function o(){if(!e&&!(e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(t)}
},{}],"VlfT":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;exports.default=e;
},{}],"Tknj":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./regex.js"));function t(e){return e&&e.__esModule?e:{default:e}}function r(t){return"string"==typeof t&&e.default.test(t)}var u=r;exports.default=u;
},{"./regex.js":"VlfT"}],"Zh7j":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=r(require("./validate.js"));function r(e){return e&&e.__esModule?e:{default:e}}for(var t=[],i=0;i<256;++i)t.push((i+256).toString(16).substr(1));function o(r){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=(t[r[i+0]]+t[r[i+1]]+t[r[i+2]]+t[r[i+3]]+"-"+t[r[i+4]]+t[r[i+5]]+"-"+t[r[i+6]]+t[r[i+7]]+"-"+t[r[i+8]]+t[r[i+9]]+"-"+t[r[i+10]]+t[r[i+11]]+t[r[i+12]]+t[r[i+13]]+t[r[i+14]]+t[r[i+15]]).toLowerCase();if(!(0,e.default)(o))throw TypeError("Stringified UUID is invalid");return o}var u=o;exports.default=u;
},{"./validate.js":"Tknj"}],"nQZ2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e,r,s=o(require("./rng.js")),n=o(require("./stringify.js"));function o(e){return e&&e.__esModule?e:{default:e}}var u=0,t=0;function a(o,a,l){var d=a&&l||0,i=a||new Array(16),c=(o=o||{}).node||e,v=void 0!==o.clockseq?o.clockseq:r;if(null==c||null==v){var f=o.random||(o.rng||s.default)();null==c&&(c=e=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==v&&(v=r=16383&(f[6]<<8|f[7]))}var q=void 0!==o.msecs?o.msecs:Date.now(),m=void 0!==o.nsecs?o.nsecs:t+1,p=q-u+(m-t)/1e4;if(p<0&&void 0===o.clockseq&&(v=v+1&16383),(p<0||q>u)&&void 0===o.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");u=q,t=m,r=v;var w=(1e4*(268435455&(q+=122192928e5))+m)%4294967296;i[d++]=w>>>24&255,i[d++]=w>>>16&255,i[d++]=w>>>8&255,i[d++]=255&w;var _=q/4294967296*1e4&268435455;i[d++]=_>>>8&255,i[d++]=255&_,i[d++]=_>>>24&15|16,i[d++]=_>>>16&255,i[d++]=v>>>8|128,i[d++]=255&v;for(var g=0;g<6;++g)i[d+g]=c[g];return a||(0,n.default)(i)}var l=a;exports.default=l;
},{"./rng.js":"cT7V","./stringify.js":"Zh7j"}],"EHUk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=r(require("./validate.js"));function r(e){return e&&e.__esModule?e:{default:e}}function t(r){if(!(0,e.default)(r))throw TypeError("Invalid UUID");var t,s=new Uint8Array(16);return s[0]=(t=parseInt(r.slice(0,8),16))>>>24,s[1]=t>>>16&255,s[2]=t>>>8&255,s[3]=255&t,s[4]=(t=parseInt(r.slice(9,13),16))>>>8,s[5]=255&t,s[6]=(t=parseInt(r.slice(14,18),16))>>>8,s[7]=255&t,s[8]=(t=parseInt(r.slice(19,23),16))>>>8,s[9]=255&t,s[10]=(t=parseInt(r.slice(24,36),16))/1099511627776&255,s[11]=t/4294967296&255,s[12]=t>>>24&255,s[13]=t>>>16&255,s[14]=t>>>8&255,s[15]=255&t,s}var s=t;exports.default=s;
},{"./validate.js":"Tknj"}],"y1M0":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=s,exports.URL=exports.DNS=void 0;var e=t(require("./stringify.js")),r=t(require("./parse.js"));function t(e){return e&&e.__esModule?e:{default:e}}function n(e){e=unescape(encodeURIComponent(e));for(var r=[],t=0;t<e.length;++t)r.push(e.charCodeAt(t));return r}var a="6ba7b810-9dad-11d1-80b4-00c04fd430c8";exports.DNS=a;var o="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function s(t,s,u){function i(t,a,o,i){if("string"==typeof t&&(t=n(t)),"string"==typeof a&&(a=(0,r.default)(a)),16!==a.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var d=new Uint8Array(16+t.length);if(d.set(a),d.set(t,a.length),(d=u(d))[6]=15&d[6]|s,d[8]=63&d[8]|128,o){i=i||0;for(var f=0;f<16;++f)o[i+f]=d[f];return o}return(0,e.default)(d)}try{i.name=t}catch(d){}return i.DNS=a,i.URL=o,i}exports.URL=o;
},{"./stringify.js":"Zh7j","./parse.js":"EHUk"}],"hNcK":[function(require,module,exports) {
"use strict";function n(n){if("string"==typeof n){var t=unescape(encodeURIComponent(n));n=new Uint8Array(t.length);for(var o=0;o<t.length;++o)n[o]=t.charCodeAt(o)}return r(e(u(n),8*n.length))}function r(n){for(var r=[],t=32*n.length,e=0;e<t;e+=8){var u=n[e>>5]>>>e%32&255,o=parseInt("0123456789abcdef".charAt(u>>>4&15)+"0123456789abcdef".charAt(15&u),16);r.push(o)}return r}function t(n){return 14+(n+64>>>9<<4)+1}function e(n,r){n[r>>5]|=128<<r%32,n[t(r)-1]=r;for(var e=1732584193,u=-271733879,f=-1732584194,a=271733878,v=0;v<n.length;v+=16){var s=e,d=u,p=f,g=a;e=c(e,u,f,a,n[v],7,-680876936),a=c(a,e,u,f,n[v+1],12,-389564586),f=c(f,a,e,u,n[v+2],17,606105819),u=c(u,f,a,e,n[v+3],22,-1044525330),e=c(e,u,f,a,n[v+4],7,-176418897),a=c(a,e,u,f,n[v+5],12,1200080426),f=c(f,a,e,u,n[v+6],17,-1473231341),u=c(u,f,a,e,n[v+7],22,-45705983),e=c(e,u,f,a,n[v+8],7,1770035416),a=c(a,e,u,f,n[v+9],12,-1958414417),f=c(f,a,e,u,n[v+10],17,-42063),u=c(u,f,a,e,n[v+11],22,-1990404162),e=c(e,u,f,a,n[v+12],7,1804603682),a=c(a,e,u,f,n[v+13],12,-40341101),f=c(f,a,e,u,n[v+14],17,-1502002290),e=i(e,u=c(u,f,a,e,n[v+15],22,1236535329),f,a,n[v+1],5,-165796510),a=i(a,e,u,f,n[v+6],9,-1069501632),f=i(f,a,e,u,n[v+11],14,643717713),u=i(u,f,a,e,n[v],20,-373897302),e=i(e,u,f,a,n[v+5],5,-701558691),a=i(a,e,u,f,n[v+10],9,38016083),f=i(f,a,e,u,n[v+15],14,-660478335),u=i(u,f,a,e,n[v+4],20,-405537848),e=i(e,u,f,a,n[v+9],5,568446438),a=i(a,e,u,f,n[v+14],9,-1019803690),f=i(f,a,e,u,n[v+3],14,-187363961),u=i(u,f,a,e,n[v+8],20,1163531501),e=i(e,u,f,a,n[v+13],5,-1444681467),a=i(a,e,u,f,n[v+2],9,-51403784),f=i(f,a,e,u,n[v+7],14,1735328473),e=h(e,u=i(u,f,a,e,n[v+12],20,-1926607734),f,a,n[v+5],4,-378558),a=h(a,e,u,f,n[v+8],11,-2022574463),f=h(f,a,e,u,n[v+11],16,1839030562),u=h(u,f,a,e,n[v+14],23,-35309556),e=h(e,u,f,a,n[v+1],4,-1530992060),a=h(a,e,u,f,n[v+4],11,1272893353),f=h(f,a,e,u,n[v+7],16,-155497632),u=h(u,f,a,e,n[v+10],23,-1094730640),e=h(e,u,f,a,n[v+13],4,681279174),a=h(a,e,u,f,n[v],11,-358537222),f=h(f,a,e,u,n[v+3],16,-722521979),u=h(u,f,a,e,n[v+6],23,76029189),e=h(e,u,f,a,n[v+9],4,-640364487),a=h(a,e,u,f,n[v+12],11,-421815835),f=h(f,a,e,u,n[v+15],16,530742520),e=l(e,u=h(u,f,a,e,n[v+2],23,-995338651),f,a,n[v],6,-198630844),a=l(a,e,u,f,n[v+7],10,1126891415),f=l(f,a,e,u,n[v+14],15,-1416354905),u=l(u,f,a,e,n[v+5],21,-57434055),e=l(e,u,f,a,n[v+12],6,1700485571),a=l(a,e,u,f,n[v+3],10,-1894986606),f=l(f,a,e,u,n[v+10],15,-1051523),u=l(u,f,a,e,n[v+1],21,-2054922799),e=l(e,u,f,a,n[v+8],6,1873313359),a=l(a,e,u,f,n[v+15],10,-30611744),f=l(f,a,e,u,n[v+6],15,-1560198380),u=l(u,f,a,e,n[v+13],21,1309151649),e=l(e,u,f,a,n[v+4],6,-145523070),a=l(a,e,u,f,n[v+11],10,-1120210379),f=l(f,a,e,u,n[v+2],15,718787259),u=l(u,f,a,e,n[v+9],21,-343485551),e=o(e,s),u=o(u,d),f=o(f,p),a=o(a,g)}return[e,u,f,a]}function u(n){if(0===n.length)return[];for(var r=8*n.length,e=new Uint32Array(t(r)),u=0;u<r;u+=8)e[u>>5]|=(255&n[u/8])<<u%32;return e}function o(n,r){var t=(65535&n)+(65535&r);return(n>>16)+(r>>16)+(t>>16)<<16|65535&t}function f(n,r){return n<<r|n>>>32-r}function a(n,r,t,e,u,a){return o(f(o(o(r,n),o(e,a)),u),t)}function c(n,r,t,e,u,o,f){return a(r&t|~r&e,n,r,u,o,f)}function i(n,r,t,e,u,o,f){return a(r&e|t&~e,n,r,u,o,f)}function h(n,r,t,e,u,o,f){return a(r^t^e,n,r,u,o,f)}function l(n,r,t,e,u,o,f){return a(t^(r|~e),n,r,u,o,f)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var v=n;exports.default=v;
},{}],"DhOM":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./v35.js")),r=t(require("./md5.js"));function t(e){return e&&e.__esModule?e:{default:e}}var u=(0,e.default)("v3",48,r.default),d=u;exports.default=d;
},{"./v35.js":"y1M0","./md5.js":"hNcK"}],"hVBO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./rng.js")),r=t(require("./stringify.js"));function t(e){return e&&e.__esModule?e:{default:e}}function u(t,u,n){var a=(t=t||{}).random||(t.rng||e.default)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,u){n=n||0;for(var f=0;f<16;++f)u[n+f]=a[f];return u}return(0,r.default)(a)}var n=u;exports.default=n;
},{"./rng.js":"cT7V","./stringify.js":"Zh7j"}],"PBRp":[function(require,module,exports) {
"use strict";function r(r,e,t,a){switch(r){case 0:return e&t^~e&a;case 1:return e^t^a;case 2:return e&t^e&a^t&a;case 3:return e^t^a}}function e(r,e){return r<<e|r>>>32-e}function t(t){var a=[1518500249,1859775393,2400959708,3395469782],o=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof t){var n=unescape(encodeURIComponent(t));t=[];for(var s=0;s<n.length;++s)t.push(n.charCodeAt(s))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);for(var f=t.length/4+2,u=Math.ceil(f/16),c=new Array(u),l=0;l<u;++l){for(var i=new Uint32Array(16),v=0;v<16;++v)i[v]=t[64*l+4*v]<<24|t[64*l+4*v+1]<<16|t[64*l+4*v+2]<<8|t[64*l+4*v+3];c[l]=i}c[u-1][14]=8*(t.length-1)/Math.pow(2,32),c[u-1][14]=Math.floor(c[u-1][14]),c[u-1][15]=8*(t.length-1)&4294967295;for(var h=0;h<u;++h){for(var p=new Uint32Array(80),y=0;y<16;++y)p[y]=c[h][y];for(var d=16;d<80;++d)p[d]=e(p[d-3]^p[d-8]^p[d-14]^p[d-16],1);for(var A=o[0],g=o[1],w=o[2],M=o[3],x=o[4],U=0;U<80;++U){var C=Math.floor(U/20),_=e(A,5)+r(C,g,w,M)+x+a[C]+p[U]>>>0;x=M,M=w,w=e(g,30)>>>0,g=A,A=_}o[0]=o[0]+A>>>0,o[1]=o[1]+g>>>0,o[2]=o[2]+w>>>0,o[3]=o[3]+M>>>0,o[4]=o[4]+x>>>0}return[o[0]>>24&255,o[0]>>16&255,o[0]>>8&255,255&o[0],o[1]>>24&255,o[1]>>16&255,o[1]>>8&255,255&o[1],o[2]>>24&255,o[2]>>16&255,o[2]>>8&255,255&o[2],o[3]>>24&255,o[3]>>16&255,o[3]>>8&255,255&o[3],o[4]>>24&255,o[4]>>16&255,o[4]>>8&255,255&o[4]]}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var a=t;exports.default=a;
},{}],"UVmZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./v35.js")),r=t(require("./sha1.js"));function t(e){return e&&e.__esModule?e:{default:e}}var u=(0,e.default)("v5",80,r.default),s=u;exports.default=s;
},{"./v35.js":"y1M0","./sha1.js":"PBRp"}],"jae2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e="00000000-0000-0000-0000-000000000000";exports.default=e;
},{}],"SVu6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=r(require("./validate.js"));function r(e){return e&&e.__esModule?e:{default:e}}function t(r){if(!(0,e.default)(r))throw TypeError("Invalid UUID");return parseInt(r.substr(14,1),16)}var u=t;exports.default=u;
},{"./validate.js":"Tknj"}],"Lz3t":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"v1",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(exports,"v3",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(exports,"v4",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(exports,"v5",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(exports,"NIL",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(exports,"version",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(exports,"validate",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(exports,"stringify",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(exports,"parse",{enumerable:!0,get:function(){return s.default}});var e=a(require("./v1.js")),r=a(require("./v3.js")),t=a(require("./v4.js")),n=a(require("./v5.js")),u=a(require("./nil.js")),i=a(require("./version.js")),o=a(require("./validate.js")),f=a(require("./stringify.js")),s=a(require("./parse.js"));function a(e){return e&&e.__esModule?e:{default:e}}
},{"./v1.js":"nQZ2","./v3.js":"DhOM","./v4.js":"hVBO","./v5.js":"UVmZ","./nil.js":"jae2","./version.js":"SVu6","./validate.js":"Tknj","./stringify.js":"Zh7j","./parse.js":"EHUk"}],"hRpI":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.network=exports.debug=exports.k=exports.id=void 0;var r=e(require("kaboom")),t=e(require("./model/Network")),o=require("uuid"),s=new URLSearchParams(location.search),u=s.has("debug");function d(e){u&&exports.k.debug.log(e)}exports.id=(0,o.v4)(),exports.k=(0,r.default)({clearColor:[0,0,0,1],fullscreen:!0,width:320,height:240,scale:1.5,debug:u}),u&&(exports.k.debug.inspect=!0),exports.debug=d,exports.network=new t.default(exports.id),exports.default=exports.k;
},{"kaboom":"tp4l","./model/Network":"c3M1","uuid":"Lz3t"}],"UL96":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.PLAYER_TYPES=exports.POWERUPS=exports.DEFAULT_VOL=exports.LOCALSTORAGE_KEYS=exports.MUSIC_HURRY_DETUNE=exports.MUSIC_HURRY_SPEED=exports.ENEMY_SPEED=exports.WALK_SPEED=exports.BOMB_SPEED=exports.DIRS=exports.DOWN=exports.UP=exports.RIGHT=exports.LEFT=exports.IDLE=exports.COLORS=exports.YELLOW=exports.RED=exports.GREEN=exports.BLUE=exports.BLACK=exports.LIGHTGRAY=exports.DARKGRAY=exports.WHITE=exports.DEFAULT_GAME_TIME=exports.HEAVY_GRAVITY=exports.GRAVITY=exports.MAP_HEIGHT_PIXELS=exports.MAP_HEIGHT=exports.MAP_WIDTH_PIXELS=exports.MAP_WIDTH=exports.GRID_PIXEL_SIZE=void 0;var t,o=e(require("./kaboom")),r=o.default.rgb,E=o.default.vec2;exports.GRID_PIXEL_SIZE=32,exports.MAP_WIDTH=15,exports.MAP_WIDTH_PIXELS=exports.MAP_WIDTH*exports.GRID_PIXEL_SIZE,exports.MAP_HEIGHT=13,exports.MAP_HEIGHT_PIXELS=exports.MAP_HEIGHT*exports.GRID_PIXEL_SIZE,exports.GRAVITY=300,exports.HEAVY_GRAVITY=1600,exports.DEFAULT_GAME_TIME=180,exports.WHITE=r(1,1,1),exports.DARKGRAY=r(.25,.25,.25),exports.LIGHTGRAY=r(.5,.5,.5),exports.BLACK=r(0,0,0),exports.BLUE=r(.39,.47,.937),exports.GREEN=r(.223,.517,0),exports.RED=r(1,0,0),exports.YELLOW=r(1,1,0),exports.COLORS={WHITE:exports.WHITE,DARKGRAY:exports.DARKGRAY,LIGHTGRAY:exports.LIGHTGRAY,BLACK:exports.BLACK,BLUE:exports.BLUE,GREEN:exports.GREEN,RED:exports.RED,YELLOW:exports.YELLOW},exports.IDLE=E(0,0),exports.LEFT=E(-1,0),exports.RIGHT=E(1,0),exports.UP=E(0,-1),exports.DOWN=E(0,1),exports.DIRS={IDLE:exports.IDLE,LEFT:exports.LEFT,RIGHT:exports.RIGHT,UP:exports.UP,DOWN:exports.DOWN},exports.BOMB_SPEED=175,exports.WALK_SPEED=120,exports.ENEMY_SPEED=60,exports.MUSIC_HURRY_SPEED=1.75,exports.MUSIC_HURRY_DETUNE=-600,function(e){e.SFX_VOL="sfx_vol",e.MUS_VOL="mus_vol"}(t=exports.LOCALSTORAGE_KEYS||(exports.LOCALSTORAGE_KEYS={})),exports.DEFAULT_VOL="50",exports.POWERUPS={RADIUS:0,QUANTITY:2,SPEED:3,KICK:4,TIME:14,P_BOMB:15},exports.PLAYER_TYPES=["bomberman-tiny","daisy","luigi","mario","peach","toad","toadsworth","wario"];
},{"./kaboom":"hRpI"}],"BHXf":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.vec2floor=exports.snapToGrid=exports.getMusVol=exports.getSfxVol=exports.getOverlapped=exports.getAtPos=exports.findMapItem=exports.findMapItems=exports.convertMapPosToCoord=void 0;var r=require("./kaboom"),e=require("./types"),t=r.k.get,o=r.k.vec2;function n(r,e){var o=r.x,n=r.y;return t(e).filter(function(r){return!!r.pos&&(o>=r.pos.x&&o<=r.pos.x+r.width&&n>=r.pos.y&&n<=r.pos.y+r.height)})}function p(r,e){return t(e).filter(function(e){return e.area&&e.isOverlapped(r)})}function s(r,e){var t=[];return r.forEach(function(r,n){var p=-1;do{(p=r.indexOf(e,p+1))>=0&&t.push(o(p,n))}while(p>=0)}),t}function u(r,e){var t=s(r,e);return t.length?t[0]:void 0}function a(r){var t=r.x,n=r.y;return o(t*e.GRID_PIXEL_SIZE,(n+1)*e.GRID_PIXEL_SIZE)}function i(r){var t=r.x,n=r.y,p=t%e.GRID_PIXEL_SIZE,s=n%e.GRID_PIXEL_SIZE;return o(Math.round(t-p+(p<=e.GRID_PIXEL_SIZE/2?0:e.GRID_PIXEL_SIZE)),Math.round(n-s+(s<=e.GRID_PIXEL_SIZE/2?0:e.GRID_PIXEL_SIZE)))}function I(r){var e=r.x,t=r.y;return o(Math.floor(e),Math.floor(t))}function f(r){var t;return parseInt(null!==(t=localStorage[r])&&void 0!==t?t:e.DEFAULT_VOL)/100}exports.getAtPos=n,exports.getOverlapped=p,exports.findMapItems=s,exports.findMapItem=u,exports.convertMapPosToCoord=a,exports.snapToGrid=i,exports.vec2floor=I;var x=function(){return f(e.LOCALSTORAGE_KEYS.SFX_VOL)};exports.getSfxVol=x;var v=function(){return f(e.LOCALSTORAGE_KEYS.MUS_VOL)};exports.getMusVol=v;
},{"./kaboom":"hRpI","./types":"UL96"}],"hsLw":[function(require,module,exports) {
"use strict";var o=this&&this.__spreadArray||function(o,e,t){if(t||2===arguments.length)for(var i,n=0,r=e.length;n<r;n++)!i&&n in e||(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return o.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../model/Network"),t=require("../kaboom"),i=require("../util"),n=require("../types"),r=t.k.add,s=t.k.area,a=t.k.destroy,u=t.k.dt,c=t.k.get,p=t.k.origin,l=t.k.play,d=t.k.pos,h=t.k.rotate,f=t.k.scale,b=t.k.sprite,m=t.k.time,v=t.k.vec2,E=t.k.wait;function I(){var o=1,e=1,i=0,r=!1,s=!1,a=0,u=v(0,0);return{setRadius:function(e){return o=e},getRadius:function(){return o},canSpawnBomb:function(){return i<e&&this.isAlive()},decBombCnt:function(){return--i},incBombCnt:function(){return++i},canBombKick:function(){return r},canPBomb:function(){return s},spawnBomb:function(){if(!this.isDead()){var o=m(),e=this.pos.clone();if(!(o-a<.3&&e.eq(u))){a=o,u=e;var i=this.spawnBombAtPos(this.pos.add(this.area.p1).add(v(0,2)));return i&&t.k.readd(this),i}this.spawnPBomb(),a=0}},spawnBombAtPos:P,spawnPBomb:x,bombPowerup:function(i){i===n.POWERUPS.RADIUS?(o=o<9?o+1:9,(0,t.debug)("Sweet, your bomb radius is now "+o+"!")):i===n.POWERUPS.QUANTITY?(e=e<9?e+1:9,(0,t.debug)("Sweet, you can now drop "+e+" bombs!")):i===n.POWERUPS.KICK?(r=!0,(0,t.debug)("Kickin' the can!")):i===n.POWERUPS.P_BOMB&&(s=!0,(0,t.debug)("Sweet, let it all out!"))},kickBomb:function(o){if(this.canBombKick()){var e=.4*n.GRID_PIXEL_SIZE,i=o.pos.sub(this.pos);o.moving=i.x>e?n.RIGHT:i.x<-e?n.LEFT:i.y>e?n.DOWN:i.y<-e?n.UP:n.IDLE,(0,t.debug)("Kick bomb: "+o.moving.x+","+o.moving.y)}}}}function g(c){var m=3;return{update:function(){if(!this.paused){if((m-=u())<0)l("explosion",{volume:(0,i.getSfxVol)()}),this.explode();else if(m<=1&&(!this.moving||this.moving.eq(n.IDLE))){var o=Math.floor(m%1*10)%2==0;this.scale=2+(o?.05:0)}if(this.moving&&!this.moving.eq(n.IDLE)){var e=this.moving,t=e.x+e.y<0?.5:1.1;(0,i.getAtPos)(this.pos.add(this.moving.scale(n.GRID_PIXEL_SIZE*t))).some(function(o){return!!o.is("solid")||(!!o.is("player")||(!!o.is("enemy")||void(o.is("powerup")&&a(o))))})?(this.pos=(0,i.snapToGrid)(this.pos),this.moving=n.IDLE):this.move(this.moving.scale(n.BOMB_SPEED))}if(!this.solid)(0,i.getOverlapped)(this,"player").length||(this.solid=!0,this.use("solid"))}},remove:function(){a(this),c.decBombCnt()},explode:function(){a(this);var u=v(-14,-14),l=v(14,14),m=(0,i.snapToGrid)(this.pos).add(v(n.GRID_PIXEL_SIZE/2,n.GRID_PIXEL_SIZE/2));t.network.send(e.CMDS.BOMB_EXPLODE,m);for(var I=r([b("explosion"),f(.6666666),p("center"),s(u,l),d(m),"explosion"]),g=[],P=[],x=m.x,_=m.y,k=c.getRadius(),y=function(o){if((0,i.getAtPos)(o,"block").length)return!0;var e=(0,i.getAtPos)(o,"brick");if(e.length)return e.forEach(function(o){return o.explode()}),!0;var t=(0,i.getAtPos)(o,"powerup");if(t.length)return t.forEach(function(o){return a(o)}),!0;var n=(0,i.getAtPos)(o,"bomb");return!!n.length&&(n.forEach(function(o){return o.explode()}),!0)},S=1,B=!1;S<=k&&!B;S++){(B=y(D={x:x+n.GRID_PIXEL_SIZE*S,y:_}))||(S===k?P:g).push(r([b("explosion"),p("center"),f(.6666666),s(u,l),d(D),"explosion"]))}for(S=1,B=!1;S<=k&&!B;S++){(B=y(D={x:x-n.GRID_PIXEL_SIZE*S,y:_}))||(S===k?P:g).push(r([b("explosion"),p("center"),f(-.6666666,.6666666),s(u,l),d(D),"explosion"]))}for(S=1,B=!1;S<=k&&!B;S++){(B=y(D={x:x,y:_+n.GRID_PIXEL_SIZE*S}))||(S===k?P:g).push(r([b("explosion"),p("center"),f(.6666666,-.6666666),s(u,l),h(33),d(x,_+n.GRID_PIXEL_SIZE*S),"explosion"]))}for(S=1,B=!1;S<=k&&!B;S++){var D;(B=y(D={x:x,y:_-n.GRID_PIXEL_SIZE*S}))||(S===k?P:g).push(r([b("explosion"),p("center"),f(.6666666),s(u,l),h(33),d(x,_-n.GRID_PIXEL_SIZE*S),"explosion"]))}c.decBombCnt(),I.play("explode-origin"),g.forEach(function(o){return o.play("explode-mid")}),P.forEach(function(o){return o.play("explode-end")}),E(.7,function(){o(o([I],g,!0),P,!0).forEach(function(o){return a(o)})})}}}function P(o){if(this.paused)return!1;if(!this.canSpawnBomb())return!1;var n=(0,i.snapToGrid)(o);return!c().filter(function(o){var e;return!(null===(e=o.pos)||void 0===e||!e.eq(n))&&(o.is("bomb")||o.is("block")||o.is("brick")||o.is("powerup"))}).length&&(l("laybomb",{volume:(0,i.getSfxVol)()}),r([b("bomb"),f(2),s(v(2,4),v(14,16)),d(n),g(this),"bomb"]).play("bomb"),this.incBombCnt(),t.network.send(e.CMDS.BOMB_SPAWN,n),!0)}function x(){if(this.canPBomb())for(var o=0,e=!0;e;){o+=1;var t=this.pos.add(this.area.p1).add(v(0,2)).add(this.getDir().scale(o*n.GRID_PIXEL_SIZE));e=this.spawnBombAtPos(t)}}exports.default=I;
},{"../model/Network":"c3M1","../kaboom":"hRpI","../util":"BHXf","../types":"UL96"}],"eNmp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.gamepadDefaults=exports.keyboardDefaults=exports.KeyboardControlDefs=exports.GamepadControlDefs=void 0;var e,n=require("../kaboom"),r=require("../types");!function(e){e.left="left",e.right="right",e.up="up",e.down="down",e.primary="primary",e.secondary="secondary"}(e||(e={}));var o=function(){return function(e){Object.assign(this,e)}}();exports.GamepadControlDefs=o;var t=function(){function n(e){Object.assign(this,e)}return n.prototype.on=function(n,r,o){(n===e.primary||n===e.secondary?s:a)(this[n],r),o&&i(this[n],o)},n}();exports.KeyboardControlDefs=t,exports.keyboardDefaults=[new t({left:"left",right:"right",up:"up",down:"down",primary:"shift",secondary:"1"}),new t({left:"a",right:"d",up:"w",down:"s",primary:"space",secondary:"2"}),new t({left:"f",right:"h",up:"t",down:"g",primary:"b",secondary:"3"}),new t({left:"j",right:"l",up:"i",down:"k",primary:",",secondary:"4"})],exports.gamepadDefaults=[new o({id:"Logitech Dual Action (STANDARD GAMEPAD Vendor: 046d Product: c216)",left:1,right:2,up:3,down:4,primary:5,secondary:6})];var a=n.k.keyDown,s=n.k.keyPress,i=n.k.keyRelease;function u(n,a){return{add:function(){var a=this;n instanceof o?console.log("Add gamepad"):n instanceof t?(n.on(e.primary,function(){return a.spawnBomb()}),n.on(e.secondary,function(){return console.log(a)}),n.on(e.up,function(){return a.walk(r.DIRS.UP)}),n.on(e.down,function(){return a.walk(r.DIRS.DOWN)}),n.on(e.left,function(){return a.walk(r.DIRS.LEFT)}),n.on(e.right,function(){return a.walk(r.DIRS.RIGHT)})):console.log("Unknown def type.")}}}exports.default=u;
},{"../kaboom":"hRpI","../types":"UL96"}],"G3uk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../model/Network"),t=require("../kaboom"),i=require("../util"),r=require("../types"),s=t.k.body,u=t.k.destroy,o=t.k.gravity,n=t.k.play,a=t.k.vec2,l=t.k.wait;function d(){var d=!1;return{isDead:function(){return d},isAlive:function(){return!d},die:function(){var c=this;d||(d=!0,this.layer="ui",this.solid=!1,this.scale=this.scale.scale(2),this.pos=this.pos.sub(a(this.width,this.height)),n("die",{volume:(0,i.getSfxVol)()}),this.trigger("died"),t.network.send(e.CMDS.PLAYER_DIE),l(.8,function(){c.use(s({jumpForce:900,maxVel:5e3})),c.jump(),o(r.HEAVY_GRAVITY)}),l(3,function(){u(c),o(r.GRAVITY)}))}}}exports.default=d;
},{"../model/Network":"c3M1","../kaboom":"hRpI","../util":"BHXf","../types":"UL96"}],"Dhtq":[function(require,module,exports) {
"use strict";function e(e){return void 0===e&&(e=0),{getScore:function(){return e},decScore:function(r){e-=r,this.trigger("score_changed")},incScore:function(r){e+=r,this.trigger("score_changed")}}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"qcZE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../model/Network"),t=require("../types"),r=require("../util"),i=require("../kaboom"),o=i.k.time,n=i.k.vec2;function u(u){void 0===u&&(u=t.WALK_SPEED);var s=!1,a=1,d=0,c=n(0,1);return{isIdle:function(){return!s},isWalking:function(){return s},getDir:function(){return c},stop:function(){s=!1,i.network.send(e.CMDS.PLAYER_STOP)},walk:function(t){if(!this.paused&&!this.isDead()){s=!0,c=t,this.move(c.scale(u*a));var o=(0,r.vec2floor)(this.pos);i.network.send(e.CMDS.PLAYER_MOVE,[o.x,o.y,c.x,c.y,s])}},walkPowerup:function(e){e===t.POWERUPS.SPEED&&(a=2,d=(d>0?d:o())+30,(0,i.debug)("Greased LIGHTNING!"))},update:function(){this.resolve(),0!==d&&o()>d&&(d=0,a=1,(0,i.debug)("Back to normal speed."))}}}exports.default=u;
},{"../model/Network":"c3M1","../types":"UL96","../util":"BHXf","../kaboom":"hRpI"}],"AecW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../types"),r=require("../kaboom"),o=require("../util"),t=r.k.add,a=r.k.choose,i=r.k.destroy,s=r.k.pos,n=r.k.rand,c=r.k.randSeed,d=r.k.scale,u=r.k.sprite,h=r.k.vec2,l=r.k.wait,E=[e.LEFT,e.RIGHT,e.UP,e.DOWN],I=e.GRID_PIXEL_SIZE/2;function k(){return a(E)}function p(r){void 0===r&&(r=e.ENEMY_SPEED),c(Date.now());var a=k();return{checkMapToMy:function(r){var t=this.pos.add(this.area.p1.scale(this.scale.x,this.scale.y));return 0===(0,o.getAtPos)(t.add(r.scale(e.GRID_PIXEL_SIZE)),"solid").length},randomizeDir:function(){var r=0;do{a=k()}while(!this.checkMapToMy(a)&&r++<50);r>=50&&(a=e.IDLE)},die:function(){var e=t([u("smoke",{noArea:!0}),d(2),s(this.pos)]);e.play("smoke"),l(.8,function(){return i(e)}),i(this)},add:function(){var e=this;this.collides("solid",function(o){e.move(a.scale(-r)),e.randomizeDir()})},update:function(){var o=this;Array("x","y").some(function(r){if(a[r]&&Math.round(o.pos[r])%e.GRID_PIXEL_SIZE==0&&(o.checkMapToMy("x"===r?e.UP:e.LEFT)||o.checkMapToMy("x"===r?e.DOWN:e.RIGHT))&&n()<.4)return o.randomizeDir(),!0});var t=h(0,0);Array("x","y").forEach(function(i){if(0===a[i]){var s=Math.round(100*o.pos[i])/100%e.GRID_PIXEL_SIZE;0!==s&&(s=-s+(s>I?e.GRID_PIXEL_SIZE:0),s/=r/8,t[i]=s)}}),this.move(a.add(t).scale(r))}}}exports.default=p;
},{"../types":"UL96","../kaboom":"hRpI","../util":"BHXf"}],"yqLk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../kaboom"),t=e.k.area,r=e.k.scale,s=e.k.vec2;function u(){return{add:function(){this.use(r(2)),this.use(t(s(2,2),s(14,16)))}}}exports.default=u;
},{"../kaboom":"hRpI"}],"xDLI":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../kaboom"),t=e.k.area,r=e.k.scale,s=e.k.vec2;function u(){return{add:function(){this.use(r(1.15)),this.use(t(s(5,2),s(21,27)))}}}exports.default=u;
},{"../kaboom":"hRpI"}],"k1gU":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("./generic")),r=e(require("./toadsworth"));exports.default={generic:t.default,toadsworth:r.default};
},{"./generic":"yqLk","./toadsworth":"xDLI"}],"yFs6":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("../kaboom")),a=require("../types"),l=require("../util"),u=t.default.add,r=t.default.destroy,o=t.default.play,d=t.default.pos,s=t.default.rand,f=t.default.scale,i=t.default.sprite,_=t.default.width;function c(){o("bullet",{volume:(0,l.getSfxVol)()});var e=s()>.5?1:-1,t=u([i("bullet"),f(e,1),d(1===e?3*-a.GRID_PIXEL_SIZE:_()+a.GRID_PIXEL_SIZE,Math.floor(s(0,a.MAP_HEIGHT_PIXELS-a.GRID_PIXEL_SIZE))),"hazard","can-hurt-player"]);t.action(function(){t.move(125*t.scale.x,0),t.scale.x>0&&t.pos.x>_()&&r(t),t.scale.x<0&&t.pos.x<-t.width&&r(t)})}exports.default=c;
},{"../kaboom":"hRpI","../types":"UL96","../util":"BHXf"}],"s6WJ":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("../kaboom")),u=require("../util"),a=require("../types"),r=t.default.add,o=t.default.body,d=t.default.destroy,_=t.default.layer,f=t.default.pos,i=t.default.rand,l=t.default.scale,s=t.default.sprite;function I(){var e=i()>.5?1:-1,t=i(250,550),I=i(100,250)*e,p=e>0?i(4*-a.GRID_PIXEL_SIZE,.3*a.MAP_WIDTH_PIXELS):i(.7*a.MAP_WIDTH_PIXELS,a.MAP_WIDTH_PIXELS+4*a.GRID_PIXEL_SIZE),P=a.MAP_HEIGHT_PIXELS+a.GRID_PIXEL_SIZE,n=r([s("fish"),l(2*e,2),_("ui"),f(p,P),o({jumpForce:t}),"hazard"]);n.play("fish"),n.jump(),n.action(function(){n.move(I,0),n.pos.y<=P?(0,u.getAtPos)(n.pos,"player").forEach(function(e){e.die(),d(n)}):d(n)})}exports.default=I;
},{"../kaboom":"hRpI","../util":"BHXf","../types":"UL96"}],"rDEQ":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("../kaboom")),a=require("../types"),r=require("../util"),u=t.default.add,l=t.default.area,o=t.default.destroy,d=t.default.play,f=t.default.pos,i=t.default.rand,p=t.default.randSeed,s=t.default.scale,n=t.default.sprite,c=t.default.vec2,v=t.default.wait;function b(){var e=Object.values(a.POWERUPS),t=Math.floor(i(-5,20));return e.includes(t)?t:-1}function x(){return p(Date.now()),{explode:function(){d("breakbrick",{volume:(0,r.getSfxVol)()}),o(this);var e=u([n("brick"),s(2),f(this.pos)]);e.play("explode"),v(.5,function(){var t=b();t>=0&&(d("powerupappears",{volume:(0,r.getSfxVol)()}),u([n("powerups",{frame:t}),s(2),l(c(4,4),c(12,12)),f(e.pos),"powerup"])),o(e)})}}}exports.default=x;
},{"../kaboom":"hRpI","../types":"UL96","../util":"BHXf"}],"e9qO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../kaboom"),e=require("../types"),r=60;function u(t){var e=Math.floor(t%1*10),r=Math.floor(t)%60;return Math.floor(t/60)+":"+(r<10?"0":"")+r+"."+e}function n(n){var i=!1,o=!1,s=!0,a=0,f="",c=function(){return n-a<=r},p=function(){return a>=n},d=function(){return a>0},h=function(){return s},m=function(){return s=!1};return{isHurry:c,isTimeUp:p,isStarted:d,isPaused:h,getTime:function(){return a},pause:function(){return s=!0},unpause:m,start:function(){d()||(m(),a=.01)},powerup:function(r){r===e.POWERUPS.TIME&&(n+=30,(0,t.debug)("Sweet, you just increased game time by 30 sec!"))},writeTime:function(t){void 0===t&&(t=n);var e=u(t);f!==e&&(this.text=e,f=e)},update:function(){h()||d()&&(a+=t.k.dt(),this.writeTime(n-a),c()&&!o?(o=!0,this.trigger("hurry_up")):p()&&!i&&(i=!0,this.trigger("time_up")))}}}exports.default=n;
},{"../kaboom":"hRpI","../types":"UL96"}],"bBS3":[function(require,module,exports) {
module.exports=[["###############","#OOOOOOOOOOOOO#","#O1         2O#","#O           O#","#O           O#","#O           O#","#O OOOO OOOO O#","#O           O#","#O           O#","#O           O#","#O4         3O#","#OOOOOOOOOOOOO#","###############"],["###############","#1   O O$ O  2#","# #O# #O# #O# #","#    O O O g O#","# #O# # # #O# #","#O¢  g ¢ O O O#","#O# #O# # #O# #","#O  O   OO  $O#","# #O#£#g#O# # #","#O   O O   OO #","# #O# # # # # #","#4 O    O  O 3#","###############"]];
},{}],"yj6k":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,r,n,t){return new(n||(n=Promise))(function(o,i){function a(e){try{c(t.next(e))}catch(r){i(r)}}function u(e){try{c(t.throw(e))}catch(r){i(r)}}function c(e){var r;e.done?o(e.value):(r=e.value,r instanceof n?r:new n(function(e){e(r)})).then(a,u)}c((t=t.apply(e,r||[])).next())})},r=this&&this.__generator||function(e,r){var n,t,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,t&&(o=2&i[0]?t.return:i[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,i[1])).done)return o;switch(t=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,t=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=r.call(e,a)}catch(u){i=[6,u],t=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},n=this&&this.__spreadArray||function(e,r,n){if(n||2===arguments.length)for(var t,o=0,i=r.length;o<i;o++)!t&&o in r||(t||(t=Array.prototype.slice.call(r,0,o)),t[o]=r[o]);return e.concat(t||Array.prototype.slice.call(r))},t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var o=require("../kaboom"),i=t(require("../abilities/canBomb")),a=t(require("../abilities/canControl")),u=t(require("../abilities/canDie")),c=t(require("../abilities/canScore")),l=t(require("../abilities/canWalk")),s=t(require("../abilities/enemy")),f=t(require("../characters")),p=t(require("../hazards/Bullet")),d=t(require("../hazards/Fish")),_=t(require("../features/brick")),m=t(require("../features/timer")),h=t(require("../maps/campaign.json")),b=require("../abilities/canControl"),E=require("../util"),I=require("../types"),g=!0,y=o.k.action,k=o.k.add,S=o.k.addLevel,P=o.k.area,v=o.k.choose,M=o.k.color,T=o.k.destroy,H=o.k.go,D=o.k.gravity,A=o.k.layer,R=o.k.layers,w=o.k.loadSound,L=o.k.origin,G=o.k.overlaps,U=o.k.play,q=o.k.pos,x=o.k.rand,X=o.k.rect,C=o.k.scale,Y=o.k.solid,W=o.k.sprite,Z=o.k.text,V=o.k.vec2,j=o.k.wait;function B(t,B,N){return void 0===t&&(t=1),void 0===B&&(B=1),void 0===N&&(N=!1),e(this,void 0,void 0,function(){var e,z,O,F,$,J,K,Q,ee,re,ne;return r(this,function(r){switch(r.label){case 0:return e=h.default[B],o.network.enabled=N,O=v(["mb","mp"]),[4,Promise.all([w("music-intro","assets/music/"+O+"i.ogg"),w("music","assets/music/"+O+".ogg")])];case 1:return r.sent(),R(["bg","obj","ui"],"obj"),D(I.GRAVITY),F={width:I.GRID_PIXEL_SIZE,height:I.GRID_PIXEL_SIZE,pos:V(0,I.GRID_PIXEL_SIZE),scale:2,"#":[W("block"),C(2),Y(),"solid","block"],O:[W("brick"),C(2),Y(),(0,_.default)(),"solid","brick"],any:function(e){return null}},S(e,F),k([X(I.MAP_WIDTH_PIXELS,I.MAP_HEIGHT_PIXELS,{noArea:g}),q(0,I.GRID_PIXEL_SIZE),M(I.GREEN),A("bg")]),n(n(n([],(0,E.findMapItems)(e,"¢").map(function(e){return k([W("coin",{animSpeed:.2,frame:0}),q((0,E.convertMapPosToCoord)(e)),P(V(4,4),V(28,28)),"coin","coin-10"])}),!0),(0,E.findMapItems)(e,"$").map(function(e){return k([W("coin",{animSpeed:.2,frame:4}),q((0,E.convertMapPosToCoord)(e)),P(V(4,4),V(28,28)),"coin","coin-30"])}),!0),(0,E.findMapItems)(e,"£").map(function(e){return k([W("coin",{animSpeed:.2,frame:8}),q((0,E.convertMapPosToCoord)(e)),P(V(4,4),V(28,28)),"coin","coin-50"])}),!0).forEach(function(e){var r=["coin-10","coin-30","coin-50"].find(function(r){return e.is(r)});r&&e.play(r)}),n([],(0,E.findMapItems)(e,"g").map(function(e){return k([W("goomba",{animSpeed:.5}),(0,s.default)(),C(2),q((0,E.convertMapPosToCoord)(e)),P(V(2,2),V(14,14)),"can-get-hurt","can-hurt-player","enemy"])}),!0).forEach(function(e){e.play("walk")}),k([X(I.MAP_WIDTH_PIXELS-1,I.GRID_PIXEL_SIZE-1,{noArea:g}),M(I.WHITE)]),k([X(I.MAP_WIDTH_PIXELS-5,I.GRID_PIXEL_SIZE-5,{noArea:g}),q(2,2),M(I.BLUE)]),$=k([Z("",16,{noArea:g}),q(12,9),(0,m.default)(I.DEFAULT_GAME_TIME)]),J=k([Z("",16,{noArea:g}),q(I.MAP_WIDTH_PIXELS-10,9),L("topright")]),$.on("hurry_up",function(){(0,o.debug)("Time's running out!"),z.pause(),U("hurryup",{volume:(0,E.getMusVol)()}),j(3.3,function(){ee()||(z.speed(I.MUSIC_HURRY_SPEED),z.detune(I.MUSIC_HURRY_DETUNE),z.play())});for(var e,r,n=1,t=function(e,r,n){j(e,function(){var e=V(r,n).scale(I.GRID_PIXEL_SIZE);k([W("block"),C(2),"fallingblock",q(V(r,n).sub(V(0,I.MAP_HEIGHT)).scale(I.GRID_PIXEL_SIZE)),{targ:e}])})},i=1;i<=3;i+=1){for(r=1+i,e=i;e<I.MAP_WIDTH-i;e+=1)t(n+=.5,e,r);for(e=I.MAP_WIDTH-i-1,r=2+i;r<I.MAP_HEIGHT-i;r+=1)t(n+=.5,e,r);for(r=I.MAP_HEIGHT-i,e=I.MAP_WIDTH-1-i;e>=i;e-=1)t(n+=.5,e,r);for(e=i,r=I.MAP_HEIGHT-i-1;r>i+1;r-=1)t(n+=.5,e,r)}var a=[x(3,8),x(12,19),x(25,35),x(38,42),x(43,48),x(49,51),x(52,56)];x()>.5?((0,o.debug)("You better run, better run, faster than my bullet..."),a.forEach(function(e){j(e,p.default)})):((0,o.debug)("Gone fishin'..."),a.forEach(function(e){j(e,d.default)}))}),$.on("time_up",function(){z.stop(),H("timeup")}),K=function(){$.isStarted()||($.start(),z=U("music-intro",{volume:(0,E.getMusVol)(),detune:$.isHurry()?I.MUSIC_HURRY_DETUNE:0,speed:$.isHurry()?I.MUSIC_HURRY_SPEED:1}),j(2.4,function(){z.paused()||ee()||(z=U("music",{volume:(0,E.getMusVol)(),loop:!0,detune:$.isHurry()?I.MUSIC_HURRY_DETUNE:0,speed:$.isHurry()?I.MUSIC_HURRY_SPEED:1}))}))},Q=Array.from(Array(t).keys()).map(function(r){var n=(r+1).toString(),t=(0,E.convertMapPosToCoord)((0,E.findMapItem)(e,n)),o=t.x,s=t.y,p=v(I.PLAYER_TYPES),d=f.default[p]||f.default.generic;return k([W(p),q(o,s),d(),(0,i.default)(),(0,a.default)(b.keyboardDefaults[r]),(0,u.default)(),(0,c.default)(),(0,l.default)(),"can-get-hurt","player"])}),ee=function(){return Q.every(function(e){return e.isDead()})},re=function(){ee()&&(z.stop(),$.pause(),j(2.6,function(){return H("lose")}))},ne=function(){J.text="Score: "+Q[0].getScore().toLocaleString()},Q.forEach(function(e){e.on("died",re),e.on("score_changed",ne)}),G("bomb","player",function(e,r){e.solid&&r.kickBomb(e)}),G("explosion","can-get-hurt",function(e,r){r.die()}),G("can-hurt-player","player",function(e,r){r.die()}),G("coin","player",function(e,r){U("coin",{volume:(0,E.getSfxVol)()}),e.is("coin-10")?r.incScore(10):e.is("coin-30")?r.incScore(30):e.is("coin-50")&&r.incScore(50),T(e)}),G("powerup","player",function(e,r){U("powerup",{volume:(0,E.getSfxVol)()}),r.bombPowerup(e.frame),r.walkPowerup(e.frame),$.powerup(e.frame),T(e)}),y("fallingblock",function(e){e.move(0,250),e.pos.dist(e.targ)<I.GRID_PIXEL_SIZE/5&&(U("thud",{volume:(0,E.getSfxVol)()}),e.pos=e.targ,e.rmTag("fallingblock"),(0,E.getOverlapped)(e).forEach(function(e){e.is("can-get-hurt")?e.die():e.is("bomb")?e.explode():e._tags.length&&!e.is("hazard")&&T(e)}),e.use(Y()),e.use("block"),e.use("solid"))}),o.k.keyPress("escape",function(){U("pause",{volume:(0,E.getSfxVol)()}),$.isPaused()?($.unpause(),o.k.get().forEach(function(e){return e.paused=!1}),z.play()):($.pause(),o.k.get().forEach(function(e){return e.paused=!0}),z.pause())}),o.k.debug.clearLog(),$.writeTime(),ne(),K(),[2]}})})}exports.default=B;
},{"../kaboom":"hRpI","../abilities/canBomb":"hsLw","../abilities/canControl":"eNmp","../abilities/canDie":"G3uk","../abilities/canScore":"Dhtq","../abilities/canWalk":"qcZE","../abilities/enemy":"AecW","../characters":"k1gU","../hazards/Bullet":"yFs6","../hazards/Fish":"s6WJ","../features/brick":"rDEQ","../features/timer":"e9qO","../maps/campaign.json":"bBS3","../util":"BHXf","../types":"UL96"}],"ETT4":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../kaboom"),t=e.k.add,n=e.k.color,o=e.k.destroy,i=e.k.keyPress,r=e.k.origin,u=e.k.pos,d=e.k.text,a=e.k.readd,c=e.k.rect,s=e.k.rgba,l={blurOnSelect:!1,emptyMessage:"No Data",fontColor:s(1,1,1,1),fontSize:12,backgroundColor:s(.25,.25,.25,1),focusColor:s(.4,.4,.4,1),highlightColor:s(.1,.1,.1,.5),maxRows:4,multiple:!0,padding:8};function h(n,i,r){var u;return void 0===n&&(n=!1),{add:function(){i&&r&&(u=t([e.k.sprite(n?r:i),e.k.pos(this.pos.sub(20,2)),e.k.scale(.5)]))},updateUI:function(){a(this),u&&a(u)},setSelected:function(e){n=e,i&&r&&u.changeSprite(n?r:i)},toggleSelected:function(){this.setSelected(!n)},getSelected:function(){return n},destroy:function(){u&&o(u)}}}function g(e){return void 0===e&&(e=""),{setValue:function(t){return e=t},getValue:function(){return e}}}function f(e,a){void 0===e&&(e=[]),void 0===a&&(a={});var f,p,k=Object.assign(l,a),x=e.length?0:-1,S=!1,b=[];return{setData:function(i){var r=this;b.forEach(function(e){return e?o(e):0}),b=i.map(function(e,o){if(!(o+1>k.maxRows))return t([d(e.label,k.fontSize,{noArea:!1,width:r.width-2*k.padding-16}),n(k.fontColor),u(r.pos.add(k.padding+20,k.padding+o*(k.fontSize+k.padding))),h(!!e.selected,k.checkboxSprite,k.checkboxCheckedSprite),g(e.value)])}),e=i,f.text=e.length?"":k.emptyMessage,x>i.length-1&&(x=i.length-1),this.updateUI()},getData:function(){return b.map(function(e){return{label:e.text,value:e.getValue(),selected:e.getSelected()}})},getSelected:function(){return this.getData().filter(function(e){return e.selected})},getIndex:function(){return x},setIndex:function(t){t<0&&(t=0),t>e.length-1&&(t=e.length-1),t>k.maxRows-1&&(t=k.maxRows-1),x=t,this.updateUI()},isFocused:function(){return S},blur:function(){S=!1,this.color=k.backgroundColor,o(p),p=null,this.updateUI()},focus:function(){S=!0,this.color=k.focusColor,p=t([c(this.width-k.padding,k.fontSize+k.padding,{noArea:!0}),n(k.highlightColor),u(this.pos.x+this.area.p1.x+k.padding/2,0)]),x<0&&b.length>0&&(x=0),this.updateUI()},updateUI:function(){p&&(x>=0&&x<b.length&&S?(p.color=k.highlightColor,p.pos.y=b[x].pos.y-k.padding/2,b[x].updateUI()):p.color=s(0,0,0,0))},add:function(){var o=this;f=t([d("",k.fontSize,{noArea:!0}),n(k.highlightColor),u(this.pos.add(this.area.p1.add(this.area.p2).scale(.5))),r("center")]),this.use(n(k.backgroundColor)),this.setData(e),i("space",function(){var e,t;o.isFocused()&&(k.multiple||b.forEach(function(e,t){return t!==x&&e?e.setSelected(!1):0}),null===(e=b[x])||void 0===e||e.toggleSelected(),(null===(t=b[x])||void 0===t?void 0:t.getSelected())&&k.blurOnSelect&&o.blur())}),i("up",function(){o.isFocused()&&o.setIndex(o.getIndex()-1)}),i("down",function(){o.isFocused()&&o.setIndex(o.getIndex()+1)})},destroy:function(){o(f),b.forEach(function(e){return o(e)})}}}exports.default=f;
},{"../kaboom":"hRpI"}],"nIBZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../kaboom"),o=t.k.add,e=t.k.charInput,r=t.k.color,s=t.k.destroy,n=t.k.keyIsDown,a=t.k.keyPress,c=t.k.pos,u=t.k.text,i=t.k.time,k=t.k.rgb,d={fontColor:k(1,1,1),backgroundColor:k(.25,.25,.25),focusColor:k(.5,.5,.5),maxChars:100};function f(t,k,f){void 0===t&&(t=""),void 0===k&&(k=12),void 0===f&&(f={});var h,l=Object.assign(d,f),x=!1,C=!1;return{keyPress:function(o){x&&("backspace"===o?t=t.slice(0,-1):t.length<l.maxChars&&(n("shift")&&(o=o.toUpperCase()),t+=o),h.text=t+(C&&t.length<l.maxChars?"_":""))},getText:function(){return t},setText:function(o){t=o,h.text=o+(C&&t.length<l.maxChars?"_":"")},isFocused:function(){return x},blur:function(){x=!1,this.color=l.backgroundColor},focus:function(){x=!0,this.color=l.focusColor},add:function(){var s=this;this.use(r(l.backgroundColor)),a("backspace",function(){return s.keyPress("backspace")}),e(function(t){return s.keyPress(t)}),h=o([u(t,k,{width:this.width-6,noArea:!1}),c(this.pos.add(4,6)),r(l.fontColor)])},update:function(){if(x||C){var o=!!x&&i()%1>.5;C!==o&&(C=o,h.text=t+(C&&t.length<l.maxChars?"_":""))}},destroy:function(){s(h)}}}exports.default=f;
},{"../kaboom":"hRpI"}],"mndu":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,u){function a(e){try{c(r.next(e))}catch(t){u(t)}}function i(e){try{c(r.throw(e))}catch(t){u(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,i)}c((r=r.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){var n,r,o,u,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return u={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function i(u){return function(i){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===u[0]||2===u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(i){u=[6,i],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,i])}}},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("../kaboom"),o=require("../model/Network"),u=require("../types"),a=require("../util"),i=n(require("../features/select")),c=n(require("../features/textbox"));function l(e){return{menuAction:e}}function s(n){var s=this;void 0===n&&(n="startCampaign");var f,p,d=r.k.add,h=r.k.color,k=r.k.destroy,b=r.k.go,v=r.k.keyPress,y=r.k.origin,w=r.k.play,m=r.k.pos,x=r.k.rect,g=r.k.rand,E=r.k.sprite,M=r.k.text,_=r.k.width,T=r.k.height,O=0,D=function(e){if(!((null==f?void 0:f.isFocused())||(null==p?void 0:p.isFocused()))){e<0&&(e=0),e>P.length-1&&(e=P.length-1);var t=P[e],n=P[R],r=t.pos.add(t.area.p2.add(t.area.p1).scale(.5)).y;n.text&&(n.color=u.WHITE),t.text&&(t.color=u.YELLOW),F.forEach(function(e){return e.pos.y=r}),R=e}},I=function(e){void 0===e&&(e=O+1),e<1&&(e=4),e>4&&(e=1),O=e,P[0].text="Number of Players: "+O},S=w("menu-3",{loop:!0,volume:(0,a.getMusVol)()});d([M("Game Setup",18),h(u.WHITE),y("center"),m(_()/2,.15*T())]);var W,R=0,q=d([M("Number of Players",14),h(u.WHITE),y("center"),m(_()/2,.3*T()),l(I)]),A=d([M("Online: Off",14),h(u.WHITE),y("center"),m(_()/2,.375*T()),l(function(){return e(s,void 0,void 0,function(){return t(this,function(e){switch(e.label){case 0:return f?(r.network.leave(),r.network.enabled=!1,k(f),k(p),k(W),f=null,p=null,A.text="Online: Disabled",H.pos.y=.525*T(),P.splice(3,2),[3,3]):[3,1];case 1:return W=d([M("Room:",14),y("left"),m(_()/2-175,.6*T()-30),l(function(){f.isFocused()?(f.blur(),r.network.leave(),r.network.create(f.getText())):f.focus()})]),f=d([x(270,24,{noArea:!1}),m(W.pos.x+80,W.pos.y-11),(0,c.default)("My great room #"+Math.floor(g(1e4,99999)).toString(),12,{maxChars:22})]),p=d([x(350,T()-.6*T()-65),m(_()/2-175,T()-.6*T()+95),h(u.DARKGRAY),l(function(){return p.isFocused()?p.blur():p.focus()}),(0,i.default)([],{maxRows:6,emptyMessage:"Waiting for players...",checkboxSprite:"checkbox",checkboxCheckedSprite:"checkbox-checked"})]),A.text="Online: Enabled",H.pos.y=T()-40,P.pop(),P.push(W,p,H),r.network.enabled=!0,r.network.connect(),[4,r.network.create(f.getText())];case 2:e.sent(),r.network.on(o.CMDS.ROOM_ENTER,function(e){var t=e[0],n=e[1];console.log("enter",t,n);var r=p.getData();r.push({label:n.name,value:t}),p.setData(r)}),r.network.on(o.CMDS.ROOM_EXIT,function(e){var t=e[0],n=e[1];console.log("exit",t,n);var r=p.getData(),o=r.findIndex(function(e){return e.value===t});o<0||(r.splice(o,1),p.setData(r))}),e.label=3;case 3:return[2]}})})})]),C=d([M("Continue!",14),h(u.WHITE),y("center"),m(_()/2,.45*T()),l(function(){S.stop(),b(n,O)})]),H=d([M("Back to Main Menu",14),h(u.WHITE),y("center"),m(_()/2,.525*T()),l(function(){r.network.leave(),r.network.enabled=!1,S.stop(),b("mainMenu")})]),P=[q,A,C,H],F=[d([E("title-mushroom"),m(_()/2-200,.3*T()),y("center")]),d([E("title-mushroom"),m(_()/2+200,.3*T()),y("center")])];v("up",function(){return D(R-1)}),v("down",function(){return D(R+1)}),v("enter",function(){return P[R].menuAction?P[R].menuAction():0}),D(R),I()}exports.default=s;
},{"../kaboom":"hRpI","../model/Network":"c3M1","../types":"UL96","../util":"BHXf","../features/select":"ETT4","../features/textbox":"nIBZ"}],"mL5h":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../kaboom"),n=require("../types"),o=require("../util"),r=e(require("../features/select")),u=e(require("../features/textbox"));function a(e){return{menuAction:e}}function i(){var e=t.k.add,i=t.k.color,c=t.k.destroy,l=t.k.go,s=t.k.keyPress,f=t.k.origin,d=t.k.play,m=t.k.pos,k=t.k.rect,p=t.k.rand,g=t.k.sprite,h=t.k.text,v=t.k.width,x=t.k.height,b=[],y=function(e){if(!((null==A?void 0:A.isFocused())||(null==_?void 0:_.isFocused()))){e<0&&(e=0),e>q.length-1&&(e=q.length-1);var t=q[e],o=q[I],r=t.pos.add(t.area.p2.add(t.area.p1).scale(.5)).y;o.text&&(o.color=n.WHITE),t.text&&(t.color=n.YELLOW),T.forEach(function(e){return e.pos.y=r}),I=e}},M=function(){null==_||_.setData(b.map(function(e){return{value:e.roomId,label:e.metadata.name+" ("+e.clients.toString()+")"}}))},w=d("menu-3",{loop:!0,volume:(0,o.getMusVol)()});e([h("Join an Online Game",18),i(n.WHITE),f("center"),m(v()/2,.15*x())]),e([h("Games:",14),i(n.WHITE),f("left"),m(v()/2-175,.35*x())]);var I=0,S=e([h("Name:",14),f("left"),m(v()/2-175,.25*x()),a(function(){A.isFocused()?(A.blur(),localStorage.playerName=A.getText()):A.focus()})]),W=e([h("Join Game!",14),i(n.WHITE),f("center"),m(v()/2,.8*x()),a(function(){var e=_.getSelected();if(0!==e.length){t.network.leave();var n=e[0].value;w.stop(),c(_),_=null,l("joinWait",n,A.getText())}})]),E=e([h("Back to Main Menu",14),i(n.WHITE),f("center"),m(v()/2,.9*x()),a(function(){w.stop(),c(_),_=null,t.network.leave(),t.network.enabled=!1,l("mainMenu")})]),T=[e([g("title-mushroom"),m(v()/2-200,.3*x()),f("center")]),e([g("title-mushroom"),m(v()/2+200,.3*x()),f("center")])],A=e([k(270,24,{noArea:!1}),m(S.pos.x+80,S.pos.y-11),(0,u.default)(localStorage.playerName||"Player #"+Math.floor(p(1e4,99999)).toString(),12,{maxChars:22})]),_=e([k(350,.315*x()),m(v()/2-175,.38*x()),i(n.DARKGRAY),a(function(){return _.isFocused()?_.blur():_.focus()}),(0,r.default)([],{maxRows:8,multiple:!1,emptyMessage:"Waiting for games...",checkboxSprite:"checkbox",checkboxCheckedSprite:"checkbox-checked",blurOnSelect:!0})]),q=[S,_,W,E];s("up",function(){return y(I-1)}),s("down",function(){return y(I+1)}),s("enter",function(){return q[I].menuAction?q[I].menuAction():0}),y(I),t.network.enabled=!0,t.network.connect(),t.network.lobby(function(e){e.onMessage("rooms",function(e){b=e,M()}),e.onMessage("+",function(e){var t=e[0],n=e[1],o=b.findIndex(function(e){return e.roomId===t});-1!==o?b[o]=n:b.push(n),M()}),e.onMessage("-",function(e){b=b.filter(function(t){return t.roomId!==e}),M()}),e.onLeave(function(){b=[],M()})})}exports.default=i;
},{"../kaboom":"hRpI","../types":"UL96","../util":"BHXf","../features/select":"ETT4","../features/textbox":"nIBZ"}],"ZM2D":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function u(e){try{c(r.next(e))}catch(t){i(t)}}function a(e){try{c(r.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(u,a)}c((r=r.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){var n,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(a){i=[6,a],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("../kaboom"),r=require("../types"),o=require("../util"),i=require("../model/Network");function u(e){return{menuAction:e}}function a(a,c){return e(this,void 0,void 0,function(){var e,l,s,f,p,h,k,d,y,b,w,v,m,g,x,E,S,_;return t(this,function(t){return e=n.k.add,l=n.k.color,n.k.destroy,s=n.k.go,f=n.k.keyPress,p=n.k.origin,h=n.k.play,k=n.k.pos,n.k.rect,n.k.rand,d=n.k.sprite,y=n.k.text,b=n.k.width,w=n.k.height,v=function(e){e<0&&(e=0),e>_.length-1&&(e=_.length-1);var t=_[e],n=_[x],o=t.pos.add(t.area.p2.add(t.area.p1).scale(.5)).y;n.text&&(n.color=r.WHITE),t.text&&(t.color=r.YELLOW),S.forEach(function(e){return e.pos.y=o}),x=e},m=function(){return _[x].menuAction?_[x].menuAction():0},function(e){e.onMessage("start",function(){s("playerSelection")}),e.onMessage("bunt",function(e){s("joinStart")})},g=h("menu-3",{loop:!0,volume:(0,o.getMusVol)()}),e([y("Waiting to Start...",18),l(r.WHITE),p("center"),k(b()/2,.35*w())]),x=0,E=e([y("Go Back",14),l(r.WHITE),p("center"),k(b()/2,.66*w()),u(function(){g.stop(),n.network.send(i.CMDS.ROOM_EXIT),n.network.leave(),n.network.enabled=!1,s("joinStart")})]),S=[e([d("title-mushroom"),k(b()/2-150,.66*w()),p("center")]),e([d("title-mushroom"),k(b()/2+150,.66*w()),p("center")])],_=[E],f("up",function(){return v(x-1)}),f("down",function(){return v(x+1)}),f("enter",m),v(x),n.network.join(a,c),[2]})})}exports.default=a;
},{"../kaboom":"hRpI","../types":"UL96","../util":"BHXf","../model/Network":"c3M1"}],"FZKx":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("../kaboom"));function a(){var e=t.default.add,a=t.default.color,r=t.default.go,u=t.default.keyPress,d=t.default.origin,l=t.default.pos,o=t.default.scale,f=t.default.sprite,s=t.default.text,i=t.default.width,n=t.default.height;e([f("gameover",{noArea:!0}),d("center"),l(.5*i(),.4*n()),o(2)]),e([s("Press spacebar to try again",9),a(1,1,1,1),d("center"),l(.5*i(),.6*n())]);var c=function(){r("mainMenu")};u("space",c),u("enter",c),u("escape",c)}exports.default=a;
},{"../kaboom":"hRpI"}],"ulzC":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../kaboom");function t(){return{update:function(){this.scale=Math.abs(1.5*Math.sin(e.k.time()))+1.5}}}function i(){e.k.add([e.k.sprite("title-super",{noArea:!0}),e.k.pos(.5*e.k.width(),.25*e.k.height()),e.k.scale(1.8),t(),e.k.origin("center")]),e.k.add([e.k.sprite("title-bomber",{noArea:!0}),e.k.pos(.5*e.k.width()-60,.4*e.k.height()),e.k.scale(1.15),e.k.origin("center")]),e.k.add([e.k.sprite("title-bros",{noArea:!0}),e.k.pos(.5*e.k.width()+120,.4*e.k.height()),e.k.scale(1.5),e.k.origin("center")])}exports.default=i;
},{"../kaboom":"hRpI"}],"QSkN":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("./createTitle")),n=require("../kaboom"),r=require("../types"),o=require("../util");function u(e){return{menuAction:e}}function i(e){void 0===e&&(e=0);var i=n.k.add,a=n.k.color,c=n.k.go,l=n.k.keyPress,s=n.k.origin,f=n.k.play,p=n.k.pos,m=n.k.sprite,k=n.k.text,d=n.k.width,g=n.k.height,h=f("menu-1",{loop:!0,volume:(0,o.getMusVol)()});(0,t.default)();var v=[i([k("Start a Campaign",14),a(r.WHITE),s("center"),p(.5*d(),.55*g()),u(function(){return c("gameSetup","startCampaign")})]),i([k("Play Battle Round",14),a(r.WHITE),s("center"),p(.5*d(),.65*g()),u(function(){return c("gameSetup","startBattle")})]),i([k("Join an Online Game",14),a(r.WHITE),s("center"),p(.5*d(),.75*g()),u(function(){return c("joinStart")})]),i([k("Preferences",14),a(r.WHITE),s("center"),p(.5*d(),.85*g()),u(function(){return c("pref")})])],y=[i([m("title-mushroom"),p(.5*d()-170,.55*g()),s("center")]),i([m("title-mushroom"),p(.5*d()+170,.55*g()),s("center")])],E=function(t){var n=v[t].pos.y;v[e].color=r.WHITE,v[t].color=r.YELLOW,y.forEach(function(e){return e.pos.y=n}),e=t};l("up",function(){E(0===e?0:e-1)}),l("down",function(){E(e===v.length-1?v.length-1:e+1)});var T=function(){v[e].menuAction&&(v[e].menuAction(),h.stop())};l("space",T),l("enter",T),E(e)}exports.default=i;
},{"./createTitle":"ulzC","../kaboom":"hRpI","../types":"UL96","../util":"BHXf"}],"ZH20":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ControllerType=void 0;var t,e=require("../kaboom"),o=require("../types"),n=e.k.add,r=e.k.color,i=e.k.destroy,s=e.k.origin,u=e.k.pos,p=e.k.sprite,a=e.k.text,d=e.k.vec2;function c(){var e,c,l,f,h="",y=!1,x=!1;return{blur:function(){x=!1,this.updateUI()},focus:function(){x=!0,this.updateUI()},toggleDone:function(){y=!y,this.updateUI()},getDone:function(){return y},getCharacter:function(){return h},setCharacter:function(t){h=t,l.use(p(t))},clearController:function(){e=null,c=null,this.updateUI()},setController:function(t,o){e=t,c=o,this.updateUI()},reposition:function(t,e){this.pos=d(t,e),this.updateUI()},updateUI:function(){this.color=y?o.GREEN:x?o.LIGHTGRAY:o.DARKGRAY,l.pos=this.pos,f.pos=d(this.pos.add(0,this.height/2+16)),e===t.Keyboard&&"number"==typeof c?f.text="Kybd #"+(c+1).toString():e===t.Gamepad&&"number"==typeof c?f.text="Gamepad #"+(c+1).toString():e===t.Online?f.text=c:f.text="Unselected"},add:function(){this.use(r(o.DARKGRAY)),f=n([a("",9),s("center"),u(this.pos),r(o.DARKGRAY)]),l=n([u(this.pos),s("center")])},destroy:function(){i(l),i(f)}}}!function(t){t[t.Keyboard=0]="Keyboard",t[t.Gamepad=1]="Gamepad",t[t.Online=2]="Online"}(t=exports.ControllerType||(exports.ControllerType={})),exports.default=c;
},{"../kaboom":"hRpI","../types":"UL96"}],"sYg9":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../kaboom"),n=require("../types"),r=require("../util"),o=e(require("../features/playerRect")),u=e(require("../features/textbox"));function i(e,i){void 0===e&&(e=1),void 0===i&&(i="startCampaign");var a=t.k.add,l=t.k.charInput,c=t.k.color,f=t.k.destroy,s=t.k.go,p=t.k.keyPress,k=t.k.origin,h=t.k.play,d=t.k.pos,g=t.k.rect,y=t.k.rand,m=t.k.text,v=t.k.width,x=t.k.height,b=0,E=function(){return a([g(64,64,{noArea:!0}),d(.5*v(),.2*x()),k("center"),c(n.DARKGRAY),(0,o.default)()])};a([m("Player Selection",18),c(n.WHITE),k("center"),d(.5*v(),.06*x())]);var M,I=a([m("",11),c(n.RED),k("center"),d(.5*v(),.85*x())]),O=h("menu-3",{loop:!0,volume:(0,r.getMusVol)()}),P=[E()],W=function(e){for(void 0===e&&(e=1),e<1&&(e=4),e>4&&(e=1);P.length>e;)f(P.pop());for(;P.length<e;)P.push(E());var t=v()/(e+1);P.forEach(function(e,n){return e.reposition(t*(n+1),e.pos.y)}),T[0].text="Number of Players: "+P.length},H=[function(e){},function(e){M&&"space"===e||(M?(f(M),M=null,T[1].text="Online: Off",I.text=""):(T[1].text="Online room:",I.text="Sorry, online mode isn't available yet!",(M=_()).focus()))},function(e){O.stop(),s(i,P.length)},function(e){O.stop(),s("mainMenu")}],T=[a([m("Number of Players",14),c(n.WHITE),d(.1*v(),.4*x())]),a([m("Online: Off",14),c(n.WHITE),d(.1*v(),.475*x())]),a([m("Start game!",14),c(n.WHITE),d(.1*v(),.55*x())]),a([m("Back to Main Menu",14),c(n.WHITE),d(.1*v(),.625*x())])],_=function(){return a([g(250,24,{noArea:!1}),d(.1*v()+T[1].width+20,T[1].pos.y-6),(0,u.default)("My great room "+Math.floor(y(1e4,99999)).toString(),12,{maxChars:20})])},q=function(e){1===b&&(null==M||M.blur()),1===e&&(null==M||M.focus()),T[b].color=n.WHITE,T[e].color=n.YELLOW,b=e};p("up",function(){q(0===b?0:b-1)}),p("down",function(){q(b===T.length-1?T.length-1:b+1)}),p("left",function(){0===b&&W(P.length-1)}),p("right",function(){0===b&&W(P.length+1)});var A=function(e){H[b](e)};p("space",function(){return A("space")}),p("enter",function(){return A("enter")}),p("backspace",function(){1===b&&(null==M||M.keyPress("backspace"))}),l(function(e){null==M||M.keyPress(e)}),q(b),W()}exports.default=i;
},{"../kaboom":"hRpI","../types":"UL96","../util":"BHXf","../features/playerRect":"ZH20","../features/textbox":"nIBZ"}],"nrN0":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../kaboom"),o=t.k.add,e=t.k.color,i=t.k.destroy,r=t.k.origin,s=t.k.pos,n=t.k.rect,u=t.k.rgb,a=t.k.text,d={border:2,fontColor:u(1,1,1),fontSize:12,showValue:!0,color:u(1,1,1),focusColor:u(1,1,0),min:0,max:100};function h(t,u){void 0===t&&(t=0),void 0===u&&(u={});var h,l,f=Object.assign(d,u);return{inc:function(o){this.setValue(t+o)},getValue:function(){return t},setValue:function(o){o<f.min&&(o=f.min),o>f.max&&(o=f.max),t=o,this.updateUI()},updateUI:function(){var o,e;l&&(l.text=(null!==(o=f.valuePrefix)&&void 0!==o?o:"")+t.toLocaleString()+(null!==(e=f.valueSuffix)&&void 0!==e?e:"")),h.width=(this.width-2*f.border)*(f.max-t)/f.max},add:function(){this.use(e(f.color)),f.showValue&&(l=o([a("",f.fontSize),r("left"),s(this.pos.x+this.width+20,this.pos.y+this.height/2),e(f.fontColor)])),h=o([n(0,this.height-2*f.border),s(this.pos.x+this.width-f.border,this.pos.y+f.border),r("topright"),e(0,0,0)])},destroy:function(){i(h),i(l)}}}exports.default=h;
},{"../kaboom":"hRpI"}],"fKbW":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("../kaboom")),r=require("../types"),u=e(require("../features/slider")),n=r.LOCALSTORAGE_KEYS.SFX_VOL,a=r.LOCALSTORAGE_KEYS.MUS_VOL;function o(){var e=t.default.add,o=t.default.color,l=t.default.go,f=t.default.keyPress,i=t.default.origin,c=t.default.pos,s=t.default.play,d=t.default.rect,p=t.default.sprite,g=t.default.text,m=t.default.width,v=t.default.height,h=[n,a],S=s("menu-2",{loop:!0});S.pause();var _=0;e([g("Preferences",18),o(r.WHITE),i("center"),c(.5*m(),.15*v())]);var E=[e([p("audio-speaker"),c(.25*m(),.3*v())]),e([p("music-note"),c(.25*m(),.45*v())])].map(function(t,r){var n;return e([d(.32*m(),16),c(.35*m(),t.pos.y+8),(0,u.default)(parseInt(null!==(n=localStorage.getItem(h[r]))&&void 0!==n?n:"50"),{valueSuffix:"%"})])});E.push(e([g("Back to main menu",12),i("center"),c(.5*m(),.7*v()),o(r.WHITE)]));var y=function(e){e<0&&(e=0),e>E.length-1&&(e=E.length-1),E[_].color=r.WHITE,E[e].color=r.YELLOW,_=e},L=function(e,t){if(!(e>=E.length-1)){E[e].inc(t);var r=E[e].getValue();localStorage.setItem(h[e],r.toString()),h[e]===a&&S.volume(r/100),t&&h[e]===n&&s("laybomb",{volume:r/100})}},O=function(){_===E.length-1&&(S.stop(),l("mainMenu",2))};f("up",function(){return y(_-1)}),f("down",function(){return y(_+1)}),f("left",function(){return L(_,-5)}),f("right",function(){return L(_,5)}),f("space",O),f("enter",O),f("escape",O),y(_),Array(0,1).forEach(function(e){return L(e,0)}),S.play()}exports.default=o;
},{"../kaboom":"hRpI","../types":"UL96","../features/slider":"nrN0"}],"njTw":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var r=e(require("./createTitle")),t=require("../kaboom"),i=require("../types");function o(){var e=t.k.add,o=t.k.color,a=t.k.go,u=t.k.keyPress,n=t.k.origin,s=t.k.pos,k=t.k.text,c=t.k.width,d=t.k.height;(0,r.default)(),e([k("Press spacebar to begin!",14,{noArea:!0}),o(i.WHITE),n("center"),s(.5*c(),.65*d())]);var l=function(){return a("mainMenu")};u("space",l),u("enter",l)}exports.default=o;
},{"./createTitle":"ulzC","../kaboom":"hRpI","../types":"UL96"}],"fjfs":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("../kaboom")),a=require("../types"),u=require("../util");function r(){var e=t.default.add,r=t.default.color,l=t.default.go,o=t.default.keyPress,d=t.default.origin,s=t.default.pos,i=t.default.play,f=t.default.text,n=t.default.width,c=t.default.height,p=i("menu-3",{loop:!0,volume:(0,u.getMusVol)()});e([f("Battle Round",18),r(a.WHITE),d("center"),s(.5*n(),.25*c())]),e([f("Not available yet!",12),r(a.WHITE),d("center"),s(.5*n(),.4*c())]),e([f("Press spacebar to go back",9),r(a.WHITE),d("center"),s(.5*n(),.6*c())]);var v=function(){p.stop(),l("mainMenu",1)};o("space",v),o("enter",v),o("escape",v)}exports.default=r;
},{"../kaboom":"hRpI","../types":"UL96","../util":"BHXf"}],"LeIe":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("../kaboom")),u=require("../types"),r=require("../util");function a(e,a){void 0===e&&(e=1),void 0===a&&(a=1);var o=t.default.add,l=t.default.color,d=t.default.go,i=t.default.keyPress,s=t.default.origin,f=t.default.pos,n=t.default.play,c=t.default.text,p=t.default.width,v=t.default.height,g=n("menu-4",{loop:!0,volume:(0,r.getMusVol)()});o([c("Level "+a,18),l(u.WHITE),s("center"),f(.5*p(),.3*v())]),o([c("Get Ready!",12),l(u.WHITE),s("center"),f(.5*p(),.4*v())]),o([c("Press spacebar to begin",9),l(u.WHITE),s("center"),f(.5*p(),.6*v())]);var _=function(){g.stop(),d("game",e,a,!1)};i("space",_),i("enter",_)}exports.default=a;
},{"../kaboom":"hRpI","../types":"UL96","../util":"BHXf"}],"f2OD":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(a,u){function o(e){try{l(n.next(e))}catch(t){u(t)}}function i(e){try{l(n.throw(e))}catch(t){u(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,i)}l((n=n.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){var r,n,a,u,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return u={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function i(u){return function(i){return function(u){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(a=2&u[0]?n.return:u[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,u[1])).done)return a;switch(n=0,a&&(u=[2&u[0],a.value]),u[0]){case 0:case 1:a=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,n=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!a||u[1]>a[0]&&u[1]<a[3])){o.label=u[1];break}if(6===u[0]&&o.label<a[1]){o.label=a[1],a=u;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(u);break}a[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(i){u=[6,i],n=0}finally{r=a=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,i])}}},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var n=r(require("../kaboom")),a=require("../util");function u(){return e(this,void 0,void 0,function(){var e,r,u,o,i,l,s,c,f,p,d,h,b,y,v,m;return t(this,function(t){switch(t.label){case 0:return e=n.default.add,r=n.default.color,u=n.default.go,o=n.default.keyPress,i=n.default.loadSprite,l=n.default.loadSound,s=n.default.origin,c=n.default.play,f=n.default.pos,p=n.default.scale,d=n.default.sprite,h=n.default.text,b=n.default.width,y=n.default.height,[4,Promise.all([i("timeup","assets/title/timeup.png"),l("timeup","assets/sfx/smw_game_over.ogg")])];case 1:return t.sent(),v=c("timeup",{volume:(0,a.getMusVol)()}),e([d("timeup",{noArea:!0}),p(2),s("center"),f(.5*b(),.4*y())]),e([h("Press spacebar to try again",9),r(1,1,1,1),s("center"),f(.5*b(),.6*y())]),o("space",m=function(){v.stop(),u("game")}),o("enter",m),o("escape",m),[2]}})})}exports.default=u;
},{"../kaboom":"hRpI","../util":"BHXf"}],"LIbJ":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("./gameScene")),r=e(require("./gameSetupScene")),a=e(require("./joinStartScene")),n=e(require("./joinWaitScene")),u=e(require("./loseScene")),i=e(require("./mainMenuScene")),S=e(require("./playerSelectionScene")),c=e(require("./prefScene")),l=e(require("./startScene")),f=e(require("./startBattleScene")),d=e(require("./startCampaignScene")),s=e(require("./timeupScene"));exports.default={gameScene:t.default,gameSetupScene:r.default,joinStartScene:a.default,joinWaitScene:n.default,loseScene:u.default,mainMenuScene:i.default,playerSelectionScene:S.default,prefScene:c.default,startScene:l.default,startBattleScene:f.default,startCampaignScene:d.default,timeupScene:s.default};
},{"./gameScene":"yj6k","./gameSetupScene":"mndu","./joinStartScene":"mL5h","./joinWaitScene":"ZM2D","./loseScene":"FZKx","./mainMenuScene":"QSkN","./playerSelectionScene":"sYg9","./prefScene":"fKbW","./startScene":"njTw","./startBattleScene":"fjfs","./startCampaignScene":"LeIe","./timeupScene":"f2OD"}],"ZCfc":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});for(var s=e(require("./kaboom")),t=e(require("./scenes")),a=s.default.loadSound,o=s.default.loadSprite,r=s.default.scene,i=s.default.start,n=0,m=["bomberman-tiny","daisy","luigi","mario","peach","toad","toadsworth","wario"];n<m.length;n++){var g=m[n];o(g,"assets/characters/"+g+".png")}a("coin","assets/sfx/smw2_coin.ogg"),a("hurryup","assets/sfx/smb3_hurry_up.ogg"),a("die","assets/sfx/smb3_player_down.ogg"),a("bullet","assets/sfx/smb3_thwomp.ogg"),a("breakbrick","assets/sfx/smw_break_block.ogg"),a("laybomb","assets/sfx/smw_fireball.ogg"),a("pause","assets/sfx/smb_pause.ogg"),a("powerupappears","assets/sfx/smw_power-up_appears.ogg"),a("powerup","assets/sfx/smw_power-up.ogg"),a("explosion","assets/sfx/smw2_explosion.ogg"),a("thud","assets/sfx/smw_thud.ogg"),Array("super","bomber","bros","mushroom").forEach(function(e){return o("title-"+e,"assets/title/"+e+".png")}),Array(1,2,3,4).map(function(e){return a("menu-"+e,"assets/music/menu-"+e+".ogg")}),Array("audio-speaker","checkbox","checkbox-checked","gameover","music-note").forEach(function(e){return o(e,"assets/title/"+e+".png")}),o("block","assets/map/block.png"),o("brick","assets/map/brick.png",{gridWidth:16,gridHeight:16,anims:{explode:{from:1,to:6}}}),o("bomb","assets/map/bomb.png",{gridWidth:16,gridHeight:16,anims:{bomb:{from:0,to:3}}}),o("smoke","assets/map/smoke.png",{gridWidth:16,gridHeight:16,anims:{smoke:{from:0,to:7}}}),o("bullet","assets/enemies/bullet.png"),o("coin","assets/map/coin.png",{gridWidth:32,gridHeight:32,anims:{"coin-10":{from:0,to:3},"coin-30":{from:4,to:7},"coin-50":{from:8,to:11}}}),o("explosion","assets/map/explosion.png",{gridWidth:48,gridHeight:48,anims:{"explode-origin":{from:0,to:6},"explode-mid":{from:7,to:13},"explode-end":{from:14,to:20}}}),o("fish","assets/enemies/fish.png",{gridWidth:21,gridHeight:18,anims:{fish:{from:0,to:1}}}),o("goomba","assets/enemies/goomba.png",{gridWidth:16,gridHeight:16,anims:{walk:{from:0,to:1}}}),o("powerups","assets/map/powerups.png",{gridWidth:16,gridHeight:16}),r("pref",t.default.prefScene),r("start",t.default.startScene),r("gameSetup",t.default.gameSetupScene),r("joinStart",t.default.joinStartScene),r("joinWait",t.default.joinWaitScene),r("playerSelection",t.default.playerSelectionScene),r("startBattle",t.default.startBattleScene),r("startCampaign",t.default.startCampaignScene),r("lose",t.default.loseScene),r("mainMenu",t.default.mainMenuScene),r("game",t.default.gameScene),r("timeup",t.default.timeupScene),i("start");
},{"./kaboom":"hRpI","./scenes":"LIbJ"}]},{},["ZCfc"], null)
//# sourceMappingURL=main.7535152e.js.map